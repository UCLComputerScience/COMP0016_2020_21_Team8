function cov_13uzh0bhr2(){var path="/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/mainDialog.js";var hash="2c2d78c9378f4db03d3a582ddd72d1cf7abbfb67";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/mainDialog.js",statementMap:{"0":{start:{line:4,column:13},end:{line:4,column:28}},"1":{start:{line:5,column:14},end:{line:5,column:30}},"2":{start:{line:6,column:11},end:{line:6,column:24}},"3":{start:{line:7,column:12},end:{line:7,column:31}},"4":{start:{line:8,column:15},end:{line:8,column:35}},"5":{start:{line:19,column:4},end:{line:19,column:33}},"6":{start:{line:20,column:40},end:{line:20,column:65}},"7":{start:{line:21,column:34},end:{line:21,column:56}},"8":{start:{line:23,column:26},end:{line:23,column:45}},"9":{start:{line:24,column:22},end:{line:24,column:37}},"10":{start:{line:25,column:23},end:{line:25,column:39}},"11":{start:{line:26,column:25},end:{line:26,column:43}},"12":{start:{line:30,column:8},end:{line:30,column:28}},"13":{start:{line:32,column:8},end:{line:32,column:43}},"14":{start:{line:33,column:8},end:{line:33,column:60}},"15":{start:{line:34,column:8},end:{line:34,column:53}},"16":{start:{line:35,column:8},end:{line:35,column:56}},"17":{start:{line:36,column:8},end:{line:36,column:58}},"18":{start:{line:37,column:8},end:{line:37,column:86}},"19":{start:{line:39,column:8},end:{line:44,column:12}},"20":{start:{line:46,column:8},end:{line:46,column:48}},"21":{start:{line:56,column:26},end:{line:56,column:49}},"22":{start:{line:57,column:8},end:{line:57,column:28}},"23":{start:{line:59,column:30},end:{line:59,column:72}},"24":{start:{line:60,column:24},end:{line:60,column:60}},"25":{start:{line:61,column:8},end:{line:63,column:9}},"26":{start:{line:62,column:12},end:{line:62,column:53}},"27":{start:{line:69,column:20},end:{line:69,column:96}},"28":{start:{line:70,column:8},end:{line:73,column:11}},"29":{start:{line:77,column:23},end:{line:77,column:40}},"30":{start:{line:78,column:8},end:{line:96,column:9}},"31":{start:{line:79,column:12},end:{line:79,column:57}},"32":{start:{line:81,column:13},end:{line:96,column:9}},"33":{start:{line:82,column:32},end:{line:85,column:13}},"34":{start:{line:87,column:12},end:{line:87,column:71}},"35":{start:{line:90,column:32},end:{line:93,column:13}},"36":{start:{line:95,column:12},end:{line:95,column:71}},"37":{start:{line:101,column:8},end:{line:116,column:9}},"38":{start:{line:102,column:12},end:{line:102,column:52}},"39":{start:{line:103,column:23},end:{line:103,column:49}},"40":{start:{line:104,column:12},end:{line:114,column:13}},"41":{start:{line:105,column:27},end:{line:105,column:76}},"42":{start:{line:106,column:16},end:{line:106,column:45}},"43":{start:{line:107,column:16},end:{line:107,column:88}},"44":{start:{line:108,column:34},end:{line:108,column:58}},"45":{start:{line:109,column:16},end:{line:109,column:122}},"46":{start:{line:112,column:16},end:{line:112,column:66}},"47":{start:{line:113,column:16},end:{line:113,column:91}},"48":{start:{line:117,column:8},end:{line:117,column:32}},"49":{start:{line:122,column:8},end:{line:122,column:109}},"50":{start:{line:126,column:20},end:{line:126,column:34}},"51":{start:{line:127,column:8},end:{line:127,column:57}},"52":{start:{line:128,column:20},end:{line:128,column:34}},"53":{start:{line:129,column:8},end:{line:129,column:57}},"54":{start:{line:131,column:21},end:{line:141,column:11}},"55":{start:{line:142,column:21},end:{line:142,column:23}},"56":{start:{line:143,column:8},end:{line:155,column:10}},"57":{start:{line:144,column:12},end:{line:153,column:14}},"58":{start:{line:146,column:16},end:{line:151,column:17}},"59":{start:{line:147,column:20},end:{line:147,column:51}},"60":{start:{line:150,column:20},end:{line:150,column:35}},"61":{start:{line:159,column:8},end:{line:159,column:22}},"62":{start:{line:164,column:25},end:{line:164,column:100}},"63":{start:{line:165,column:32},end:{line:165,column:59}},"64":{start:{line:170,column:12},end:{line:178,column:13}},"65":{start:{line:173,column:16},end:{line:174,column:42}},"66":{start:{line:177,column:16},end:{line:177,column:90}},"67":{start:{line:179,column:12},end:{line:179,column:48}},"68":{start:{line:184,column:30},end:{line:184,column:96}},"69":{start:{line:185,column:16},end:{line:185,column:74}},"70":{start:{line:185,column:64},end:{line:185,column:73}},"71":{start:{line:186,column:8},end:{line:186,column:16}},"72":{start:{line:191,column:19},end:{line:191,column:76}},"73":{start:{line:192,column:8},end:{line:192,column:26}},"74":{start:{line:194,column:20},end:{line:194,column:41}},"75":{start:{line:197,column:30},end:{line:197,column:56}},"76":{start:{line:199,column:8},end:{line:216,column:9}},"77":{start:{line:201,column:29},end:{line:201,column:82}},"78":{start:{line:203,column:12},end:{line:207,column:13}},"79":{start:{line:204,column:16},end:{line:206,column:19}},"80":{start:{line:205,column:20},end:{line:205,column:94}},"81":{start:{line:208,column:12},end:{line:212,column:15}},"82":{start:{line:209,column:16},end:{line:211,column:17}},"83":{start:{line:210,column:20},end:{line:210,column:34}},"84":{start:{line:214,column:12},end:{line:214,column:33}},"85":{start:{line:215,column:12},end:{line:215,column:29}},"86":{start:{line:219,column:8},end:{line:222,column:10}},"87":{start:{line:228,column:8},end:{line:251,column:9}},"88":{start:{line:229,column:26},end:{line:229,column:54}},"89":{start:{line:230,column:30},end:{line:230,column:60}},"90":{start:{line:231,column:27},end:{line:231,column:29}},"91":{start:{line:233,column:12},end:{line:240,column:15}},"92":{start:{line:234,column:16},end:{line:239,column:17}},"93":{start:{line:235,column:20},end:{line:235,column:46}},"94":{start:{line:237,column:21},end:{line:239,column:17}},"95":{start:{line:238,column:20},end:{line:238,column:46}},"96":{start:{line:242,column:12},end:{line:242,column:54}},"97":{start:{line:245,column:12},end:{line:245,column:37}},"98":{start:{line:247,column:12},end:{line:247,column:81}},"99":{start:{line:250,column:12},end:{line:250,column:24}},"100":{start:{line:256,column:0},end:{line:256,column:39}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:29,column:4},end:{line:29,column:5}},loc:{start:{line:29,column:18},end:{line:47,column:5}},line:29},"1":{name:"(anonymous_1)",decl:{start:{line:55,column:4},end:{line:55,column:5}},loc:{start:{line:55,column:37},end:{line:64,column:5}},line:55},"2":{name:"(anonymous_2)",decl:{start:{line:66,column:4},end:{line:66,column:5}},loc:{start:{line:66,column:26},end:{line:74,column:5}},line:66},"3":{name:"(anonymous_3)",decl:{start:{line:76,column:4},end:{line:76,column:5}},loc:{start:{line:76,column:27},end:{line:98,column:5}},line:76},"4":{name:"(anonymous_4)",decl:{start:{line:100,column:4},end:{line:100,column:5}},loc:{start:{line:100,column:24},end:{line:118,column:5}},line:100},"5":{name:"(anonymous_5)",decl:{start:{line:121,column:4},end:{line:121,column:5}},loc:{start:{line:121,column:27},end:{line:123,column:5}},line:121},"6":{name:"(anonymous_6)",decl:{start:{line:125,column:4},end:{line:125,column:5}},loc:{start:{line:125,column:24},end:{line:160,column:5}},line:125},"7":{name:"(anonymous_7)",decl:{start:{line:143,column:46},end:{line:143,column:47}},loc:{start:{line:143,column:57},end:{line:155,column:9}},line:143},"8":{name:"(anonymous_8)",decl:{start:{line:144,column:28},end:{line:144,column:29}},loc:{start:{line:144,column:38},end:{line:153,column:13}},line:144},"9":{name:"(anonymous_9)",decl:{start:{line:162,column:4},end:{line:162,column:5}},loc:{start:{line:162,column:48},end:{line:188,column:5}},line:162},"10":{name:"replyForReceivedAttachments",decl:{start:{line:169,column:23},end:{line:169,column:50}},loc:{start:{line:169,column:72},end:{line:180,column:9}},line:169},"11":{name:"(anonymous_11)",decl:{start:{line:185,column:54},end:{line:185,column:55}},loc:{start:{line:185,column:64},end:{line:185,column:73}},line:185},"12":{name:"(anonymous_12)",decl:{start:{line:190,column:4},end:{line:190,column:5}},loc:{start:{line:190,column:49},end:{line:223,column:5}},line:190},"13":{name:"(anonymous_13)",decl:{start:{line:204,column:58},end:{line:204,column:59}},loc:{start:{line:204,column:74},end:{line:206,column:17}},line:204},"14":{name:"(anonymous_14)",decl:{start:{line:208,column:55},end:{line:208,column:56}},loc:{start:{line:208,column:68},end:{line:212,column:13}},line:208},"15":{name:"(anonymous_15)",decl:{start:{line:227,column:4},end:{line:227,column:5}},loc:{start:{line:227,column:41},end:{line:252,column:5}},line:227},"16":{name:"(anonymous_16)",decl:{start:{line:233,column:32},end:{line:233,column:33}},loc:{start:{line:233,column:46},end:{line:240,column:13}},line:233}},branchMap:{"0":{loc:{start:{line:61,column:8},end:{line:63,column:9}},type:"if",locations:[{start:{line:61,column:8},end:{line:63,column:9}},{start:{line:61,column:8},end:{line:63,column:9}}],line:61},"1":{loc:{start:{line:69,column:20},end:{line:69,column:96}},type:"cond-expr",locations:[{start:{line:69,column:46},end:{line:69,column:69}},{start:{line:69,column:72},end:{line:69,column:96}}],line:69},"2":{loc:{start:{line:78,column:8},end:{line:96,column:9}},type:"if",locations:[{start:{line:78,column:8},end:{line:96,column:9}},{start:{line:78,column:8},end:{line:96,column:9}}],line:78},"3":{loc:{start:{line:81,column:13},end:{line:96,column:9}},type:"if",locations:[{start:{line:81,column:13},end:{line:96,column:9}},{start:{line:81,column:13},end:{line:96,column:9}}],line:81},"4":{loc:{start:{line:101,column:8},end:{line:116,column:9}},type:"if",locations:[{start:{line:101,column:8},end:{line:116,column:9}},{start:{line:101,column:8},end:{line:116,column:9}}],line:101},"5":{loc:{start:{line:101,column:12},end:{line:101,column:52}},type:"binary-expr",locations:[{start:{line:101,column:12},end:{line:101,column:23}},{start:{line:101,column:27},end:{line:101,column:52}}],line:101},"6":{loc:{start:{line:104,column:12},end:{line:114,column:13}},type:"if",locations:[{start:{line:104,column:12},end:{line:114,column:13}},{start:{line:104,column:12},end:{line:114,column:13}}],line:104},"7":{loc:{start:{line:146,column:16},end:{line:151,column:17}},type:"if",locations:[{start:{line:146,column:16},end:{line:151,column:17}},{start:{line:146,column:16},end:{line:151,column:17}}],line:146},"8":{loc:{start:{line:170,column:12},end:{line:178,column:13}},type:"if",locations:[{start:{line:170,column:12},end:{line:178,column:13}},{start:{line:170,column:12},end:{line:178,column:13}}],line:170},"9":{loc:{start:{line:203,column:12},end:{line:207,column:13}},type:"if",locations:[{start:{line:203,column:12},end:{line:207,column:13}},{start:{line:203,column:12},end:{line:207,column:13}}],line:203},"10":{loc:{start:{line:205,column:27},end:{line:205,column:93}},type:"cond-expr",locations:[{start:{line:205,column:62},end:{line:205,column:85}},{start:{line:205,column:88},end:{line:205,column:93}}],line:205},"11":{loc:{start:{line:205,column:27},end:{line:205,column:59}},type:"binary-expr",locations:[{start:{line:205,column:27},end:{line:205,column:32}},{start:{line:205,column:36},end:{line:205,column:59}}],line:205},"12":{loc:{start:{line:209,column:16},end:{line:211,column:17}},type:"if",locations:[{start:{line:209,column:16},end:{line:211,column:17}},{start:{line:209,column:16},end:{line:211,column:17}}],line:209},"13":{loc:{start:{line:228,column:8},end:{line:251,column:9}},type:"if",locations:[{start:{line:228,column:8},end:{line:251,column:9}},{start:{line:228,column:8},end:{line:251,column:9}}],line:228},"14":{loc:{start:{line:234,column:16},end:{line:239,column:17}},type:"if",locations:[{start:{line:234,column:16},end:{line:239,column:17}},{start:{line:234,column:16},end:{line:239,column:17}}],line:234},"15":{loc:{start:{line:234,column:20},end:{line:234,column:114}},type:"binary-expr",locations:[{start:{line:234,column:20},end:{line:234,column:66}},{start:{line:234,column:70},end:{line:234,column:114}}],line:234},"16":{loc:{start:{line:237,column:21},end:{line:239,column:17}},type:"if",locations:[{start:{line:237,column:21},end:{line:239,column:17}},{start:{line:237,column:21},end:{line:239,column:17}}],line:237},"17":{loc:{start:{line:237,column:25},end:{line:237,column:149}},type:"binary-expr",locations:[{start:{line:237,column:25},end:{line:237,column:62}},{start:{line:237,column:67},end:{line:237,column:106}},{start:{line:237,column:110},end:{line:237,column:148}}],line:237}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2c2d78c9378f4db03d3a582ddd72d1cf7abbfb67"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_13uzh0bhr2=function(){return actualCoverage;};}return actualCoverage;}cov_13uzh0bhr2();// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
const path=(cov_13uzh0bhr2().s[0]++,require('path'));const axios=(cov_13uzh0bhr2().s[1]++,require('axios'));const fs=(cov_13uzh0bhr2().s[2]++,require('fs'));const fse=(cov_13uzh0bhr2().s[3]++,require("fs-extra"));var FormData=(cov_13uzh0bhr2().s[4]++,require("form-data"));const{AttachmentPrompt,ChoiceFactory,ChoicePrompt,ComponentDialog,ConfirmPrompt,DialogSet,DialogTurnStatus,TextPrompt,WaterfallDialog}=(cov_13uzh0bhr2().s[5]++,require('botbuilder-dialogs'));const{AnswerDialog,ANSWER_DIALOG}=(cov_13uzh0bhr2().s[6]++,require('./answerDialog'));const{DocDialog,DOC_DIALOG}=(cov_13uzh0bhr2().s[7]++,require('./docDialog'));const ATTACHMENT_PROMPT=(cov_13uzh0bhr2().s[8]++,'ATTACHMENT_PROMPT');const CHOICE_PROMPT=(cov_13uzh0bhr2().s[9]++,'CHOICE_PROMPT');const CONFIRM_PROMPT=(cov_13uzh0bhr2().s[10]++,'CONFIRM_PROMPT');const WATERFALL_DIALOG=(cov_13uzh0bhr2().s[11]++,'WATERFALL_DIALOG');class MainDialog extends ComponentDialog{constructor(){cov_13uzh0bhr2().f[0]++;cov_13uzh0bhr2().s[12]++;super('mainDialog');cov_13uzh0bhr2().s[13]++;this.addDialog(new AnswerDialog());cov_13uzh0bhr2().s[14]++;this.addDialog(new DocDialog(this.initialDialogId));cov_13uzh0bhr2().s[15]++;this.addDialog(new TextPrompt('TextPrompt'));cov_13uzh0bhr2().s[16]++;this.addDialog(new ChoicePrompt(CHOICE_PROMPT));cov_13uzh0bhr2().s[17]++;this.addDialog(new ConfirmPrompt(CONFIRM_PROMPT));cov_13uzh0bhr2().s[18]++;this.addDialog(new AttachmentPrompt(ATTACHMENT_PROMPT,this.promptValidator));cov_13uzh0bhr2().s[19]++;this.addDialog(new WaterfallDialog(WATERFALL_DIALOG,[this.startStep.bind(this),this.chooseStep.bind(this),this.docStep.bind(this),this.repeatStep.bind(this)]));cov_13uzh0bhr2().s[20]++;this.initialDialogId=WATERFALL_DIALOG;}/**
     * The run method handles the incoming activity (in the form of a TurnContext) and passes it through the dialog system.
     * If no dialog is active, it will start the default dialog.
     * @param {*} turnContext
     * @param {*} accessor
     */async run(turnContext,accessor){cov_13uzh0bhr2().f[1]++;const dialogSet=(cov_13uzh0bhr2().s[21]++,new DialogSet(accessor));cov_13uzh0bhr2().s[22]++;dialogSet.add(this);const dialogContext=(cov_13uzh0bhr2().s[23]++,await dialogSet.createContext(turnContext));const results=(cov_13uzh0bhr2().s[24]++,await dialogContext.continueDialog());cov_13uzh0bhr2().s[25]++;if(results.status===DialogTurnStatus.empty){cov_13uzh0bhr2().b[0][0]++;cov_13uzh0bhr2().s[26]++;await dialogContext.beginDialog(this.id);}else{cov_13uzh0bhr2().b[0][1]++;}}async startStep(step){cov_13uzh0bhr2().f[2]++;// WaterfallStep always finishes with the end of the Waterfall or with another dialog; here it is a Prompt Dialog.
// Running a prompt here means the next WaterfallStep will be run when the user's response is received.
const msg=(cov_13uzh0bhr2().s[27]++,step.options.restartMsg?(cov_13uzh0bhr2().b[1][0]++,step.options.restartMsg):(cov_13uzh0bhr2().b[1][1]++,'What can I do for you?'));cov_13uzh0bhr2().s[28]++;return await step.prompt(CHOICE_PROMPT,{prompt:msg,choices:ChoiceFactory.toChoices(['ask a question','process a document',,'recognize an image'])});}async chooseStep(step){cov_13uzh0bhr2().f[3]++;const choice=(cov_13uzh0bhr2().s[29]++,step.result.value);cov_13uzh0bhr2().s[30]++;if(choice=='ask a question'){cov_13uzh0bhr2().b[2][0]++;cov_13uzh0bhr2().s[31]++;return await step.beginDialog(ANSWER_DIALOG);}else{cov_13uzh0bhr2().b[2][1]++;cov_13uzh0bhr2().s[32]++;if(choice=='process a document'){cov_13uzh0bhr2().b[3][0]++;var promptOptions=(cov_13uzh0bhr2().s[33]++,{prompt:'Please attach a document in pdf.',retryPrompt:'That was not a document that I can help, please try again.'});cov_13uzh0bhr2().s[34]++;return await step.prompt(ATTACHMENT_PROMPT,promptOptions);}else{cov_13uzh0bhr2().b[3][1]++;var promptOptions=(cov_13uzh0bhr2().s[35]++,{prompt:'Please attach an image.',retryPrompt:'That was not an image that I can help, please try again.'});cov_13uzh0bhr2().s[36]++;return await step.prompt(ATTACHMENT_PROMPT,promptOptions);}}}async docStep(step){cov_13uzh0bhr2().f[4]++;cov_13uzh0bhr2().s[37]++;if((cov_13uzh0bhr2().b[5][0]++,step.result)&&(cov_13uzh0bhr2().b[5][1]++,step.result[0].contentUrl)){cov_13uzh0bhr2().b[4][0]++;cov_13uzh0bhr2().s[38]++;console.log(step.result[0].contentType);var type=(cov_13uzh0bhr2().s[39]++,step.result[0].contentType);cov_13uzh0bhr2().s[40]++;if(type==='application/pdf'){cov_13uzh0bhr2().b[6][0]++;var path=(cov_13uzh0bhr2().s[41]++,await this.handleIncomingAttachment(step.context));cov_13uzh0bhr2().s[42]++;console.log('path: '+path);cov_13uzh0bhr2().s[43]++;await step.context.sendActivity('Processing the document, please wait');var req_results=(cov_13uzh0bhr2().s[44]++,await this.sendReq(path));cov_13uzh0bhr2().s[45]++;return await step.beginDialog(DOC_DIALOG,{sum:req_results[0],query:req_results[1],filepath:path});}else{cov_13uzh0bhr2().b[6][1]++;cov_13uzh0bhr2().s[46]++;await this.handleIncomingAttachment(step.context);cov_13uzh0bhr2().s[47]++;return await step.context.sendActivity('More functions to be updating...');}}else{cov_13uzh0bhr2().b[4][1]++;}cov_13uzh0bhr2().s[48]++;return await step.next();}async repeatStep(step){cov_13uzh0bhr2().f[5]++;cov_13uzh0bhr2().s[49]++;return await step.replaceDialog(this.initialDialogId,{restartMsg:'What else can I do for you?'});}async sendReq(path){cov_13uzh0bhr2().f[6]++;var form1=(cov_13uzh0bhr2().s[50]++,new FormData());cov_13uzh0bhr2().s[51]++;form1.append("file",fse.createReadStream(path));var form2=(cov_13uzh0bhr2().s[52]++,new FormData());cov_13uzh0bhr2().s[53]++;form2.append("file",fse.createReadStream(path));let reqArr=(cov_13uzh0bhr2().s[54]++,[axios({method:"post",url:"https://textsumapi.azurewebsites.net/api/textsumapi",data:form1,headers:form1.getHeaders()}),axios({method:"post",url:"http://51.11.182.5:5000",data:form2,headers:form2.getHeaders()})]);var output=(cov_13uzh0bhr2().s[55]++,[]);cov_13uzh0bhr2().s[56]++;await Promise.allSettled(reqArr).then(results=>{cov_13uzh0bhr2().f[7]++;cov_13uzh0bhr2().s[57]++;results.forEach(result=>{cov_13uzh0bhr2().f[8]++;cov_13uzh0bhr2().s[58]++;//console.log(result.status);
if(result.status=='fulfilled'){cov_13uzh0bhr2().b[7][0]++;cov_13uzh0bhr2().s[59]++;output.push(result.value.data);//console.log('first: '+result.value.data);
}else{cov_13uzh0bhr2().b[7][1]++;cov_13uzh0bhr2().s[60]++;output.push(0);}});});//console.log("完成啦！");
//console.log(output);
cov_13uzh0bhr2().s[61]++;return output;}async handleIncomingAttachment(turnContext){cov_13uzh0bhr2().f[9]++;// Prepare Promises to download each attachment and then execute each Promise.
const promises=(cov_13uzh0bhr2().s[62]++,await turnContext.activity.attachments.map(this.downloadAttachmentAndWrite));const successfulSaves=(cov_13uzh0bhr2().s[63]++,await Promise.all(promises));// Replies back to the user with information about where the attachment is stored on the bot's server,
// and what the name of the saved file is.
async function replyForReceivedAttachments(localAttachmentData){cov_13uzh0bhr2().f[10]++;cov_13uzh0bhr2().s[64]++;if(localAttachmentData){cov_13uzh0bhr2().b[8][0]++;cov_13uzh0bhr2().s[65]++;// Because the TurnContext was bound to this function, the bot can call
// `TurnContext.sendActivity` via `this.sendActivity`;
await this.sendActivity(`Attachment "${localAttachmentData.fileName}" `+`has been received.`);}else{cov_13uzh0bhr2().b[8][1]++;cov_13uzh0bhr2().s[66]++;await this.sendActivity('Attachment was not successfully saved to disk.');}cov_13uzh0bhr2().s[67]++;return localAttachmentData.localPath;}// Prepare Promises to reply to the user with information about saved attachments.
// The current TurnContext is bound so `replyForReceivedAttachments` can also send replies.
const replyPromises=(cov_13uzh0bhr2().s[68]++,successfulSaves.map(replyForReceivedAttachments.bind(turnContext)));let r=(cov_13uzh0bhr2().s[69]++,await Promise.all(replyPromises).then(result=>{cov_13uzh0bhr2().f[11]++;cov_13uzh0bhr2().s[70]++;return result[0];}));cov_13uzh0bhr2().s[71]++;return r;}async downloadAttachmentAndWrite(attachment){cov_13uzh0bhr2().f[12]++;var name=(cov_13uzh0bhr2().s[72]++,'text.'+attachment.contentType.toString().split('/')[1]);cov_13uzh0bhr2().s[73]++;console.log(name);// Retrieve the attachment via the attachment's contentUrl.
const url=(cov_13uzh0bhr2().s[74]++,attachment.contentUrl);// Local file path for the bot to save the attachment.
const localFileName=(cov_13uzh0bhr2().s[75]++,path.join(__dirname,name));cov_13uzh0bhr2().s[76]++;try{// arraybuffer is necessary for images
const response=(cov_13uzh0bhr2().s[77]++,await axios.get(url,{responseType:'arraybuffer'}));// If user uploads JSON file, this prevents it from being written as "{"type":"Buffer","data":[123,13,10,32,32,34,108..."
cov_13uzh0bhr2().s[78]++;if(response.headers['content-type']==='application/json'){cov_13uzh0bhr2().b[9][0]++;cov_13uzh0bhr2().s[79]++;response.data=JSON.parse(response.data,(key,value)=>{cov_13uzh0bhr2().f[13]++;cov_13uzh0bhr2().s[80]++;return(cov_13uzh0bhr2().b[11][0]++,value)&&(cov_13uzh0bhr2().b[11][1]++,value.type==='Buffer')?(cov_13uzh0bhr2().b[10][0]++,Buffer.from(value.data)):(cov_13uzh0bhr2().b[10][1]++,value);});}else{cov_13uzh0bhr2().b[9][1]++;}cov_13uzh0bhr2().s[81]++;fs.writeFile(localFileName,response.data,fsError=>{cov_13uzh0bhr2().f[14]++;cov_13uzh0bhr2().s[82]++;if(fsError){cov_13uzh0bhr2().b[12][0]++;cov_13uzh0bhr2().s[83]++;throw fsError;}else{cov_13uzh0bhr2().b[12][1]++;}});}catch(error){cov_13uzh0bhr2().s[84]++;console.error(error);cov_13uzh0bhr2().s[85]++;return undefined;}// If no error was thrown while writing to disk, return the attachment's name
// and localFilePath for the response back to the user.
cov_13uzh0bhr2().s[86]++;return{fileName:attachment.name,localPath:localFileName};}async promptValidator(promptContext){cov_13uzh0bhr2().f[15]++;cov_13uzh0bhr2().s[87]++;if(promptContext.recognized.succeeded){cov_13uzh0bhr2().b[13][0]++;var docType=(cov_13uzh0bhr2().s[88]++,promptContext.options.prompt);var attachments=(cov_13uzh0bhr2().s[89]++,promptContext.recognized.value);var validDoc=(cov_13uzh0bhr2().s[90]++,[]);cov_13uzh0bhr2().s[91]++;attachments.forEach(attachment=>{cov_13uzh0bhr2().f[16]++;cov_13uzh0bhr2().s[92]++;if((cov_13uzh0bhr2().b[15][0]++,docType==='Please attach a document in pdf.')&&(cov_13uzh0bhr2().b[15][1]++,attachment.contentType==='application/pdf')){cov_13uzh0bhr2().b[14][0]++;cov_13uzh0bhr2().s[93]++;//|| attachment.contentType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'|| attachment.contentType === 'application/msword'
validDoc.push(attachment);}else{cov_13uzh0bhr2().b[14][1]++;cov_13uzh0bhr2().s[94]++;if((cov_13uzh0bhr2().b[17][0]++,docType==='Please attach an image.')&&((cov_13uzh0bhr2().b[17][1]++,attachment.contentType==='image/jpeg')||(cov_13uzh0bhr2().b[17][2]++,attachment.contentType==='image/png'))){cov_13uzh0bhr2().b[16][0]++;cov_13uzh0bhr2().s[95]++;validDoc.push(attachment);}else{cov_13uzh0bhr2().b[16][1]++;}}});cov_13uzh0bhr2().s[96]++;promptContext.recognized.value=validDoc;// If none of the attachments are valid images, the retry prompt should be sent.
cov_13uzh0bhr2().s[97]++;return!!validDoc.length;}else{cov_13uzh0bhr2().b[13][1]++;cov_13uzh0bhr2().s[98]++;await promptContext.context.sendActivity('No attachments received.');// We can return true from a validator function even if Recognized.Succeeded is false.
cov_13uzh0bhr2().s[99]++;return true;}}}cov_13uzh0bhr2().s[100]++;module.exports.MainDialog=MainDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW5EaWFsb2cuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJheGlvcyIsImZzIiwiZnNlIiwiRm9ybURhdGEiLCJBdHRhY2htZW50UHJvbXB0IiwiQ2hvaWNlRmFjdG9yeSIsIkNob2ljZVByb21wdCIsIkNvbXBvbmVudERpYWxvZyIsIkNvbmZpcm1Qcm9tcHQiLCJEaWFsb2dTZXQiLCJEaWFsb2dUdXJuU3RhdHVzIiwiVGV4dFByb21wdCIsIldhdGVyZmFsbERpYWxvZyIsIkFuc3dlckRpYWxvZyIsIkFOU1dFUl9ESUFMT0ciLCJEb2NEaWFsb2ciLCJET0NfRElBTE9HIiwiQVRUQUNITUVOVF9QUk9NUFQiLCJDSE9JQ0VfUFJPTVBUIiwiQ09ORklSTV9QUk9NUFQiLCJXQVRFUkZBTExfRElBTE9HIiwiTWFpbkRpYWxvZyIsImNvbnN0cnVjdG9yIiwiYWRkRGlhbG9nIiwiaW5pdGlhbERpYWxvZ0lkIiwicHJvbXB0VmFsaWRhdG9yIiwic3RhcnRTdGVwIiwiYmluZCIsImNob29zZVN0ZXAiLCJkb2NTdGVwIiwicmVwZWF0U3RlcCIsInJ1biIsInR1cm5Db250ZXh0IiwiYWNjZXNzb3IiLCJkaWFsb2dTZXQiLCJhZGQiLCJkaWFsb2dDb250ZXh0IiwiY3JlYXRlQ29udGV4dCIsInJlc3VsdHMiLCJjb250aW51ZURpYWxvZyIsInN0YXR1cyIsImVtcHR5IiwiYmVnaW5EaWFsb2ciLCJpZCIsInN0ZXAiLCJtc2ciLCJvcHRpb25zIiwicmVzdGFydE1zZyIsInByb21wdCIsImNob2ljZXMiLCJ0b0Nob2ljZXMiLCJjaG9pY2UiLCJyZXN1bHQiLCJ2YWx1ZSIsInByb21wdE9wdGlvbnMiLCJyZXRyeVByb21wdCIsImNvbnRlbnRVcmwiLCJjb25zb2xlIiwibG9nIiwiY29udGVudFR5cGUiLCJ0eXBlIiwiaGFuZGxlSW5jb21pbmdBdHRhY2htZW50IiwiY29udGV4dCIsInNlbmRBY3Rpdml0eSIsInJlcV9yZXN1bHRzIiwic2VuZFJlcSIsInN1bSIsInF1ZXJ5IiwiZmlsZXBhdGgiLCJuZXh0IiwicmVwbGFjZURpYWxvZyIsImZvcm0xIiwiYXBwZW5kIiwiY3JlYXRlUmVhZFN0cmVhbSIsImZvcm0yIiwicmVxQXJyIiwibWV0aG9kIiwidXJsIiwiZGF0YSIsImhlYWRlcnMiLCJnZXRIZWFkZXJzIiwib3V0cHV0IiwiUHJvbWlzZSIsImFsbFNldHRsZWQiLCJ0aGVuIiwiZm9yRWFjaCIsInB1c2giLCJwcm9taXNlcyIsImFjdGl2aXR5IiwiYXR0YWNobWVudHMiLCJtYXAiLCJkb3dubG9hZEF0dGFjaG1lbnRBbmRXcml0ZSIsInN1Y2Nlc3NmdWxTYXZlcyIsImFsbCIsInJlcGx5Rm9yUmVjZWl2ZWRBdHRhY2htZW50cyIsImxvY2FsQXR0YWNobWVudERhdGEiLCJmaWxlTmFtZSIsImxvY2FsUGF0aCIsInJlcGx5UHJvbWlzZXMiLCJyIiwiYXR0YWNobWVudCIsIm5hbWUiLCJ0b1N0cmluZyIsInNwbGl0IiwibG9jYWxGaWxlTmFtZSIsImpvaW4iLCJfX2Rpcm5hbWUiLCJyZXNwb25zZSIsImdldCIsInJlc3BvbnNlVHlwZSIsIkpTT04iLCJwYXJzZSIsImtleSIsIkJ1ZmZlciIsImZyb20iLCJ3cml0ZUZpbGUiLCJmc0Vycm9yIiwiZXJyb3IiLCJ1bmRlZmluZWQiLCJwcm9tcHRDb250ZXh0IiwicmVjb2duaXplZCIsInN1Y2NlZWRlZCIsImRvY1R5cGUiLCJ2YWxpZERvYyIsImxlbmd0aCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJvOGFBZVk7MkZBZlo7QUFDQTtBQUVBLEtBQU1BLENBQUFBLElBQUksMEJBQUdDLE9BQU8sQ0FBQyxNQUFELENBQVYsQ0FBVixDQUNBLEtBQU1DLENBQUFBLEtBQUssMEJBQUdELE9BQU8sQ0FBQyxPQUFELENBQVYsQ0FBWCxDQUNBLEtBQU1FLENBQUFBLEVBQUUsMEJBQUdGLE9BQU8sQ0FBQyxJQUFELENBQVYsQ0FBUixDQUNBLEtBQU1HLENBQUFBLEdBQUcsMEJBQUdILE9BQU8sQ0FBQyxVQUFELENB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LDZCQUFBc0IsT0FBTyxHQUFLLGtDQUFaLGdDQUFrRHRCLFVBQVUsQ0FBQ3pDLFdBQVgsR0FBMkIsaUJBQTdFLENBQUosQ0FBb0csc0RBQUU7QUFDbEdnRSxRQUFRLENBQUNyQyxJQUFULENBQWNjLFVBQWQsRUFDSCxDQUZELElBR0sseURBQUksNkJBQUFzQixPQUFPLEdBQUsseUJBQVosSUFBMEMsNkJBQUF0QixVQUFVLENBQUN6QyxXQUFYLEdBQTJCLFlBQTNCLGdDQUEyQ3lDLFVBQVUsQ0FBQ3pDLFdBQVgsR0FBMkIsV0FBdEUsQ0FBMUMsQ0FBSixDQUFrSSxzREFDbklnRSxRQUFRLENBQUNyQyxJQUFULENBQWNjLFVBQWQsRUFDSCxDQUZJLGtDQUVKLENBQ0osQ0FQRCxFQUxvQyx5QkFjcENtQixhQUFhLENBQUNDLFVBQWQsQ0FBeUJuRSxLQUF6QixDQUFpQ3NFLFFBQWpDLENBRUE7QUFoQm9DLHlCQWlCcEMsTUFBTyxDQUFDLENBQUNBLFFBQVEsQ0FBQ0MsTUFBbEIsQ0FDSCxDQWxCRCxJQWtCTyxzREFDSCxLQUFNTCxDQUFBQSxhQUFhLENBQUN6RCxPQUFkLENBQXNCQyxZQUF0QixDQUFtQywwQkFBbkMsQ0FBTixDQUVBO0FBSEcseUJBSUgsTUFBTyxLQUFQLENBQ0gsQ0FDSixDQWhPb0MsQywwQkFvT3pDOEQsTUFBTSxDQUFDQyxPQUFQLENBQWV6RyxVQUFmLENBQTRCQSxVQUE1QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcblxyXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xyXG5jb25zdCBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJyk7XHJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcclxuY29uc3QgZnNlID0gcmVxdWlyZShcImZzLWV4dHJhXCIpO1xyXG52YXIgRm9ybURhdGEgPSByZXF1aXJlKFwiZm9ybS1kYXRhXCIpO1xyXG5jb25zdCB7XHJcbiAgICBBdHRhY2htZW50UHJvbXB0LFxyXG4gICAgQ2hvaWNlRmFjdG9yeSxcclxuICAgIENob2ljZVByb21wdCxcclxuICAgIENvbXBvbmVudERpYWxvZyxcclxuICAgIENvbmZpcm1Qcm9tcHQsXHJcbiAgICBEaWFsb2dTZXQsXHJcbiAgICBEaWFsb2dUdXJuU3RhdHVzLFxyXG4gICAgVGV4dFByb21wdCxcclxuICAgIFdhdGVyZmFsbERpYWxvZ1xyXG59ID0gcmVxdWlyZSgnYm90YnVpbGRlci1kaWFsb2dzJyk7XHJcbmNvbnN0IHsgQW5zd2VyRGlhbG9nLCBBTlNXRVJfRElBTE9HIH0gPSByZXF1aXJlKCcuL2Fuc3dlckRpYWxvZycpO1xyXG5jb25zdCB7IERvY0RpYWxvZywgRE9DX0RJQUxPRyB9ID0gcmVxdWlyZSgnLi9kb2NEaWFsb2cnKTtcclxuXHJcbmNvbnN0IEFUVEFDSE1FTlRfUFJPTVBUID0gJ0FUVEFDSE1FTlRfUFJPTVBUJztcclxuY29uc3QgQ0hPSUNFX1BST01QVCA9ICdDSE9JQ0VfUFJPTVBUJztcclxuY29uc3QgQ09ORklSTV9QUk9NUFQgPSAnQ09ORklSTV9QUk9NUFQnO1xyXG5jb25zdCBXQVRFUkZBTExfRElBTE9HID0gJ1dBVEVSRkFMTF9ESUFMT0cnO1xyXG5cclxuY2xhc3MgTWFpbkRpYWxvZyBleHRlbmRzIENvbXBvbmVudERpYWxvZyB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcignbWFpbkRpYWxvZycpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgQW5zd2VyRGlhbG9nKCkpO1xyXG4gICAgICAgIHRoaXMuYWRkRGlhbG9nKG5ldyBEb2NEaWFsb2codGhpcy5pbml0aWFsRGlhbG9nSWQpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgVGV4dFByb21wdCgnVGV4dFByb21wdCcpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgQ2hvaWNlUHJvbXB0KENIT0lDRV9QUk9NUFQpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgQ29uZmlybVByb21wdChDT05GSVJNX1BST01QVCkpO1xyXG4gICAgICAgIHRoaXMuYWRkRGlhbG9nKG5ldyBBdHRhY2htZW50UHJvbXB0KEFUVEFDSE1FTlRfUFJPTVBULCB0aGlzLnByb21wdFZhbGlkYXRvcikpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgV2F0ZXJmYWxsRGlhbG9nKFdBVEVSRkFMTF9ESUFMT0csIFtcclxuICAgICAgICAgICAgdGhpcy5zdGFydFN0ZXAuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgdGhpcy5jaG9vc2VTdGVwLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgIHRoaXMuZG9jU3RlcC5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICB0aGlzLnJlcGVhdFN0ZXAuYmluZCh0aGlzKVxyXG4gICAgICAgIF0pKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsRGlhbG9nSWQgPSBXQVRFUkZBTExfRElBTE9HO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVGhlIHJ1biBtZXRob2QgaGFuZGxlcyB0aGUgaW5jb21pbmcgYWN0aXZpdHkgKGluIHRoZSBmb3JtIG9mIGEgVHVybkNvbnRleHQpIGFuZCBwYXNzZXMgaXQgdGhyb3VnaCB0aGUgZGlhbG9nIHN5c3RlbS5cclxuICAgICAqIElmIG5vIGRpYWxvZyBpcyBhY3RpdmUsIGl0IHdpbGwgc3RhcnQgdGhlIGRlZmF1bHQgZGlhbG9nLlxyXG4gICAgICogQHBhcmFtIHsqfSB0dXJuQ29udGV4dFxyXG4gICAgICogQHBhcmFtIHsqfSBhY2Nlc3NvclxyXG4gICAgICovXHJcbiAgICBhc3luYyBydW4odHVybkNvbnRleHQsIGFjY2Vzc29yKSB7XHJcbiAgICAgICAgY29uc3QgZGlhbG9nU2V0ID0gbmV3IERpYWxvZ1NldChhY2Nlc3Nvcik7XHJcbiAgICAgICAgZGlhbG9nU2V0LmFkZCh0aGlzKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGlhbG9nQ29udGV4dCA9IGF3YWl0IGRpYWxvZ1NldC5jcmVhdGVDb250ZXh0KHR1cm5Db250ZXh0KTtcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZGlhbG9nQ29udGV4dC5jb250aW51ZURpYWxvZygpO1xyXG4gICAgICAgIGlmIChyZXN1bHRzLnN0YXR1cyA9PT0gRGlhbG9nVHVyblN0YXR1cy5lbXB0eSkge1xyXG4gICAgICAgICAgICBhd2FpdCBkaWFsb2dDb250ZXh0LmJlZ2luRGlhbG9nKHRoaXMuaWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzdGFydFN0ZXAoc3RlcCkge1xyXG4gICAgICAgIC8vIFdhdGVyZmFsbFN0ZXAgYWx3YXlzIGZpbmlzaGVzIHdpdGggdGhlIGVuZCBvZiB0aGUgV2F0ZXJmYWxsIG9yIHdpdGggYW5vdGhlciBkaWFsb2c7IGhlcmUgaXQgaXMgYSBQcm9tcHQgRGlhbG9nLlxyXG4gICAgICAgIC8vIFJ1bm5pbmcgYSBwcm9tcHQgaGVyZSBtZWFucyB0aGUgbmV4dCBXYXRlcmZhbGxTdGVwIHdpbGwgYmUgcnVuIHdoZW4gdGhlIHVzZXIncyByZXNwb25zZSBpcyByZWNlaXZlZC5cclxuICAgICAgICBjb25zdCBtc2cgPSBzdGVwLm9wdGlvbnMucmVzdGFydE1zZyA/IHN0ZXAub3B0aW9ucy5yZXN0YXJ0TXNnIDogJ1doYXQgY2FuIEkgZG8gZm9yIHlvdT8nO1xyXG4gICAgICAgIHJldHVybiBhd2FpdCBzdGVwLnByb21wdChDSE9JQ0VfUFJPTVBULCB7XHJcbiAgICAgICAgICAgIHByb21wdDogbXNnLFxyXG4gICAgICAgICAgICBjaG9pY2VzOiBDaG9pY2VGYWN0b3J5LnRvQ2hvaWNlcyhbJ2FzayBhIHF1ZXN0aW9uJywgJ3Byb2Nlc3MgYSBkb2N1bWVudCcsICwgJ3JlY29nbml6ZSBhbiBpbWFnZSddKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGNob29zZVN0ZXAoc3RlcCkge1xyXG4gICAgICAgIGNvbnN0IGNob2ljZSA9IHN0ZXAucmVzdWx0LnZhbHVlO1xyXG4gICAgICAgIGlmIChjaG9pY2UgPT0gJ2FzayBhIHF1ZXN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5iZWdpbkRpYWxvZyhBTlNXRVJfRElBTE9HKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY2hvaWNlID09ICdwcm9jZXNzIGEgZG9jdW1lbnQnKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9tcHRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAnUGxlYXNlIGF0dGFjaCBhIGRvY3VtZW50IGluIHBkZi4nLFxyXG4gICAgICAgICAgICAgICAgcmV0cnlQcm9tcHQ6ICdUaGF0IHdhcyBub3QgYSBkb2N1bWVudCB0aGF0IEkgY2FuIGhlbHAsIHBsZWFzZSB0cnkgYWdhaW4uJ1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAucHJvbXB0KEFUVEFDSE1FTlRfUFJPTVBULCBwcm9tcHRPcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9tcHRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAnUGxlYXNlIGF0dGFjaCBhbiBpbWFnZS4nLFxyXG4gICAgICAgICAgICAgICAgcmV0cnlQcm9tcHQ6ICdUaGF0IHdhcyBub3QgYW4gaW1hZ2UgdGhhdCBJIGNhbiBoZWxwLCBwbGVhc2UgdHJ5IGFnYWluLidcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzdGVwLnByb21wdChBVFRBQ0hNRU5UX1BST01QVCwgcHJvbXB0T3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBkb2NTdGVwKHN0ZXApIHtcclxuICAgICAgICBpZiAoc3RlcC5yZXN1bHQgJiYgc3RlcC5yZXN1bHRbMF0uY29udGVudFVybCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzdGVwLnJlc3VsdFswXS5jb250ZW50VHlwZSk7XHJcbiAgICAgICAgICAgIHZhciB0eXBlID0gc3RlcC5yZXN1bHRbMF0uY29udGVudFR5cGU7XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnYXBwbGljYXRpb24vcGRmJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhdGggPSBhd2FpdCB0aGlzLmhhbmRsZUluY29taW5nQXR0YWNobWVudChzdGVwLmNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BhdGg6ICcgKyBwYXRoKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHN0ZXAuY29udGV4dC5zZW5kQWN0aXZpdHkoJ1Byb2Nlc3NpbmcgdGhlIGRvY3VtZW50LCBwbGVhc2Ugd2FpdCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlcV9yZXN1bHRzID0gYXdhaXQgdGhpcy5zZW5kUmVxKHBhdGgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAuYmVnaW5EaWFsb2coRE9DX0RJQUxPRywgeyBzdW06IHJlcV9yZXN1bHRzWzBdLCBxdWVyeTogcmVxX3Jlc3VsdHNbMV0sIGZpbGVwYXRoOiBwYXRoIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVJbmNvbWluZ0F0dGFjaG1lbnQoc3RlcC5jb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KCdNb3JlIGZ1bmN0aW9ucyB0byBiZSB1cGRhdGluZy4uLicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5uZXh0KClcclxuICAgIH1cclxuXHJcblxyXG4gICAgYXN5bmMgcmVwZWF0U3RlcChzdGVwKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAucmVwbGFjZURpYWxvZyh0aGlzLmluaXRpYWxEaWFsb2dJZCwgeyByZXN0YXJ0TXNnOiAnV2hhdCBlbHNlIGNhbiBJIGRvIGZvciB5b3U/JyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzZW5kUmVxKHBhdGgpIHtcclxuICAgICAgICB2YXIgZm9ybTEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICBmb3JtMS5hcHBlbmQoXCJmaWxlXCIsIGZzZS5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpKTtcclxuICAgICAgICB2YXIgZm9ybTIgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICBmb3JtMi5hcHBlbmQoXCJmaWxlXCIsIGZzZS5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcUFyciA9IFtheGlvcyh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgICAgIHVybDogXCJodHRwczovL3RleHRzdW1hcGkuYXp1cmV3ZWJzaXRlcy5uZXQvYXBpL3RleHRzdW1hcGlcIixcclxuICAgICAgICAgICAgZGF0YTogZm9ybTEsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGZvcm0xLmdldEhlYWRlcnMoKVxyXG4gICAgICAgIH0pLCBheGlvcyh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgICAgIHVybDogXCJodHRwOi8vNTEuMTEuMTgyLjU6NTAwMFwiLFxyXG4gICAgICAgICAgICBkYXRhOiBmb3JtMixcclxuICAgICAgICAgICAgaGVhZGVyczogZm9ybTIuZ2V0SGVhZGVycygpXHJcbiAgICAgICAgfSldO1xyXG4gICAgICAgIHZhciBvdXRwdXQgPSBbXTtcclxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQocmVxQXJyKS50aGVuKHJlc3VsdHMgPT4ge1xyXG4gICAgICAgICAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cocmVzdWx0LnN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PSAnZnVsZmlsbGVkJykge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHJlc3VsdC52YWx1ZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdmaXJzdDogJytyZXN1bHQudmFsdWUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcIuWujOaIkOWVpu+8gVwiKTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKG91dHB1dCk7XHJcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBoYW5kbGVJbmNvbWluZ0F0dGFjaG1lbnQodHVybkNvbnRleHQpIHtcclxuICAgICAgICAvLyBQcmVwYXJlIFByb21pc2VzIHRvIGRvd25sb2FkIGVhY2ggYXR0YWNobWVudCBhbmQgdGhlbiBleGVjdXRlIGVhY2ggUHJvbWlzZS5cclxuICAgICAgICBjb25zdCBwcm9taXNlcyA9IGF3YWl0IHR1cm5Db250ZXh0LmFjdGl2aXR5LmF0dGFjaG1lbnRzLm1hcCh0aGlzLmRvd25sb2FkQXR0YWNobWVudEFuZFdyaXRlKTtcclxuICAgICAgICBjb25zdCBzdWNjZXNzZnVsU2F2ZXMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XHJcblxyXG4gICAgICAgIC8vIFJlcGxpZXMgYmFjayB0byB0aGUgdXNlciB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHdoZXJlIHRoZSBhdHRhY2htZW50IGlzIHN0b3JlZCBvbiB0aGUgYm90J3Mgc2VydmVyLFxyXG4gICAgICAgIC8vIGFuZCB3aGF0IHRoZSBuYW1lIG9mIHRoZSBzYXZlZCBmaWxlIGlzLlxyXG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJlcGx5Rm9yUmVjZWl2ZWRBdHRhY2htZW50cyhsb2NhbEF0dGFjaG1lbnREYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChsb2NhbEF0dGFjaG1lbnREYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBCZWNhdXNlIHRoZSBUdXJuQ29udGV4dCB3YXMgYm91bmQgdG8gdGhpcyBmdW5jdGlvbiwgdGhlIGJvdCBjYW4gY2FsbFxyXG4gICAgICAgICAgICAgICAgLy8gYFR1cm5Db250ZXh0LnNlbmRBY3Rpdml0eWAgdmlhIGB0aGlzLnNlbmRBY3Rpdml0eWA7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRBY3Rpdml0eShgQXR0YWNobWVudCBcIiR7bG9jYWxBdHRhY2htZW50RGF0YS5maWxlTmFtZX1cIiBgICtcclxuICAgICAgICAgICAgICAgICAgICBgaGFzIGJlZW4gcmVjZWl2ZWQuYCk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zZW5kQWN0aXZpdHkoJ0F0dGFjaG1lbnQgd2FzIG5vdCBzdWNjZXNzZnVsbHkgc2F2ZWQgdG8gZGlzay4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxBdHRhY2htZW50RGF0YS5sb2NhbFBhdGhcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFByZXBhcmUgUHJvbWlzZXMgdG8gcmVwbHkgdG8gdGhlIHVzZXIgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCBzYXZlZCBhdHRhY2htZW50cy5cclxuICAgICAgICAvLyBUaGUgY3VycmVudCBUdXJuQ29udGV4dCBpcyBib3VuZCBzbyBgcmVwbHlGb3JSZWNlaXZlZEF0dGFjaG1lbnRzYCBjYW4gYWxzbyBzZW5kIHJlcGxpZXMuXHJcbiAgICAgICAgY29uc3QgcmVwbHlQcm9taXNlcyA9IHN1Y2Nlc3NmdWxTYXZlcy5tYXAocmVwbHlGb3JSZWNlaXZlZEF0dGFjaG1lbnRzLmJpbmQodHVybkNvbnRleHQpKTtcclxuICAgICAgICBsZXQgciA9IGF3YWl0IFByb21pc2UuYWxsKHJlcGx5UHJvbWlzZXMpLnRoZW4ocmVzdWx0ID0+IHJlc3VsdFswXSk7XHJcbiAgICAgICAgcmV0dXJuIHJcclxuXHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZG93bmxvYWRBdHRhY2htZW50QW5kV3JpdGUoYXR0YWNobWVudCkge1xyXG4gICAgICAgIHZhciBuYW1lID0gJ3RleHQuJyArIGF0dGFjaG1lbnQuY29udGVudFR5cGUudG9TdHJpbmcoKS5zcGxpdCgnLycpWzFdO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKG5hbWUpO1xyXG4gICAgICAgIC8vIFJldHJpZXZlIHRoZSBhdHRhY2htZW50IHZpYSB0aGUgYXR0YWNobWVudCdzIGNvbnRlbnRVcmwuXHJcbiAgICAgICAgY29uc3QgdXJsID0gYXR0YWNobWVudC5jb250ZW50VXJsO1xyXG5cclxuICAgICAgICAvLyBMb2NhbCBmaWxlIHBhdGggZm9yIHRoZSBib3QgdG8gc2F2ZSB0aGUgYXR0YWNobWVudC5cclxuICAgICAgICBjb25zdCBsb2NhbEZpbGVOYW1lID0gcGF0aC5qb2luKF9fZGlybmFtZSwgbmFtZSk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIGFycmF5YnVmZmVyIGlzIG5lY2Vzc2FyeSBmb3IgaW1hZ2VzXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHVybCwgeyByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicgfSk7XHJcbiAgICAgICAgICAgIC8vIElmIHVzZXIgdXBsb2FkcyBKU09OIGZpbGUsIHRoaXMgcHJldmVudHMgaXQgZnJvbSBiZWluZyB3cml0dGVuIGFzIFwie1widHlwZVwiOlwiQnVmZmVyXCIsXCJkYXRhXCI6WzEyMywxMywxMCwzMiwzMiwzNCwxMDguLi5cIlxyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuaGVhZGVyc1snY29udGVudC10eXBlJ10gPT09ICdhcHBsaWNhdGlvbi9qc29uJykge1xyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UuZGF0YSwgKGtleSwgdmFsdWUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgJiYgdmFsdWUudHlwZSA9PT0gJ0J1ZmZlcicgPyBCdWZmZXIuZnJvbSh2YWx1ZS5kYXRhKSA6IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnMud3JpdGVGaWxlKGxvY2FsRmlsZU5hbWUsIHJlc3BvbnNlLmRhdGEsIChmc0Vycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZnNFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IGZzRXJyb3I7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiBubyBlcnJvciB3YXMgdGhyb3duIHdoaWxlIHdyaXRpbmcgdG8gZGlzaywgcmV0dXJuIHRoZSBhdHRhY2htZW50J3MgbmFtZVxyXG4gICAgICAgIC8vIGFuZCBsb2NhbEZpbGVQYXRoIGZvciB0aGUgcmVzcG9uc2UgYmFjayB0byB0aGUgdXNlci5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBmaWxlTmFtZTogYXR0YWNobWVudC5uYW1lLFxyXG4gICAgICAgICAgICBsb2NhbFBhdGg6IGxvY2FsRmlsZU5hbWVcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgYXN5bmMgcHJvbXB0VmFsaWRhdG9yKHByb21wdENvbnRleHQpIHtcclxuICAgICAgICBpZiAocHJvbXB0Q29udGV4dC5yZWNvZ25pemVkLnN1Y2NlZWRlZCkge1xyXG4gICAgICAgICAgICB2YXIgZG9jVHlwZSA9IHByb21wdENvbnRleHQub3B0aW9ucy5wcm9tcHQ7XHJcbiAgICAgICAgICAgIHZhciBhdHRhY2htZW50cyA9IHByb21wdENvbnRleHQucmVjb2duaXplZC52YWx1ZTtcclxuICAgICAgICAgICAgdmFyIHZhbGlkRG9jID0gW107XHJcblxyXG4gICAgICAgICAgICBhdHRhY2htZW50cy5mb3JFYWNoKGF0dGFjaG1lbnQgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvY1R5cGUgPT09ICdQbGVhc2UgYXR0YWNoIGEgZG9jdW1lbnQgaW4gcGRmLicgJiYgYXR0YWNobWVudC5jb250ZW50VHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3BkZicpIHsgLy98fCBhdHRhY2htZW50LmNvbnRlbnRUeXBlID09PSAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnfHwgYXR0YWNobWVudC5jb250ZW50VHlwZSA9PT0gJ2FwcGxpY2F0aW9uL21zd29yZCdcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZERvYy5wdXNoKGF0dGFjaG1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZG9jVHlwZSA9PT0gJ1BsZWFzZSBhdHRhY2ggYW4gaW1hZ2UuJyAmJiAoYXR0YWNobWVudC5jb250ZW50VHlwZSA9PT0gJ2ltYWdlL2pwZWcnIHx8IGF0dGFjaG1lbnQuY29udGVudFR5cGUgPT09ICdpbWFnZS9wbmcnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbGlkRG9jLnB1c2goYXR0YWNobWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcHJvbXB0Q29udGV4dC5yZWNvZ25pemVkLnZhbHVlID0gdmFsaWREb2M7XHJcblxyXG4gICAgICAgICAgICAvLyBJZiBub25lIG9mIHRoZSBhdHRhY2htZW50cyBhcmUgdmFsaWQgaW1hZ2VzLCB0aGUgcmV0cnkgcHJvbXB0IHNob3VsZCBiZSBzZW50LlxyXG4gICAgICAgICAgICByZXR1cm4gISF2YWxpZERvYy5sZW5ndGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgcHJvbXB0Q29udGV4dC5jb250ZXh0LnNlbmRBY3Rpdml0eSgnTm8gYXR0YWNobWVudHMgcmVjZWl2ZWQuJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBXZSBjYW4gcmV0dXJuIHRydWUgZnJvbSBhIHZhbGlkYXRvciBmdW5jdGlvbiBldmVuIGlmIFJlY29nbml6ZWQuU3VjY2VlZGVkIGlzIGZhbHNlLlxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cy5NYWluRGlhbG9nID0gTWFpbkRpYWxvZzsiXX0=