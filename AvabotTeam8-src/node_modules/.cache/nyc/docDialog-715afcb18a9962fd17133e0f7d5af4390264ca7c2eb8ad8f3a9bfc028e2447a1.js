function cov_1boptpdvjn(){var path="/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/docDialog.js";var hash="231093c2cda572920567a5e13f3ba3721cefd0a9";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/docDialog.js",statementMap:{"0":{start:{line:4,column:14},end:{line:4,column:30}},"1":{start:{line:5,column:86},end:{line:5,column:115}},"2":{start:{line:6,column:19},end:{line:6,column:31}},"3":{start:{line:7,column:25},end:{line:7,column:43}},"4":{start:{line:8,column:20},end:{line:8,column:33}},"5":{start:{line:9,column:22},end:{line:9,column:37}},"6":{start:{line:14,column:8},end:{line:14,column:26}},"7":{start:{line:15,column:8},end:{line:15,column:29}},"8":{start:{line:16,column:8},end:{line:16,column:22}},"9":{start:{line:17,column:8},end:{line:17,column:23}},"10":{start:{line:18,column:8},end:{line:18,column:24}},"11":{start:{line:19,column:8},end:{line:19,column:27}},"12":{start:{line:21,column:8},end:{line:21,column:52}},"13":{start:{line:22,column:8},end:{line:22,column:56}},"14":{start:{line:23,column:8},end:{line:27,column:12}},"15":{start:{line:29,column:8},end:{line:29,column:48}},"16":{start:{line:33,column:8},end:{line:49,column:9}},"17":{start:{line:34,column:12},end:{line:37,column:15}},"18":{start:{line:40,column:12},end:{line:40,column:84}},"19":{start:{line:41,column:12},end:{line:41,column:92}},"20":{start:{line:42,column:12},end:{line:42,column:88}},"21":{start:{line:43,column:12},end:{line:43,column:104}},"22":{start:{line:44,column:12},end:{line:44,column:39}},"23":{start:{line:45,column:12},end:{line:48,column:15}},"24":{start:{line:53,column:8},end:{line:53,column:39}},"25":{start:{line:54,column:23},end:{line:54,column:40}},"26":{start:{line:55,column:8},end:{line:94,column:9}},"27":{start:{line:56,column:12},end:{line:61,column:13}},"28":{start:{line:57,column:16},end:{line:57,column:58}},"29":{start:{line:60,column:16},end:{line:60,column:73}},"30":{start:{line:64,column:13},end:{line:94,column:9}},"31":{start:{line:65,column:12},end:{line:81,column:13}},"32":{start:{line:66,column:16},end:{line:76,column:17}},"33":{start:{line:67,column:28},end:{line:67,column:30}},"34":{start:{line:68,column:20},end:{line:70,column:23}},"35":{start:{line:69,column:24},end:{line:69,column:34}},"36":{start:{line:71,column:20},end:{line:71,column:35}},"37":{start:{line:72,column:20},end:{line:72,column:55}},"38":{start:{line:75,column:20},end:{line:75,column:63}},"39":{start:{line:80,column:16},end:{line:80,column:76}},"40":{start:{line:83,column:13},end:{line:94,column:9}},"41":{start:{line:84,column:12},end:{line:89,column:13}},"42":{start:{line:85,column:16},end:{line:85,column:91}},"43":{start:{line:88,column:16},end:{line:88,column:83}},"44":{start:{line:93,column:12},end:{line:93,column:42}},"45":{start:{line:96,column:8},end:{line:96,column:109}},"46":{start:{line:100,column:23},end:{line:100,column:34}},"47":{start:{line:101,column:8},end:{line:101,column:45}},"48":{start:{line:102,column:21},end:{line:106,column:10}},"49":{start:{line:103,column:19},end:{line:103,column:83}},"50":{start:{line:105,column:12},end:{line:105,column:31}},"51":{start:{line:107,column:8},end:{line:107,column:48}},"52":{start:{line:108,column:8},end:{line:108,column:109}},"53":{start:{line:127,column:8},end:{line:127,column:21}},"54":{start:{line:130,column:8},end:{line:130,column:23}},"55":{start:{line:133,column:8},end:{line:133,column:22}},"56":{start:{line:137,column:0},end:{line:137,column:37}},"57":{start:{line:138,column:0},end:{line:138,column:39}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:4},end:{line:13,column:5}},loc:{start:{line:13,column:24},end:{line:30,column:5}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:32,column:4},end:{line:32,column:5}},loc:{start:{line:32,column:33},end:{line:50,column:5}},line:32},"2":{name:"(anonymous_2)",decl:{start:{line:52,column:4},end:{line:52,column:5}},loc:{start:{line:52,column:25},end:{line:97,column:5}},line:52},"3":{name:"(anonymous_3)",decl:{start:{line:68,column:38},end:{line:68,column:39}},loc:{start:{line:68,column:46},end:{line:70,column:21}},line:68},"4":{name:"(anonymous_4)",decl:{start:{line:99,column:4},end:{line:99,column:5}},loc:{start:{line:99,column:27},end:{line:109,column:5}},line:99},"5":{name:"(anonymous_5)",decl:{start:{line:103,column:14},end:{line:103,column:15}},loc:{start:{line:103,column:19},end:{line:103,column:83}},line:103},"6":{name:"(anonymous_6)",decl:{start:{line:104,column:15},end:{line:104,column:16}},loc:{start:{line:104,column:32},end:{line:106,column:9}},line:104},"7":{name:"(anonymous_7)",decl:{start:{line:126,column:4},end:{line:126,column:5}},loc:{start:{line:126,column:13},end:{line:128,column:5}},line:126},"8":{name:"(anonymous_8)",decl:{start:{line:129,column:4},end:{line:129,column:5}},loc:{start:{line:129,column:13},end:{line:131,column:5}},line:129},"9":{name:"(anonymous_9)",decl:{start:{line:132,column:4},end:{line:132,column:5}},loc:{start:{line:132,column:13},end:{line:134,column:5}},line:132}},branchMap:{"0":{loc:{start:{line:33,column:8},end:{line:49,column:9}},type:"if",locations:[{start:{line:33,column:8},end:{line:49,column:9}},{start:{line:33,column:8},end:{line:49,column:9}}],line:33},"1":{loc:{start:{line:40,column:23},end:{line:40,column:83}},type:"cond-expr",locations:[{start:{line:40,column:49},end:{line:40,column:72}},{start:{line:40,column:75},end:{line:40,column:83}}],line:40},"2":{loc:{start:{line:41,column:25},end:{line:41,column:91}},type:"cond-expr",locations:[{start:{line:41,column:53},end:{line:41,column:78}},{start:{line:41,column:81},end:{line:41,column:91}}],line:41},"3":{loc:{start:{line:42,column:24},end:{line:42,column:87}},type:"cond-expr",locations:[{start:{line:42,column:51},end:{line:42,column:75}},{start:{line:42,column:78},end:{line:42,column:87}}],line:42},"4":{loc:{start:{line:43,column:28},end:{line:43,column:103}},type:"cond-expr",locations:[{start:{line:43,column:59},end:{line:43,column:87}},{start:{line:43,column:90},end:{line:43,column:103}}],line:43},"5":{loc:{start:{line:55,column:8},end:{line:94,column:9}},type:"if",locations:[{start:{line:55,column:8},end:{line:94,column:9}},{start:{line:55,column:8},end:{line:94,column:9}}],line:55},"6":{loc:{start:{line:56,column:12},end:{line:61,column:13}},type:"if",locations:[{start:{line:56,column:12},end:{line:61,column:13}},{start:{line:56,column:12},end:{line:61,column:13}}],line:56},"7":{loc:{start:{line:64,column:13},end:{line:94,column:9}},type:"if",locations:[{start:{line:64,column:13},end:{line:94,column:9}},{start:{line:64,column:13},end:{line:94,column:9}}],line:64},"8":{loc:{start:{line:65,column:12},end:{line:81,column:13}},type:"if",locations:[{start:{line:65,column:12},end:{line:81,column:13}},{start:{line:65,column:12},end:{line:81,column:13}}],line:65},"9":{loc:{start:{line:66,column:16},end:{line:76,column:17}},type:"if",locations:[{start:{line:66,column:16},end:{line:76,column:17}},{start:{line:66,column:16},end:{line:76,column:17}}],line:66},"10":{loc:{start:{line:83,column:13},end:{line:94,column:9}},type:"if",locations:[{start:{line:83,column:13},end:{line:94,column:9}},{start:{line:83,column:13},end:{line:94,column:9}}],line:83},"11":{loc:{start:{line:84,column:12},end:{line:89,column:13}},type:"if",locations:[{start:{line:84,column:12},end:{line:89,column:13}},{start:{line:84,column:12},end:{line:89,column:13}}],line:84}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"231093c2cda572920567a5e13f3ba3721cefd0a9"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1boptpdvjn=function(){return actualCoverage;};}return actualCoverage;}cov_1boptpdvjn();// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
const axios=(cov_1boptpdvjn().s[0]++,require('axios'));const{ComponentDialog,ChoiceFactory,ChoicePrompt,TextPrompt,WaterfallDialog}=(cov_1boptpdvjn().s[1]++,require('botbuilder-dialogs'));const DOC_DIALOG=(cov_1boptpdvjn().s[2]++,'DOC_DIALOG');const WATERFALL_DIALOG=(cov_1boptpdvjn().s[3]++,'WATERFALL_DIALOG');const TEXT_PROMPT=(cov_1boptpdvjn().s[4]++,'TEXT_PROMPT');const CHOICE_PROMPT=(cov_1boptpdvjn().s[5]++,'CHOICE_PROMPT');class DocDialog extends ComponentDialog{constructor(mainId){cov_1boptpdvjn().f[0]++;cov_1boptpdvjn().s[6]++;super(DOC_DIALOG);cov_1boptpdvjn().s[7]++;this.mainId=mainId;cov_1boptpdvjn().s[8]++;this.sum='';cov_1boptpdvjn().s[9]++;this.form='';cov_1boptpdvjn().s[10]++;this.query='';cov_1boptpdvjn().s[11]++;this.filepath='';cov_1boptpdvjn().s[12]++;this.addDialog(new TextPrompt(TEXT_PROMPT));cov_1boptpdvjn().s[13]++;this.addDialog(new ChoicePrompt(CHOICE_PROMPT));cov_1boptpdvjn().s[14]++;this.addDialog(new WaterfallDialog(WATERFALL_DIALOG,[this.beginStep.bind(this),this.dealStep.bind(this),this.answerStep.bind(this)]));cov_1boptpdvjn().s[15]++;this.initialDialogId=WATERFALL_DIALOG;}async beginStep(stepContext){cov_1boptpdvjn().f[1]++;cov_1boptpdvjn().s[16]++;if(stepContext.options.restartMsg){cov_1boptpdvjn().b[0][0]++;cov_1boptpdvjn().s[17]++;return await stepContext.prompt(CHOICE_PROMPT,{prompt:'Anything else for the document?',choices:ChoiceFactory.toChoices(['summarize it','extract table','QnA about it','no'])});}else{cov_1boptpdvjn().b[0][1]++;cov_1boptpdvjn().s[18]++;this.sum=stepContext.options.sum?(cov_1boptpdvjn().b[1][0]++,stepContext.options.sum):(cov_1boptpdvjn().b[1][1]++,this.sum);cov_1boptpdvjn().s[19]++;this.query=stepContext.options.query?(cov_1boptpdvjn().b[2][0]++,stepContext.options.query):(cov_1boptpdvjn().b[2][1]++,this.query);cov_1boptpdvjn().s[20]++;this.form=stepContext.options.form?(cov_1boptpdvjn().b[3][0]++,stepContext.options.form):(cov_1boptpdvjn().b[3][1]++,this.form);cov_1boptpdvjn().s[21]++;this.filepath=stepContext.options.filepath?(cov_1boptpdvjn().b[4][0]++,stepContext.options.filepath):(cov_1boptpdvjn().b[4][1]++,this.filepath);cov_1boptpdvjn().s[22]++;console.log(this.filepath);cov_1boptpdvjn().s[23]++;return await stepContext.prompt(CHOICE_PROMPT,{prompt:'How can I help with the document?',choices:ChoiceFactory.toChoices(['summarize it','extract table','QnA about it'])});}}async dealStep(step){cov_1boptpdvjn().f[2]++;cov_1boptpdvjn().s[24]++;console.log(step.result.value);const choice=(cov_1boptpdvjn().s[25]++,step.result.value);cov_1boptpdvjn().s[26]++;if(choice=='summarize it'){cov_1boptpdvjn().b[5][0]++;cov_1boptpdvjn().s[27]++;if(this.sum){cov_1boptpdvjn().b[6][0]++;cov_1boptpdvjn().s[28]++;await step.context.sendActivity(this.sum);}else{cov_1boptpdvjn().b[6][1]++;cov_1boptpdvjn().s[29]++;await step.context.sendActivity('Summarization failed.');}}else{cov_1boptpdvjn().b[5][1]++;cov_1boptpdvjn().s[30]++;if(choice=='extract table'){cov_1boptpdvjn().b[7][0]++;cov_1boptpdvjn().s[31]++;if(this.form){cov_1boptpdvjn().b[8][0]++;cov_1boptpdvjn().s[32]++;if(this.form!='No Table Found'){cov_1boptpdvjn().b[9][0]++;var b=(cov_1boptpdvjn().s[33]++,'');cov_1boptpdvjn().s[34]++;this.form.forEach(line=>{cov_1boptpdvjn().f[3]++;cov_1boptpdvjn().s[35]++;b+=line;});cov_1boptpdvjn().s[36]++;console.log(b);cov_1boptpdvjn().s[37]++;await step.context.sendActivity(b);}else{cov_1boptpdvjn().b[9][1]++;cov_1boptpdvjn().s[38]++;await step.context.sendActivity(this.form);}}else{cov_1boptpdvjn().b[8][1]++;cov_1boptpdvjn().s[39]++;await step.context.sendActivity('Form recognition failed.');}}else{cov_1boptpdvjn().b[7][1]++;cov_1boptpdvjn().s[40]++;if(choice=='QnA about it'){cov_1boptpdvjn().b[10][0]++;cov_1boptpdvjn().s[41]++;if(this.query){cov_1boptpdvjn().b[11][0]++;cov_1boptpdvjn().s[42]++;return await step.prompt(TEXT_PROMPT,{prompt:'What is the question?'});}else{cov_1boptpdvjn().b[11][1]++;cov_1boptpdvjn().s[43]++;await step.context.sendActivity('QA system preprocessing failed.');}}else{cov_1boptpdvjn().b[10][1]++;cov_1boptpdvjn().s[44]++;return await step.endDialog();}}}cov_1boptpdvjn().s[45]++;return await step.replaceDialog(this.initialDialogId,{restartMsg:'What else can I do for you?'});}async answerStep(step){cov_1boptpdvjn().f[4]++;var question=(cov_1boptpdvjn().s[46]++,step.result);cov_1boptpdvjn().s[47]++;console.log('question: '+question);let answer=(cov_1boptpdvjn().s[48]++,await axios.get('http://20.77.57.60:5000?query='+question)//http://20.77.57.60:5000?query=Who is the founder of UCL?
.then(v=>{cov_1boptpdvjn().f[5]++;cov_1boptpdvjn().s[49]++;return'answer: '+v.data.answer+'\n'+'context: '+v.data.context;}).catch(function(error){cov_1boptpdvjn().f[6]++;cov_1boptpdvjn().s[50]++;console.log(error);}));cov_1boptpdvjn().s[51]++;await step.context.sendActivity(answer);cov_1boptpdvjn().s[52]++;return await step.replaceDialog(this.initialDialogId,{restartMsg:'What else can I do for you?'});}// async sumText(step) {
//     var form = new FormData();
//     const FileName = path.join(__dirname, 'text.pdf');
//     form.append("file", fse.createReadStream(FileName));
//     let r = await axios({
//         method: "post",
//         url: "https://textsumapi.azurewebsites.net/api/textsumapi",
//         data: form,
//         headers: form.getHeaders()
//     }).then(v => v.data);
//     console.log(r); // ok
//     await step.context.sendActivity(r);
// }
set a(n){cov_1boptpdvjn().f[7]++;cov_1boptpdvjn().s[53]++;this.sum=n;}set b(n){cov_1boptpdvjn().f[8]++;cov_1boptpdvjn().s[54]++;this.query=n;}set c(n){cov_1boptpdvjn().f[9]++;cov_1boptpdvjn().s[55]++;this.form=n;}}cov_1boptpdvjn().s[56]++;module.exports.DocDialog=DocDialog;cov_1boptpdvjn().s[57]++;module.exports.DOC_DIALOG=DOC_DIALOG;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRvY0RpYWxvZy5qcyJdLCJuYW1lcyI6WyJheGlvcyIsInJlcXVpcmUiLCJDb21wb25lbnREaWFsb2ciLCJDaG9pY2VGYWN0b3J5IiwiQ2hvaWNlUHJvbXB0IiwiVGV4dFByb21wdCIsIldhdGVyZmFsbERpYWxvZyIsIkRPQ19ESUFMT0ciLCJXQVRFUkZBTExfRElBTE9HIiwiVEVYVF9QUk9NUFQiLCJDSE9JQ0VfUFJPTVBUIiwiRG9jRGlhbG9nIiwiY29uc3RydWN0b3IiLCJtYWluSWQiLCJzdW0iLCJmb3JtIiwicXVlcnkiLCJmaWxlcGF0aCIsImFkZERpYWxvZyIsImJlZ2luU3RlcCIsImJpbmQiLCJkZWFsU3RlcCIsImFuc3dlclN0ZXAiLCJpbml0aWFsRGlhbG9nSWQiLCJzdGVwQ29udGV4dCIsIm9wdGlvbnMiLCJyZXN0YXJ0TXNnIiwicHJvbXB0IiwiY2hvaWNlcyIsInRvQ2hvaWNlcyIsImNvbnNvbGUiLCJsb2ciLCJzdGVwIiwicmVzdWx0IiwidmFsdWUiLCJjaG9pY2UiLCJjb250ZXh0Iiwic2VuZEFjdGl2aXR5IiwiYiIsImZvckVhY2giLCJsaW5lIiwiZW5kRGlhbG9nIiwicmVwbGFjZURpYWxvZyIsInF1ZXN0aW9uIiwiYW5zd2VyIiwiZ2V0IiwidGhlbiIsInYiLCJkYXRhIiwiY2F0Y2giLCJlcnJvciIsImEiLCJuIiwiYyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI4cFFBZVk7MkZBZlo7QUFDQTtBQUVBLEtBQU1BLENBQUFBLEtBQUssMEJBQUdDLE9BQU8sQ0FBQyxPQUFELENBQVYsQ0FBWCxDQUNBLEtBQU0sQ0FBRUMsZUFBRixDQUFtQkMsYUFBbkIsQ0FBa0NDLFlBQWxDLENBQWdEQyxVQUFoRCxDQUE0REMsZUFBNUQsMkJBQWdGTCxPQUFPLENBQUMsb0JBQUQsQ0FBdkYsQ0FBTixDQUNBLEtBQU1NLENBQUFBLFVBQVUsMEJBQUcsWUFBSCxDQUFoQixDQUNBLEtBQU1DLENBQUFBLGdCQUFnQiwwQkFBRyxrQkFBSCxD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eUJBU25CLE1BQU8sTUFBTVosQ0FBQUEsSUFBSSxDQUFDVSxhQUFMLENBQW1CLEtBQUtuQixlQUF4QixDQUF5QyxDQUFFRyxVQUFVLENBQUUsNkJBQWQsQ0FBekMsQ0FBYixDQUNILENBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDSyxHQUFEeUIsQ0FBQUEsQ0FBQyxDQUFDQyxDQUFELENBQUksa0RBQ0wsS0FBS3RDLEdBQUwsQ0FBV3NDLENBQVgsQ0FDSCxDQUNJLEdBQURkLENBQUFBLENBQUMsQ0FBQ2MsQ0FBRCxDQUFJLGtEQUNMLEtBQUtwQyxLQUFMLENBQWFvQyxDQUFiLENBQ0gsQ0FDSSxHQUFEQyxDQUFBQSxDQUFDLENBQUNELENBQUQsQ0FBSSxrREFDTCxLQUFLckMsSUFBTCxDQUFZcUMsQ0FBWixDQUNILENBMUhtQyxDLHlCQTZIeENFLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlNUMsU0FBZixDQUEyQkEsU0FBM0IsQyx5QkFDQTJDLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlaEQsVUFBZixDQUE0QkEsVUFBNUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5cclxuY29uc3QgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpO1xyXG5jb25zdCB7IENvbXBvbmVudERpYWxvZywgQ2hvaWNlRmFjdG9yeSwgQ2hvaWNlUHJvbXB0LCBUZXh0UHJvbXB0LCBXYXRlcmZhbGxEaWFsb2cgfSA9IHJlcXVpcmUoJ2JvdGJ1aWxkZXItZGlhbG9ncycpO1xyXG5jb25zdCBET0NfRElBTE9HID0gJ0RPQ19ESUFMT0cnO1xyXG5jb25zdCBXQVRFUkZBTExfRElBTE9HID0gJ1dBVEVSRkFMTF9ESUFMT0cnO1xyXG5jb25zdCBURVhUX1BST01QVCA9ICdURVhUX1BST01QVCc7XHJcbmNvbnN0IENIT0lDRV9QUk9NUFQgPSAnQ0hPSUNFX1BST01QVCc7XHJcblxyXG5cclxuY2xhc3MgRG9jRGlhbG9nIGV4dGVuZHMgQ29tcG9uZW50RGlhbG9nIHtcclxuICAgIGNvbnN0cnVjdG9yKG1haW5JZCkge1xyXG4gICAgICAgIHN1cGVyKERPQ19ESUFMT0cpO1xyXG4gICAgICAgIHRoaXMubWFpbklkID0gbWFpbklkO1xyXG4gICAgICAgIHRoaXMuc3VtID0gJyc7XHJcbiAgICAgICAgdGhpcy5mb3JtID0gJyc7XHJcbiAgICAgICAgdGhpcy5xdWVyeSA9ICcnO1xyXG4gICAgICAgIHRoaXMuZmlsZXBhdGggPSAnJztcclxuXHJcbiAgICAgICAgdGhpcy5hZGREaWFsb2cobmV3IFRleHRQcm9tcHQoVEVYVF9QUk9NUFQpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgQ2hvaWNlUHJvbXB0KENIT0lDRV9QUk9NUFQpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgV2F0ZXJmYWxsRGlhbG9nKFdBVEVSRkFMTF9ESUFMT0csIFtcclxuICAgICAgICAgICAgdGhpcy5iZWdpblN0ZXAuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgdGhpcy5kZWFsU3RlcC5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICB0aGlzLmFuc3dlclN0ZXAuYmluZCh0aGlzKVxyXG4gICAgICAgIF0pKTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsRGlhbG9nSWQgPSBXQVRFUkZBTExfRElBTE9HO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGJlZ2luU3RlcChzdGVwQ29udGV4dCkge1xyXG4gICAgICAgIGlmIChzdGVwQ29udGV4dC5vcHRpb25zLnJlc3RhcnRNc2cpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXBDb250ZXh0LnByb21wdChDSE9JQ0VfUFJPTVBULCB7XHJcbiAgICAgICAgICAgICAgICBwcm9tcHQ6ICdBbnl0aGluZyBlbHNlIGZvciB0aGUgZG9jdW1lbnQ/JyxcclxuICAgICAgICAgICAgICAgIGNob2ljZXM6IENob2ljZUZhY3RvcnkudG9DaG9pY2VzKFsnc3VtbWFyaXplIGl0JywgJ2V4dHJhY3QgdGFibGUnLCAnUW5BIGFib3V0IGl0JywgJ25vJ10pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zdW0gPSBzdGVwQ29udGV4dC5vcHRpb25zLnN1bSA/IHN0ZXBDb250ZXh0Lm9wdGlvbnMuc3VtIDogdGhpcy5zdW07XHJcbiAgICAgICAgICAgIHRoaXMucXVlcnkgPSBzdGVwQ29udGV4dC5vcHRpb25zLnF1ZXJ5ID8gc3RlcENvbnRleHQub3B0aW9ucy5xdWVyeSA6IHRoaXMucXVlcnk7XHJcbiAgICAgICAgICAgIHRoaXMuZm9ybSA9IHN0ZXBDb250ZXh0Lm9wdGlvbnMuZm9ybSA/IHN0ZXBDb250ZXh0Lm9wdGlvbnMuZm9ybSA6IHRoaXMuZm9ybTtcclxuICAgICAgICAgICAgdGhpcy5maWxlcGF0aCA9IHN0ZXBDb250ZXh0Lm9wdGlvbnMuZmlsZXBhdGggPyBzdGVwQ29udGV4dC5vcHRpb25zLmZpbGVwYXRoIDogdGhpcy5maWxlcGF0aDtcclxuICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5maWxlcGF0aCk7XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzdGVwQ29udGV4dC5wcm9tcHQoQ0hPSUNFX1BST01QVCwge1xyXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAnSG93IGNhbiBJIGhlbHAgd2l0aCB0aGUgZG9jdW1lbnQ/JyxcclxuICAgICAgICAgICAgICAgIGNob2ljZXM6IENob2ljZUZhY3RvcnkudG9DaG9pY2VzKFsnc3VtbWFyaXplIGl0JywgJ2V4dHJhY3QgdGFibGUnLCAnUW5BIGFib3V0IGl0J10pXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBkZWFsU3RlcChzdGVwKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coc3RlcC5yZXN1bHQudmFsdWUpO1xyXG4gICAgICAgIGNvbnN0IGNob2ljZSA9IHN0ZXAucmVzdWx0LnZhbHVlO1xyXG4gICAgICAgIGlmIChjaG9pY2UgPT0gJ3N1bW1hcml6ZSBpdCcpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc3VtKSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KHRoaXMuc3VtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHN0ZXAuY29udGV4dC5zZW5kQWN0aXZpdHkoJ1N1bW1hcml6YXRpb24gZmFpbGVkLicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjaG9pY2UgPT0gJ2V4dHJhY3QgdGFibGUnKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmZvcm0pIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvcm0gIT0gJ05vIFRhYmxlIEZvdW5kJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mb3JtLmZvckVhY2gobGluZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGIgKz0gbGluZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhiKTtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KGIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KHRoaXMuZm9ybSk7ICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHN0ZXAuY29udGV4dC5zZW5kQWN0aXZpdHkoJ0Zvcm0gcmVjb2duaXRpb24gZmFpbGVkLicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNob2ljZSA9PSAnUW5BIGFib3V0IGl0Jykge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5xdWVyeSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAucHJvbXB0KFRFWFRfUFJPTVBULCB7IHByb21wdDogJ1doYXQgaXMgdGhlIHF1ZXN0aW9uPycgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KCdRQSBzeXN0ZW0gcHJlcHJvY2Vzc2luZyBmYWlsZWQuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5lbmREaWFsb2coKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBhd2FpdCBzdGVwLnJlcGxhY2VEaWFsb2codGhpcy5pbml0aWFsRGlhbG9nSWQsIHsgcmVzdGFydE1zZzogJ1doYXQgZWxzZSBjYW4gSSBkbyBmb3IgeW91PycgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgYW5zd2VyU3RlcChzdGVwKSB7XHJcbiAgICAgICAgdmFyIHF1ZXN0aW9uID0gc3RlcC5yZXN1bHQ7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ3F1ZXN0aW9uOiAnICsgcXVlc3Rpb24pO1xyXG4gICAgICAgIGxldCBhbnN3ZXIgPSBhd2FpdCBheGlvcy5nZXQoJ2h0dHA6Ly8yMC43Ny41Ny42MDo1MDAwP3F1ZXJ5PScrcXVlc3Rpb24pLy9odHRwOi8vMjAuNzcuNTcuNjA6NTAwMD9xdWVyeT1XaG8gaXMgdGhlIGZvdW5kZXIgb2YgVUNMP1xyXG4gICAgICAgIC50aGVuKHYgPT4gJ2Fuc3dlcjogJyArIHYuZGF0YS5hbnN3ZXIgKyAnXFxuJyArICdjb250ZXh0OiAnICsgdi5kYXRhLmNvbnRleHQpXHJcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYXdhaXQgc3RlcC5jb250ZXh0LnNlbmRBY3Rpdml0eShhbnN3ZXIpO1xyXG4gICAgICAgIHJldHVybiBhd2FpdCBzdGVwLnJlcGxhY2VEaWFsb2codGhpcy5pbml0aWFsRGlhbG9nSWQsIHsgcmVzdGFydE1zZzogJ1doYXQgZWxzZSBjYW4gSSBkbyBmb3IgeW91PycgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYXN5bmMgc3VtVGV4dChzdGVwKSB7XHJcbiAgICAvLyAgICAgdmFyIGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIC8vICAgICBjb25zdCBGaWxlTmFtZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsICd0ZXh0LnBkZicpO1xyXG4gICAgLy8gICAgIGZvcm0uYXBwZW5kKFwiZmlsZVwiLCBmc2UuY3JlYXRlUmVhZFN0cmVhbShGaWxlTmFtZSkpO1xyXG5cclxuICAgIC8vICAgICBsZXQgciA9IGF3YWl0IGF4aW9zKHtcclxuICAgIC8vICAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgIC8vICAgICAgICAgdXJsOiBcImh0dHBzOi8vdGV4dHN1bWFwaS5henVyZXdlYnNpdGVzLm5ldC9hcGkvdGV4dHN1bWFwaVwiLFxyXG4gICAgLy8gICAgICAgICBkYXRhOiBmb3JtLFxyXG4gICAgLy8gICAgICAgICBoZWFkZXJzOiBmb3JtLmdldEhlYWRlcnMoKVxyXG4gICAgLy8gICAgIH0pLnRoZW4odiA9PiB2LmRhdGEpO1xyXG5cclxuICAgIC8vICAgICBjb25zb2xlLmxvZyhyKTsgLy8gb2tcclxuICAgIC8vICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KHIpO1xyXG4gICAgLy8gfVxyXG4gICAgc2V0IGEobikge1xyXG4gICAgICAgIHRoaXMuc3VtID0gbjtcclxuICAgIH1cclxuICAgIHNldCBiKG4pIHtcclxuICAgICAgICB0aGlzLnF1ZXJ5ID0gbjtcclxuICAgIH1cclxuICAgIHNldCBjKG4pIHtcclxuICAgICAgICB0aGlzLmZvcm0gPSBuO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cy5Eb2NEaWFsb2cgPSBEb2NEaWFsb2c7XHJcbm1vZHVsZS5leHBvcnRzLkRPQ19ESUFMT0cgPSBET0NfRElBTE9HOyJdfQ==