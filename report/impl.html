<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>AvaBot | A chatbot that helps people work remotely</title>
    <meta
      name="description"
      content="AvaBot | A chatbot that helps people work remotely"
    />
    <meta name="keywords" content="ml, ai, nlp, ir" />
    <!-- Plugins CSS -->
    <link href="css/plugins.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="css/style.css" rel="stylesheet" />
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico" />
    <link rel="stylesheet" href="highlight/styles/atom-one-light.css" />
    <script src="highlight/highlight.pack.js"></script>
    <script>
      hljs.highlightAll();
    </script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <!-- Pre Loader -->
    <div class="page-wrapper">
      <!-- Preloader -->
      <div id="dvLoading"></div>
      <header class="main-header">
        <!--Header Top-->
        <section id="topbar" class="d-none d-lg-block">
          <div class="container clearfix">
            <div class="contact-info float-left">
              <i class="fa fa-home"></i>
              <a href="index.html">COMP0016-Team8: Avanade2 COVID19 changes</a>
            </div>
            <div class="social-links float-right">
              <a href="#" class="twitter"><i class="fa fa-github"></i></a>
              <a href="#" class="facebook"><i class="fa fa-youtube"></i></a>
              <a href="#" class="instagram"><i class="fa fa-wordpress"></i></a>
            </div>
          </div>
        </section>
        <!-- End Header Top -->
        <!-- Header Upper -->
        <div class="header-upper">
          <div class="auto-container">
            <div class="inner-container clearfix">
              <!--Info-->
              <div class="logo-outer">
                <div class="logo logo-1">
                  <a href="index.html">
                    <img
                      src="images/avanade.png"
                      height="70"
                      width="260"
                      alt=""
                    />
                  </a>
                </div>
              </div>
              <!--Nav Box-->
              <div class="nav-outer clearfix">
                <!--Mobile Navigation Toggler For Mobile-->
                <div class="mobile-nav-toggler">
                  <span class="icon flaticon-menu"></span>
                </div>
                <nav class="main-menu navbar-expand-md navbar-light">
                  <div class="navbar-header">
                    <!-- Toggle Button -->
                    <button
                      class="navbar-toggler"
                      type="button"
                      data-toggle="collapse"
                      data-target="#navbarSupportedContent"
                      aria-controls="navbarSupportedContent"
                      aria-expanded="false"
                      aria-label="Toggle navigation"
                    >
                      <span class="icon flaticon-menu"></span>
                    </button>
                  </div>
                  <div
                    class="collapse navbar-collapse clearfix"
                    id="navbarSupportedContent"
                  >
                    <ul class="navigation clearfix">
                      <li class="dropdown">
                        <a
                          href="javascript:void(0)"
                          onclick="window.open('index.html','_self')"
                          >home</a
                        >
                        <ul>
                          <li><a href="accourdions-tabs.html">Abstract</a></li>
                          <li><a href="typography.html">Features</a></li>
                          <li><a href="forms.html">Video</a></li>
                          <li><a href="buttons.html">Team Members</a></li>
                          <li><a href="grid.html">Project Timeline</a></li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a
                          href="javascript:void(0)"
                          onclick="window.open('require.html','_self')"
                          >Requirements</a
                        >
                        <ul>
                          <li>
                            <a href="accourdions-tabs.html"
                              >Project Background</a
                            >
                          </li>
                          <li><a href="typography.html">Project Goal</a></li>
                          <li>
                            <a href="forms.html">Requirement Gathering</a>
                          </li>
                          <li><a href="buttons.html">Personas</a></li>
                          <li><a href="grid.html">Use Cases</a></li>
                          <li><a href="icons.html">MOSCOW List</a></li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a
                          href="javascript:void(0)"
                          onclick="window.open('research.html','_self')"
                          >Research</a
                        >
                        <ul>
                          <li><a href="about-us.html">Project Review</a></li>
                          <li><a href="our-team.html">Technology Review</a></li>
                          <li><a href="faq.html">Technical Decisions</a></li>
                          <li><a href="gallery.html">References</a></li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a href="javascript:void(0)">HCI</a>
                        <ul>
                          <li><a href="services.html">Services</a></li>
                          <li>
                            <a href="service-details.html">Service Details</a>
                          </li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a
                          href="javascript:void(0)"
                          onclick="window.open('system.html','_self')"
                          >System Design</a
                        >
                        <ul>
                          <li><a href="blog.html">Blog</a></li>
                          <li><a href="blog-detail.html">Blog Detail</a></li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a
                          href="javascript:void(0)"
                          onclick="window.open('impl.html','_self')"
                          >Implementation</a
                        >
                        <ul>
                          <li><a href="blog.html">Blog</a></li>
                          <li><a href="blog-detail.html">Blog Detail</a></li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a
                          href="javascript:void(0)"
                          onclick="window.open('test.html','_self')"
                          >Testing</a
                        >
                        <ul>
                          <li><a href="blog.html">Blog</a></li>
                          <li><a href="blog-detail.html">Blog Detail</a></li>
                        </ul>
                      </li>
                      <li class="dropdown">
                        <a href="javascript:void(0)">evaluation</a>
                        <ul>
                          <li><a href="blog.html">Blog</a></li>
                          <li><a href="blog-detail.html">Blog Detail</a></li>
                        </ul>
                      </li>
                      <li><a href="append.html">Appendices</a></li>
                    </ul>
                  </div>
                </nav>
                <!-- Main Menu End-->
                <!-- Main Menu End-->
                <div class="outer-box clearfix"></div>
              </div>
            </div>
          </div>
        </div>
        <!--End Header Upper-->
        <!-- Mobile Menu  -->
        <div class="mobile-menu">
          <div class="menu-backdrop"></div>
          <div class="close-btn">
            <span class="icon far fa-window-close"></span>
          </div>
          <!--Here Menu Will Come Automatically Via Javascript / Same Menu as in Header-->
          <nav class="menu-box">
            <div class="nav-logo">
              <a href="index.html"
                ><img src="images/avanade.png" alt="" title=""
              /></a>
            </div>
            <ul class="navigation clearfix">
              <!--Keep This Empty / Menu will come through Javascript-->
            </ul>
          </nav>
        </div>
        <!-- End Mobile Menu -->
        <!-- Quote Section -->
      </header>
      <!-- End Main Header -->
      <!-- Page Title -->
      <div class="page-title-area">
        <div class="container">
          <div class="page-title-content">
            <h2>IMPLEMENTATION</h2>
            <ul>
              <li><a href="index.html">Home</a></li>
              <li><i class="ti-angle-right"></i></li>
              <li>Implementation</li>
            </ul>
          </div>
        </div>
      </div>
      <!-- End Page Title -->
      <!-- Start About Section -->
      <section class="tabs-sec inner-content-wrapper text-center">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-xl-10">
              <h4 class="mb-4">Bot Structure Implementation</h4>
              <!-- Bootstrap tabs-->
              <div class="tabs-custom tabs-horizontal tabs-line" id="tabs-1">
                <!-- Nav tabs-->
                <!-- Tab panes-->
                <div class="tab-content">
                  <h5>Tools & Dependencies<br /><br /></h5>
                  <div class="row row-no-gutter">
                    <div class="col-3">
                      <br />
                      <img src="images/bf.png" width="200" />
                      <p>
                        MS Bot Framework SDK is used for building up AvaBot.
                      </p>
                    </div>
                    <div class="col-3">
                      <img src="images/node.png" width="200" />
                      <p>
                        <br />The language for AvaBot structure and logic is
                        node.js
                      </p>
                    </div>
                    <div class="col-3">
                      <img src="images/rest.png" width="200" />
                      <p>
                        Restify is a Node.js web service framework for creating
                        web service for AvaBot.
                      </p>
                    </div>
                    <div class="col-3">
                      <br />
                      <img src="images/axios.png" width="200" />
                      <p>
                        Axios is a promise based HTTP client for node.js, with
                        which AvaBot can make http requests.
                      </p>
                    </div>
                  </div>
                  <h5><br /><br />Impl. Overview</h5>
                  <p><br />1. run AvaBot with a web service</p>
                  <p>
                    AvaBot as a web app needs to create a web service, which is
                    implemented by using Restify with a messaging endpoint. The
                    service extracts the authentication header and request
                    payload and forwards them to the Bot Adapter. The adapter
                    receives activities from the messaging endpoint and forwards
                    them to the bot.
                  </p>
                  <div>
                    <pre>
                      <code class="lang-javascript">
                        // Create HTTP server.
                        const server = restify.createServer();
                        server.listen(process.env.port || process.env.PORT || 3978, function() {
                            console.log(`\n${ server.name } listening to ${ server.url }.`);
                        });
                        // Listen for incoming requests.
                        server.post('/api/messages', (req, res) => {
                            adapter.processActivity(req, res, async (context) => {
                                // Route the message to the bot's main handler.
                                await bot.run(context);
                            });
                        });
                      </code>
                    </pre>
                  </div>
                  <p><br />2. how AvaBot interacts with user</p>
                  <p>
                    AvaBot implements the bot handler class, <code>ActivityHandler</code>,
                    which uses an event emitter and listener pattern. It has two
                    listener methods, the <code>onMessage()</code> registers a listener
                    in response to messages and calls the run method of the
                    bot’s dialog to start or continue the dialog, the
                    <code>onMembersAdded()</code> listener is active when a first member joins
                    the conversation. Each method ends by calling <code>next()</code> to
                    ensure that the next listener is run.
                  </p>
                  <div>
                    <pre>
                      <code class="lang-javascript">
                        class AvaBot extends ActivityHandler {
                          constructor(conversationState, userState, dialog) {
                            super();
                            ...
                            this.onMessage(async (context, next) => {
                              console.log('Running dialog with Message Activity.');
                                // Run the Dialog with the new message Activity.
                                await this.dialog.run(context, this.dialogState);
                                await next();
                            });
                            this.onMembersAdded(async (context, next) => {
                              const membersAdded = context.activity.membersAdded;
                              for (let cnt = 0; cnt < membersAdded.length; cnt++) {
                                  if (membersAdded[cnt].id == context.activity.recipient.id) {
                                      await this.sendSuggestedActions(context);
                                  }
                              }
                              await next();
                            });
                          }
                          ...
                      </code>
                    </pre>
                  </div>
                  <p><br />3. AvaBot's waterfall dialog</p>
                  <p>
                    AvaBot can talk with users interactively to perceive their
                    needs and serve their demands. It is implemented with
                    multi-turn and multi-branch conversation flows by creating
                    prompts and calling them from waterfall dialogs. It contains
                    3 dialogs, the <code>MainDialog</code> for users to choose which feature
                    to use and ask for necessary document uploading, the
                    <code>AnswerDialog</code> to do QnA, and the <code>DocDialog</code> for users to
                    obtain document processing results. Here is a piece of code
                    from the mainDialog class, showing how bot’s dialog jumps
                    from one step to the next:
                  </p>
                  <div class="row row-no-gutter">
                    <div class="col-6">
                      <div>
                        <pre>
                          <code class="lang-javascript">
    async startStep(step) {
  /* WaterfallStep always finishes with the end of the Waterfall or with another dialog; */
  /* Running a prompt here means the next WaterfallStep will be run when the user's response is received.*/
      const msg = step.options.restartMsg ? 
                  step.options.restartMsg : 
                  'What can I do for you?';
      return await step.prompt(CHOICE_PROMPT, {
        prompt: msg,
        choices: ChoiceFactory.toChoices([
          'ask a question', 
          'process a document', 
          'recognize an image'
        ])
      });
    }
    async chooseStep(step) {
      const choice = step.result.value;
      ...	
    }
                          </code>
                        </pre>
                      </div>
                    </div>
                    <div class="col-6 botsample1">
                      <img src="images/sample1.png" width="400px"/>
                    </div>
                  </div>
                  <p>
                    <br />4. how AvaBot receives document and sends for
                    processing
                  </p>
                  <p>
                    When the user chooses to process a document, AvaBot receives
                    it and saves it to disk, while forwarding the document to
                    document-processing APIs via HTTP POST request.
                  </p>
                  <div class="row row-no-gutter">
                    <div class="col-6">
                      <div>
                        <pre>
                          <code class="lang-javascript">
  async docStep(step) {
    if (step.result && step.result[0].contentUrl) {
      var type = step.result[0].contentType;
      var path = await this.handleIncomingAttachment(
        step.context);
      if (path) {
        await step.context.sendActivity(
          'Processing the document, please wait');
        var data = await this.sendReq(path);
        return await step.beginDialog(DOC_DIALOG, {
          sum: data[0], 
          query: data[1], 
          form: data[2], 
          filepath: path 
        });
      }
      ...	
                          </code>
                        </pre>
                      </div>
                    </div>
                    <div class="col-6 botsample1">
                      <img src="images/sample2.png" width="400px"/>
                    </div>
                  </div>
                  <p><br />5. how AvaBot makes http requests</p>
                  <p>
                    The received document will be sent to three APIs, where
                    TextSum API will return the summary result, QA-system API
                    will return the pre-processing status, and Form-Recog API
                    will return table data. To optimize the overall processing
                    time, we applied <code>Promised.allSettled()</code> method, which allows
                    the requests to be sent simultaneously and halts the dialog
                    until it has successfully obtained all the three results
                    regardless of status (Other similar methods like <code>Axios.all()</code>
                    would fail if any of the request failed).
                  </p>
                  <div>
                    <pre>
                      <code class="lang-javascript">
                              async sendReq(path) {
                                ...
                                let reqArr = [axios({
                                    method: "post",
                                    …
                                }), axios({
                                    method: "post",
                                    …
                                }), axios({
                                    method: "post",
                                    …
                                })];
                                var output = [];
                                await Promise.allSettled(reqArr).then(results => {
                                  results.forEach(result => {
                                    if (result.status == 'fulfilled') {
                                      output.push(result.value.data);
                                    } else {
                                      output.push(0);
                                    }
                                  })
                                })
                                return output;
                              }
                      </code>
                    </pre>
                  </div>
                  <p>
                    The processing results will be directed to <code>DocDialog</code> as the dialog branch begins, when the user will be asked whether
                    they want doc-summary, table data or to do doc-query. The
                    advantage of performing the requests before actually letting
                    users to choose which document processing features they
                    would like to utilize is that user only need to wait once at
                    this stage and then can quickly get processing results when
                    they ask for any of those rather than waiting for each of
                    the request to be performed if they want to experience
                    multiple features, even though they don’t, we can still
                    guarantee the overall waiting time is optimal.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="row justify-content-center">
            <div class="col-xl-10">
              <h4 class="mb-4">Question Answering Implementation</h4>
              <!-- Bootstrap tabs-->
              <div class="tabs-custom tabs-horizontal tabs-line" id="tabs-1">
                <!-- Nav tabs-->
                <!-- Tab panes-->
                <div class="tab-content">
                  <h5>Impl. Overview</h5>
                  <p><br />1. configure QnAMaker in AvaBot</p>
                  <p>
                    The question answering feature is implemented by using the
                    QnA Maker Azure service, which allows for quick
                    establishment of a natural conversational layer over FAQ
                    pages, support websites, product manuals, etc.. In
                    AnswerDialog, AvaBot uses the connection information
                    provided by the .env file to establish a connection to the
                    QnA Maker service: <code>this.qnaMaker</code>.
                  </p>
                  <pre><code>
                  class AnswerDialog extends ComponentDialog {
                    constructor() {
                      super(ANSWER_DIALOG);
                      try {
                        this.qnaMaker = new QnAMaker({
                          knowledgeBaseId: process.env.QnAKnowledgebaseId,
                          endpointKey: process.env.QnAEndpointKey,
                          host: process.env.QnAEndpointHostName
                        });
                      }
                    ...
                   </code></pre>

                  <p><br />2. get answer for a question</p>
                  <p>
                    After receiving the question from the user, AvaBot passes it
                    to the QnA Maker service's getAnswers method to get answers
                    from the knowledge base. If QnA Maker returns a response, it
                    will be sent back to the user.
                  </p>
                  <pre><code>
                  const qnaResults = await this.qnaMaker.getAnswers(stepContext.context);
                  var msg = '';
                  if (qnaResults[0]) {
                    msg = qnaResults[0].answer;
                  } else {
                    msg = 'No QnA Maker answers were found.';
                  }
                  </code></pre>
                  <p>The QnA Maker is able to
                    parse and interpret the question intent for one question
                    asked in different formats.</p>
                    <div class="row row-no-gutter">
                      <div class="col-12 onlycode">
                        <img src="images/sample3.png" width="600px"/>
                      </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row justify-content-center">
            <div class="col-xl-10">
              <h4 class="mb-4">Text Summarization Implementation</h4>
              <!-- Bootstrap tabs-->
              <div class="tabs-custom tabs-horizontal tabs-line" id="tabs-1">
                <!-- Nav tabs-->
                <!-- Tab panes-->
                <div class="tab-content">
                  <h5>Tools & Dependencies<br /><br /></h5>
                  <div class="row row-no-gutter">
                    <div class="col-4 firstpy">
                    <br>
                      <img src="images/python.png" width="220"/>
                      <p>
                        <br>The text-summary function is written in python.
                      </p>
                    </div>
                    <div class="col-4">
                      <img src="images/nltk.png" width="90" />
                      <p>
                        <br>NLTK: a python package for natural language processing
                      </p>
                    </div>
                    <div class="col-4">
                      <div class="pyLogo">
                        <img src="images/pypack.png" width="100"/>
                       <p>
                        <br>Sumy: a python module for automatic text summarization
                      </p></div>
                     
                    </div>
                  </div>
                  <h5><br /><br />Impl. Overview</h5>
                  <p><br />1. pre-process document</p>
                  <p>
                    The document-summary feature is implemented by using TextRank algorithm, referred to and originated from Sumy Python Module (<a
                      class="link-hover"
                      href="https://github.com/miso-belica"
                      target="_blank"
                      >miso belica</a
                    >,                     <a
                      class="link-hover"
                      href="https://github.com/kmkurn"
                      target="_blank"
                      >Kmkurn</a
                    > and                     <a
                      class="link-hover"
                      href="https://github.com/isarth"
                      target="_blank"
                      >Isarth</a
                    >).
Before the summarization, the document is pre-processed with text split into sentences, non-ascii characters removed, and stop-words cleared off.
</p>
<p><br />2. algorithm walk-through</p><p>TextRank is a graph-based ranking model for text processing. The vertices are the sentences in the text, and the edges between the vertices (sentences) are of a similarity weight of the two sentences, which is calculated by
                  </p>
                              <div class="row row-no-gutter">
                      <div class="col-5 formula">
                        <img src="images/sim.png" width="400px"/>
                      </div>
                      <div class="col-6">
                        <img src="images/pysim.png" width="700px"/>
                      </div>
                    </div>
                  <p>
                    <br>The vertex weight can thus be obtained as shown by the formula, where Wij is the similarity weight added to the corresponding edge that connects the two vertices, d is a damping factor usually set to 0.85 (<a
                      class="link-hover"
                      href="http://ilpubs.stanford.edu:8090/361/1/1998-8.pdf"
                      target="_blank"
                      >Brin and Page</a
                    >, 1998).
                  </p>
                  <div class="row row-no-gutter">
                      <div class="col-5 formula">
                        <img src="images/ws.png" width="400px"/>
                      </div>
                      <div class="col-6">
                        <img src="images/pyws.png" width="700px"/>
                      </div>
                    </div>
                  <p>
                    <br>The power_method manipulates the matrix to be a column stochastic matrix. Then the sentence rank is obtained by iteratively dot-producting the stochastic matrix with the rank matrix (initially as [1,1,…,1]) until the rank matrix converges, i.e., the dot-product result is similar to the rank matrix that produces it).
                  </p>
                  <div class="row row-no-gutter">
                      <div class="col-12 onlycode">
                        <img src="images/pm.png" width="600px"/>
                      </div>
                    </div>
                  <p>
                    <br />The sentences are matched with their corresponding ranks, where top-ranked ones are displayed to users. The number of sentences to be displayed is heuristically set to be proportional to the document length with the upper limit at 20.
                  </p>
                  <div class="row row-no-gutter">
                      <div class="col-12 onlycode">
                        <img src="images/sample4.png" width="750px"/>
                      </div>
                  </div>
                  <p><br><br><br></p>
              </div>
            </div>
          </div>
          <!---->>
          <div class="row justify-content-center">
            <div class="col-xl-10">
              <h4 class="mb-4">Table & Image Recognition Implementation</h4>
              <!-- Bootstrap tabs-->
              <div class="tabs-custom tabs-horizontal tabs-line" id="tabs-1">
                <!-- Nav tabs-->
                <!-- Tab panes-->
                <div class="tab-content">
                  <h5>Tools & Dependencies<br /><br /></h5>
                  <div class="row row-no-gutter">
                    <div class="col-6">
                      <img src="images/python.png" width="200" />
                      <p>
                      <br>
                        The table & image-recognition function was written in python.
                      </p>
                    </div>
                    <div class="col-6">
                      <img src="images/azurefr.png" width="90" />
                      <p>
                        <br />Azure Form Recognizer API was used to recognize forms from documents and images.í
                      </p>
                    </div>
                  </div>
                  <h5><br /><br />Impl. Overview</h5>
                  <p>
                   Among all types of images, we have particularly focused on the business-card model for now since it is one of the most commonly used image types for company employees. Here thus lifted the implementation for it as the example.
                  </p>
                  <p>1. configure the Form Recognizer client
                  </p>
                  <p>EndPoint and credential key are provided to establish a connection to the Form Recognizer service.</p>
                  <div>
                    <pre>
                      <code class="lang-python">
                  form_recognizer_client = FormRecognizerClient(ENDPOINT, AzureKeyCredential(KEY))
                      </code>
                    </pre>
                  </div>
                  <p><br />2. get the recognition results</p>
                  <p>
                    The recognition results for an image of a certain model is obtained by calling the corresponding recognizing method, in this case, <code>form_recognizer_client.begin_recognize_business_cards()</code> is called. Having secured the recognition results, all the possible fields are iterated by using <code>business_card.fields.get(INFO_FIELD)</code>, where available ones are collected, reformatted and returned.</p>
                  <div>
                    <pre>
                      <code class="lang-python">
                  def process(file_path):
                    with open(file_path, "rb") as card:
                      poller = form_recognizer_client.begin_recognize_business_cards(business_card=card, locale="en-GB")
                      business_cards = poller.result()
                    extractedInfo = []
                    ...
                    contact_names = business_card.fields.get("ContactNames")
                    if contact_names:
                      for contact_name in contact_names.value:
                        extractedInfo.append("Contact First Name: {}\n".format(contact_name.value["FirstName"].value))
                        extractedInfo.append("Contact First Name: {}\n".format(contact_name.value["LastName"].value))
                    company_names = business_card.fields.get("CompanyNames")
                    if company_names:
                      ...
                    ...

                    return extractedInfo
                      </code>
                    </pre>
                  </div>
                  <p><br />3. connect to AvaBot via http requests</p>
                  <p>
                    Every time a request is sent from AvaBot with the document provided by the user to the python function, which was deployed on Azure cloud, the <code>main()</code> method will generate and give back the recognition result in response.
                  </p>
                      <div>
                        <pre>
                        <code>
                  def main(req: func.HttpRequest) -> func.HttpResponse:
                    file = req.files.get("file")
                    ...
                    result = recogBusinessCard.process(file_path)
                    result_json = json.dumps(result)
                    return func.HttpResponse(result_json)
                          </code>
                        </pre>
                      </div>
                    <p>Here shows the demo of user requesting recognition of information from a business card: </p>
                    <div class="row row-no-gutter">
                      <div class="col-12 onlycode">
                        <img src="images/sample5.png" width="950px"/>
                      </div>
                    </div>  
                </div>
              </div>
            </div>
          </div>
        </div>


      <!-- QA system-->
      <!---->
          <div class="row justify-content-center">
            <div class="col-xl-10">
              <h4 class="mb-4">Question-Answering System</h4>
              <!-- Bootstrap tabs-->
              <div class="tabs-custom tabs-horizontal tabs-line" id="tabs-1">
                <!-- Nav tabs-->
                <!-- Tab panes-->
                <div class="tab-content">
                  <h5>Tools & Dependencies<br /><br /></h5>
                  <div class="row row-no-gutter">
                    <div class="col-4">
                      <img src="images/haystack.png" width="200" />
                      <p>
                      <br>
                        A open domain QA system framework
                      </p>
                    </div>
                    <div class="col-4">
                      <img src="images/gunicorn.png" width="100" />
                      <p>
                        <br />An application server to host the system
                      </p>
                    </div>
                    <div class="col-4">
                      <img src="images/nginx.png" width="100" />
                      <p>
                        <br/>Reverse Proxy to buffer the file transfering
                      </p>
                    </div>
                  </div>
                  <h5><br /><br />Impl. Overview</h5>
                  <p>
                   The implementation of the QA system is separated into two parts: document retrieval and natural-language question processing. 
                  </p>
                  <p><b>Document retrieval<br></b>
                  </p>
                  <p>When a POST request arrives, the program first pre-processes the text.<br>
 The preprocessing includes <br>
1.  Extracting the text from the file attached with the request to the Document object accepted by Haystack<br>
2.  Cleaning the text by removing numeric tables, header and footers that are repeated on each page, normalizing empty lines and white spaces<br>
3.  Splitting the text into smaller chunks to optimize retrieval 
</p>
                  <div>
                    <pre>
                      <code class="lang-python">
def file_upload(file):
    try:
        file_path = '/tmp/' + file.name + '_tmp'
        with open(file_path, "wb") as buffer:
            buffer.write(file.read())

        if file.filename.split(".")[-1].lower() == "pdf":
            pdf_converter = PDFToTextConverter(
                remove_numeric_tables=True, valid_languages=["en"]
            )
            document = pdf_converter.convert(file_path)
        elif file.filename.split(".")[-1].lower() == "txt":
            txt_converter = TextConverter(
                remove_numeric_tables=True, valid_languages=["en"],
            )
            document = txt_converter.convert(file_path)
        else:
            raise HTTPException(status_code=415, detail=f"Only .pdf and .txt file formats are supported.")

        document = {TEXT_FIELD_NAME: document["text"], "name": file.filename}

        preprocessor = PreProcessor(
            clean_whitespace=REMOVE_WHITESPACE,
            clean_header_footer=REMOVE_HEADER_FOOTER,
            clean_empty_lines=REMOVE_EMPTY_LINES,
            split_by=SPLIT_BY,
            split_length=SPLIT_LENGTH,
            split_overlap=SPLIT_OVERLAP,
            split_respect_sentence_boundary=SPLIT_RESPECT_SENTENCE_BOUNDARY,
        )

        documents = preprocessor.process(document)
                      </code>
                    </pre>
                  </div>
                  <p><br />After that, the document is sent to the document store for indexing and generating a pipeline. Pipeline sticks powerful building blocks together, which are retriever and reader in our case. We keep this object in the memory which will find answers when questions are given.  The QA model <code>deepset/roberta-base-squad2</code> is used here as it has a quick retrieving speed compared with the others. (I also listed several alternatives in the comment) We sacrifice a little accuracy to have a fast processing speed. Also, as we don't have a GPU on our virtual machine so we have turn the option off. This option will tell pytorch to stop using GPU acceleration.<br></p>
                    
                  <div>
                    <pre>
                      <code class="lang-python">
    retriever = ElasticsearchRetriever(document_store=document_store)
    reader = FARMReader(model_name_or_path="deepset/roberta-base-squad2", use_gpu=False, context_window_size=500)
    p = ExtractiveQAPipeline(reader, retriever)
                      </code>
                    </pre>
                  </div>
 
                  <p><br /><b> natural-language question processing<br> </b></p>
                  <p>
                    When a GET request is sent to the system, the query will be extracted from the http arguments. Key extraction is performed to identify the question type. "When", "Who","What" will refer to time, person and description respectively. This part is conducted by Haystack framework, what we do is simply send the question to the pipe and return back a few top-rated answers. <br>
Here is the pipeline structure: 

                  </p>
                  <div class="row row-no-gutter">
                    <div class="col-11">
                        <img src="images/pipeline_struct.png" width="300" />
                    </div>
                  </div>
                      
              <p><b> <br>Elasticseach<br> </b></p>
              <p>There are several options to start the ES on the machine. We run it by using docker image as a daemon as it is easy to configure. <br></p>

              <div>
                    <pre>
                      <code class="lang-bash">
    docker run -d -p 9200:9200 -e "discovery.type=single-node" elasticsearch:7.6.2
                      </code>
                    </pre>
                  </div>
              </div>

              <p><b> Nginx & Gunicorn<br> </b></p>
              <p>Gunicorn is using bio concurrency model, which means the worker process will be blocked when a file with large size is sent. As our machine has one-core only CPU, we set the number of worker processes to 2. Hence, it is likely to timeout a connection when several TCP connections flood in together, just because the worker processes are waiting for receiving large files. This is actually a famous disadvantage of Gunicorn.<br></p>

              <div>
                    <pre>
                      <code class="lang-python">
bind = "0.0.0.0:5000"
timeout = 120
loglevel = "debug"
preload = True
workers = 2
                      </code>
                    </pre>
              </div>
              <p><br>We then added a reverse proxy in front of our application server to get rid of this problem. The buffering reverse proxy will wait until it gets the entire request, then it will pass this request to the application server, which will just process it and deliver the response back to the reverse proxy, being free to receive new requests. <br></p>
              
              <div>
                    <pre>
                      <code class="lang-bash">
server {
    listen 80;
    server_name {DOMAIN_NAME};

    location / {
        include proxy_params;
        proxy_pass {FILE_PATH};
    }
}
                      </code>
                    </pre>
              </div>



              </div>

            </div>
          </div>
        </div>
      </section>

      


      <!-- Start Footer Area -->
      <footer class="footer_dark">
        <div class="footer_top">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <div class="medium_divider clearfix"></div>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-4 col-md-6 col-sm-12">
                <div class="widget">
                  <h6 class="widget_title">Site Info</h6>
                  <p>
                    This is the website for UCL Year2 2020-2021 COMP0016 Team8:
                    Avanade2 COVID19 changes, which introduces the team project
                    and contains all the portfolios.
                  </p>
                  <ul class="social_icons social_white">
                    <li>
                      <a href="#"
                        ><i class="fa fa-github" aria-hidden="true"></i
                      ></a>
                    </li>
                    <li>
                      <a href="#"
                        ><i class="fa fa-youtube" aria-hidden="true"></i
                      ></a>
                    </li>
                    <li>
                      <a href="#"
                        ><i class="fa fa-wordpress" aria-hidden="true"></i
                      ></a>
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-2 col-md-3 col-6">
                <div class="widget">
                  <h6 class="widget_title">Site Menu</h6>
                  <ul class="widget_links">
                    <li><a href="about-us.html">Home</a></li>
                    <li><a href="services.html">Requirements</a></li>
                    <li><a href="blog.html">Research</a></li>
                    <li><a href="gallery.html">Algorithms</a></li>
                    <li><a href="contact.html">Design</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-2 col-md-3 col-6">
                <div class="widget">
                  <h6 class="widget_title"><br /></h6>
                  <ul class="widget_links">
                    <li><a href="our-team.html">implementation</a></li>
                    <li><a href="faq.html">Testing</a></li>
                    <li><a href="error.html">evaluation</a></li>
                    <li><a href="typography.html">Appendices</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-4 col-md-12 col-sm-12">
                <div class="widget">
                  <h6 class="widget_title">Project Supporters</h6>
                  <img src="images/avanade.png" width="50%" /><br />
                  <img src="images/ucl.png" width="30%" />
                  <p>
                    A lot of thanks to our company partner Avanade and Mr.
                    Fergus Kidd especially.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="bottom_footer border-top-tran">
                <div class="row">
                  <div class="col-md-6">
                    <p class="mb-md-0 text-center text-md-left">
                      © 2020 All Rights
                      <a href="http://www.bootstrapmb.com/">Reserved</a> by UCL
                      TEAM8.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="waveWrapper">
          <div class="footer-wave waveTop"></div>
        </div>
      </footer>
    </div>
    <!-- End Footer Area -->
    <!-- jQuery Min JS -->
    <script src="js/jquery-min.js"></script>
    <!-- Popper Min JS -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap Min JS -->
    <script src="js/bootstrap.min.js"></script>
    <!-- Owl Carousel Min JS -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- Owl Plugins JS -->
    <script src="js/plugins.js"></script>
    <!-- Odometer min JS -->
    <script src="js/odometer.min.js"></script>
    <!-- Appear JS -->
    <script src="js/jquery.appear.js"></script>
    <!-- datepicker min JS -->
    <script src="js/datepicker.js"></script>
    <script src="js/datepicker.en.js"></script>
    <!--Fontawesome js -->
    <script src="js/fontawesome.js"></script>
    <!-- MagnificPopup JS -->
    <script src="js/jquery.magnific-popup.min.js"></script>
    <!-- Swiper Min JS -->
    <script src="js/swiper.min.js"></script>
    <!-- Venobox Min JS -->
    <script src="js/venobox.min.js"></script>
    <!-- Custom JS -->
    <script src="js/custom.js"></script>
  </body>
</html>
