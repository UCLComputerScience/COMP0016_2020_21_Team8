function cov_13uzh0bhr2(){var path="/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/mainDialog.js";var hash="2970cb85dbd1aa7de39ca26413fafe01cf69fd2f";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/mainDialog.js",statementMap:{"0":{start:{line:4,column:13},end:{line:4,column:28}},"1":{start:{line:5,column:14},end:{line:5,column:30}},"2":{start:{line:6,column:11},end:{line:6,column:24}},"3":{start:{line:7,column:12},end:{line:7,column:31}},"4":{start:{line:8,column:15},end:{line:8,column:35}},"5":{start:{line:19,column:4},end:{line:19,column:33}},"6":{start:{line:20,column:40},end:{line:20,column:65}},"7":{start:{line:21,column:34},end:{line:21,column:56}},"8":{start:{line:23,column:26},end:{line:23,column:45}},"9":{start:{line:24,column:22},end:{line:24,column:37}},"10":{start:{line:25,column:23},end:{line:25,column:39}},"11":{start:{line:26,column:25},end:{line:26,column:43}},"12":{start:{line:30,column:8},end:{line:30,column:28}},"13":{start:{line:32,column:8},end:{line:32,column:43}},"14":{start:{line:33,column:8},end:{line:33,column:60}},"15":{start:{line:34,column:8},end:{line:34,column:53}},"16":{start:{line:35,column:8},end:{line:35,column:56}},"17":{start:{line:36,column:8},end:{line:36,column:58}},"18":{start:{line:37,column:8},end:{line:37,column:86}},"19":{start:{line:39,column:8},end:{line:44,column:12}},"20":{start:{line:46,column:8},end:{line:46,column:48}},"21":{start:{line:56,column:26},end:{line:56,column:49}},"22":{start:{line:57,column:8},end:{line:57,column:28}},"23":{start:{line:59,column:30},end:{line:59,column:72}},"24":{start:{line:60,column:24},end:{line:60,column:60}},"25":{start:{line:61,column:8},end:{line:63,column:9}},"26":{start:{line:62,column:12},end:{line:62,column:53}},"27":{start:{line:69,column:20},end:{line:69,column:96}},"28":{start:{line:70,column:8},end:{line:73,column:11}},"29":{start:{line:77,column:23},end:{line:77,column:40}},"30":{start:{line:78,column:8},end:{line:96,column:9}},"31":{start:{line:79,column:12},end:{line:79,column:57}},"32":{start:{line:81,column:13},end:{line:96,column:9}},"33":{start:{line:82,column:32},end:{line:85,column:13}},"34":{start:{line:87,column:12},end:{line:87,column:71}},"35":{start:{line:90,column:32},end:{line:93,column:13}},"36":{start:{line:95,column:12},end:{line:95,column:71}},"37":{start:{line:101,column:8},end:{line:119,column:9}},"38":{start:{line:102,column:12},end:{line:102,column:52}},"39":{start:{line:103,column:23},end:{line:103,column:49}},"40":{start:{line:104,column:12},end:{line:114,column:13}},"41":{start:{line:105,column:27},end:{line:105,column:76}},"42":{start:{line:106,column:16},end:{line:106,column:45}},"43":{start:{line:107,column:16},end:{line:107,column:88}},"44":{start:{line:108,column:34},end:{line:108,column:58}},"45":{start:{line:109,column:16},end:{line:109,column:122}},"46":{start:{line:112,column:16},end:{line:112,column:66}},"47":{start:{line:113,column:16},end:{line:113,column:91}},"48":{start:{line:118,column:12},end:{line:118,column:113}},"49":{start:{line:125,column:8},end:{line:125,column:109}},"50":{start:{line:129,column:20},end:{line:129,column:34}},"51":{start:{line:130,column:8},end:{line:130,column:57}},"52":{start:{line:131,column:20},end:{line:131,column:34}},"53":{start:{line:132,column:8},end:{line:132,column:57}},"54":{start:{line:134,column:21},end:{line:144,column:11}},"55":{start:{line:145,column:21},end:{line:145,column:23}},"56":{start:{line:146,column:8},end:{line:158,column:10}},"57":{start:{line:147,column:12},end:{line:156,column:14}},"58":{start:{line:148,column:16},end:{line:148,column:43}},"59":{start:{line:149,column:16},end:{line:154,column:17}},"60":{start:{line:150,column:20},end:{line:150,column:51}},"61":{start:{line:151,column:20},end:{line:151,column:61}},"62":{start:{line:153,column:20},end:{line:153,column:35}},"63":{start:{line:160,column:8},end:{line:160,column:28}},"64":{start:{line:161,column:8},end:{line:161,column:28}},"65":{start:{line:162,column:8},end:{line:162,column:22}},"66":{start:{line:167,column:25},end:{line:167,column:100}},"67":{start:{line:168,column:32},end:{line:168,column:59}},"68":{start:{line:173,column:12},end:{line:181,column:13}},"69":{start:{line:176,column:16},end:{line:177,column:42}},"70":{start:{line:180,column:16},end:{line:180,column:90}},"71":{start:{line:182,column:12},end:{line:182,column:48}},"72":{start:{line:187,column:30},end:{line:187,column:96}},"73":{start:{line:188,column:16},end:{line:188,column:74}},"74":{start:{line:188,column:64},end:{line:188,column:73}},"75":{start:{line:189,column:8},end:{line:189,column:16}},"76":{start:{line:194,column:19},end:{line:194,column:76}},"77":{start:{line:195,column:8},end:{line:195,column:26}},"78":{start:{line:197,column:20},end:{line:197,column:41}},"79":{start:{line:200,column:30},end:{line:200,column:56}},"80":{start:{line:202,column:8},end:{line:219,column:9}},"81":{start:{line:204,column:29},end:{line:204,column:82}},"82":{start:{line:206,column:12},end:{line:210,column:13}},"83":{start:{line:207,column:16},end:{line:209,column:19}},"84":{start:{line:208,column:20},end:{line:208,column:94}},"85":{start:{line:211,column:12},end:{line:215,column:15}},"86":{start:{line:212,column:16},end:{line:214,column:17}},"87":{start:{line:213,column:20},end:{line:213,column:34}},"88":{start:{line:217,column:12},end:{line:217,column:33}},"89":{start:{line:218,column:12},end:{line:218,column:29}},"90":{start:{line:222,column:8},end:{line:225,column:10}},"91":{start:{line:231,column:8},end:{line:254,column:9}},"92":{start:{line:232,column:26},end:{line:232,column:54}},"93":{start:{line:233,column:30},end:{line:233,column:60}},"94":{start:{line:234,column:27},end:{line:234,column:29}},"95":{start:{line:236,column:12},end:{line:243,column:15}},"96":{start:{line:237,column:16},end:{line:242,column:17}},"97":{start:{line:238,column:20},end:{line:238,column:46}},"98":{start:{line:240,column:21},end:{line:242,column:17}},"99":{start:{line:241,column:20},end:{line:241,column:46}},"100":{start:{line:245,column:12},end:{line:245,column:54}},"101":{start:{line:248,column:12},end:{line:248,column:37}},"102":{start:{line:250,column:12},end:{line:250,column:99}},"103":{start:{line:253,column:12},end:{line:253,column:25}},"104":{start:{line:259,column:0},end:{line:259,column:39}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:29,column:4},end:{line:29,column:5}},loc:{start:{line:29,column:18},end:{line:47,column:5}},line:29},"1":{name:"(anonymous_1)",decl:{start:{line:55,column:4},end:{line:55,column:5}},loc:{start:{line:55,column:37},end:{line:64,column:5}},line:55},"2":{name:"(anonymous_2)",decl:{start:{line:66,column:4},end:{line:66,column:5}},loc:{start:{line:66,column:26},end:{line:74,column:5}},line:66},"3":{name:"(anonymous_3)",decl:{start:{line:76,column:4},end:{line:76,column:5}},loc:{start:{line:76,column:27},end:{line:98,column:5}},line:76},"4":{name:"(anonymous_4)",decl:{start:{line:100,column:4},end:{line:100,column:5}},loc:{start:{line:100,column:24},end:{line:121,column:5}},line:100},"5":{name:"(anonymous_5)",decl:{start:{line:124,column:4},end:{line:124,column:5}},loc:{start:{line:124,column:27},end:{line:126,column:5}},line:124},"6":{name:"(anonymous_6)",decl:{start:{line:128,column:4},end:{line:128,column:5}},loc:{start:{line:128,column:24},end:{line:163,column:5}},line:128},"7":{name:"(anonymous_7)",decl:{start:{line:146,column:46},end:{line:146,column:47}},loc:{start:{line:146,column:57},end:{line:158,column:9}},line:146},"8":{name:"(anonymous_8)",decl:{start:{line:147,column:28},end:{line:147,column:29}},loc:{start:{line:147,column:38},end:{line:156,column:13}},line:147},"9":{name:"(anonymous_9)",decl:{start:{line:165,column:4},end:{line:165,column:5}},loc:{start:{line:165,column:48},end:{line:191,column:5}},line:165},"10":{name:"replyForReceivedAttachments",decl:{start:{line:172,column:23},end:{line:172,column:50}},loc:{start:{line:172,column:72},end:{line:183,column:9}},line:172},"11":{name:"(anonymous_11)",decl:{start:{line:188,column:54},end:{line:188,column:55}},loc:{start:{line:188,column:64},end:{line:188,column:73}},line:188},"12":{name:"(anonymous_12)",decl:{start:{line:193,column:4},end:{line:193,column:5}},loc:{start:{line:193,column:49},end:{line:226,column:5}},line:193},"13":{name:"(anonymous_13)",decl:{start:{line:207,column:58},end:{line:207,column:59}},loc:{start:{line:207,column:74},end:{line:209,column:17}},line:207},"14":{name:"(anonymous_14)",decl:{start:{line:211,column:55},end:{line:211,column:56}},loc:{start:{line:211,column:68},end:{line:215,column:13}},line:211},"15":{name:"(anonymous_15)",decl:{start:{line:230,column:4},end:{line:230,column:5}},loc:{start:{line:230,column:41},end:{line:255,column:5}},line:230},"16":{name:"(anonymous_16)",decl:{start:{line:236,column:32},end:{line:236,column:33}},loc:{start:{line:236,column:46},end:{line:243,column:13}},line:236}},branchMap:{"0":{loc:{start:{line:61,column:8},end:{line:63,column:9}},type:"if",locations:[{start:{line:61,column:8},end:{line:63,column:9}},{start:{line:61,column:8},end:{line:63,column:9}}],line:61},"1":{loc:{start:{line:69,column:20},end:{line:69,column:96}},type:"cond-expr",locations:[{start:{line:69,column:46},end:{line:69,column:69}},{start:{line:69,column:72},end:{line:69,column:96}}],line:69},"2":{loc:{start:{line:78,column:8},end:{line:96,column:9}},type:"if",locations:[{start:{line:78,column:8},end:{line:96,column:9}},{start:{line:78,column:8},end:{line:96,column:9}}],line:78},"3":{loc:{start:{line:81,column:13},end:{line:96,column:9}},type:"if",locations:[{start:{line:81,column:13},end:{line:96,column:9}},{start:{line:81,column:13},end:{line:96,column:9}}],line:81},"4":{loc:{start:{line:101,column:8},end:{line:119,column:9}},type:"if",locations:[{start:{line:101,column:8},end:{line:119,column:9}},{start:{line:101,column:8},end:{line:119,column:9}}],line:101},"5":{loc:{start:{line:101,column:12},end:{line:101,column:49}},type:"binary-expr",locations:[{start:{line:101,column:12},end:{line:101,column:23}},{start:{line:101,column:27},end:{line:101,column:49}}],line:101},"6":{loc:{start:{line:104,column:12},end:{line:114,column:13}},type:"if",locations:[{start:{line:104,column:12},end:{line:114,column:13}},{start:{line:104,column:12},end:{line:114,column:13}}],line:104},"7":{loc:{start:{line:149,column:16},end:{line:154,column:17}},type:"if",locations:[{start:{line:149,column:16},end:{line:154,column:17}},{start:{line:149,column:16},end:{line:154,column:17}}],line:149},"8":{loc:{start:{line:173,column:12},end:{line:181,column:13}},type:"if",locations:[{start:{line:173,column:12},end:{line:181,column:13}},{start:{line:173,column:12},end:{line:181,column:13}}],line:173},"9":{loc:{start:{line:206,column:12},end:{line:210,column:13}},type:"if",locations:[{start:{line:206,column:12},end:{line:210,column:13}},{start:{line:206,column:12},end:{line:210,column:13}}],line:206},"10":{loc:{start:{line:208,column:27},end:{line:208,column:93}},type:"cond-expr",locations:[{start:{line:208,column:62},end:{line:208,column:85}},{start:{line:208,column:88},end:{line:208,column:93}}],line:208},"11":{loc:{start:{line:208,column:27},end:{line:208,column:59}},type:"binary-expr",locations:[{start:{line:208,column:27},end:{line:208,column:32}},{start:{line:208,column:36},end:{line:208,column:59}}],line:208},"12":{loc:{start:{line:212,column:16},end:{line:214,column:17}},type:"if",locations:[{start:{line:212,column:16},end:{line:214,column:17}},{start:{line:212,column:16},end:{line:214,column:17}}],line:212},"13":{loc:{start:{line:231,column:8},end:{line:254,column:9}},type:"if",locations:[{start:{line:231,column:8},end:{line:254,column:9}},{start:{line:231,column:8},end:{line:254,column:9}}],line:231},"14":{loc:{start:{line:237,column:16},end:{line:242,column:17}},type:"if",locations:[{start:{line:237,column:16},end:{line:242,column:17}},{start:{line:237,column:16},end:{line:242,column:17}}],line:237},"15":{loc:{start:{line:237,column:20},end:{line:237,column:114}},type:"binary-expr",locations:[{start:{line:237,column:20},end:{line:237,column:66}},{start:{line:237,column:70},end:{line:237,column:114}}],line:237},"16":{loc:{start:{line:240,column:21},end:{line:242,column:17}},type:"if",locations:[{start:{line:240,column:21},end:{line:242,column:17}},{start:{line:240,column:21},end:{line:242,column:17}}],line:240},"17":{loc:{start:{line:240,column:25},end:{line:240,column:149}},type:"binary-expr",locations:[{start:{line:240,column:25},end:{line:240,column:62}},{start:{line:240,column:67},end:{line:240,column:106}},{start:{line:240,column:110},end:{line:240,column:148}}],line:240}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2970cb85dbd1aa7de39ca26413fafe01cf69fd2f"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_13uzh0bhr2=function(){return actualCoverage;};}return actualCoverage;}cov_13uzh0bhr2();// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
const path=(cov_13uzh0bhr2().s[0]++,require('path'));const axios=(cov_13uzh0bhr2().s[1]++,require('axios'));const fs=(cov_13uzh0bhr2().s[2]++,require('fs'));const fse=(cov_13uzh0bhr2().s[3]++,require("fs-extra"));var FormData=(cov_13uzh0bhr2().s[4]++,require("form-data"));const{AttachmentPrompt,ChoiceFactory,ChoicePrompt,ComponentDialog,ConfirmPrompt,DialogSet,DialogTurnStatus,TextPrompt,WaterfallDialog}=(cov_13uzh0bhr2().s[5]++,require('botbuilder-dialogs'));const{AnswerDialog,ANSWER_DIALOG}=(cov_13uzh0bhr2().s[6]++,require('./answerDialog'));const{DocDialog,DOC_DIALOG}=(cov_13uzh0bhr2().s[7]++,require('./docDialog'));const ATTACHMENT_PROMPT=(cov_13uzh0bhr2().s[8]++,'ATTACHMENT_PROMPT');const CHOICE_PROMPT=(cov_13uzh0bhr2().s[9]++,'CHOICE_PROMPT');const CONFIRM_PROMPT=(cov_13uzh0bhr2().s[10]++,'CONFIRM_PROMPT');const WATERFALL_DIALOG=(cov_13uzh0bhr2().s[11]++,'WATERFALL_DIALOG');class MainDialog extends ComponentDialog{constructor(){cov_13uzh0bhr2().f[0]++;cov_13uzh0bhr2().s[12]++;super('mainDialog');cov_13uzh0bhr2().s[13]++;this.addDialog(new AnswerDialog());cov_13uzh0bhr2().s[14]++;this.addDialog(new DocDialog(this.initialDialogId));cov_13uzh0bhr2().s[15]++;this.addDialog(new TextPrompt('TextPrompt'));cov_13uzh0bhr2().s[16]++;this.addDialog(new ChoicePrompt(CHOICE_PROMPT));cov_13uzh0bhr2().s[17]++;this.addDialog(new ConfirmPrompt(CONFIRM_PROMPT));cov_13uzh0bhr2().s[18]++;this.addDialog(new AttachmentPrompt(ATTACHMENT_PROMPT,this.promptValidator));cov_13uzh0bhr2().s[19]++;this.addDialog(new WaterfallDialog(WATERFALL_DIALOG,[this.startStep.bind(this),this.chooseStep.bind(this),this.docStep.bind(this),this.repeatStep.bind(this)]));cov_13uzh0bhr2().s[20]++;this.initialDialogId=WATERFALL_DIALOG;}/**
     * The run method handles the incoming activity (in the form of a TurnContext) and passes it through the dialog system.
     * If no dialog is active, it will start the default dialog.
     * @param {*} turnContext
     * @param {*} accessor
     */async run(turnContext,accessor){cov_13uzh0bhr2().f[1]++;const dialogSet=(cov_13uzh0bhr2().s[21]++,new DialogSet(accessor));cov_13uzh0bhr2().s[22]++;dialogSet.add(this);const dialogContext=(cov_13uzh0bhr2().s[23]++,await dialogSet.createContext(turnContext));const results=(cov_13uzh0bhr2().s[24]++,await dialogContext.continueDialog());cov_13uzh0bhr2().s[25]++;if(results.status===DialogTurnStatus.empty){cov_13uzh0bhr2().b[0][0]++;cov_13uzh0bhr2().s[26]++;await dialogContext.beginDialog(this.id);}else{cov_13uzh0bhr2().b[0][1]++;}}async startStep(step){cov_13uzh0bhr2().f[2]++;// WaterfallStep always finishes with the end of the Waterfall or with another dialog; here it is a Prompt Dialog.
// Running a prompt here means the next WaterfallStep will be run when the user's response is received.
const msg=(cov_13uzh0bhr2().s[27]++,step.options.restartMsg?(cov_13uzh0bhr2().b[1][0]++,step.options.restartMsg):(cov_13uzh0bhr2().b[1][1]++,'What can I do for you?'));cov_13uzh0bhr2().s[28]++;return await step.prompt(CHOICE_PROMPT,{prompt:msg,choices:ChoiceFactory.toChoices(['ask a question','process a document',,'recognize an image'])});}async chooseStep(step){cov_13uzh0bhr2().f[3]++;const choice=(cov_13uzh0bhr2().s[29]++,step.result.value);cov_13uzh0bhr2().s[30]++;if(choice=='ask a question'){cov_13uzh0bhr2().b[2][0]++;cov_13uzh0bhr2().s[31]++;return await step.beginDialog(ANSWER_DIALOG);}else{cov_13uzh0bhr2().b[2][1]++;cov_13uzh0bhr2().s[32]++;if(choice=='process a document'){cov_13uzh0bhr2().b[3][0]++;var promptOptions=(cov_13uzh0bhr2().s[33]++,{prompt:'Please attach a document in pdf.',retryPrompt:'That was not a document that I can help, please try again.'});cov_13uzh0bhr2().s[34]++;return await step.prompt(ATTACHMENT_PROMPT,promptOptions);}else{cov_13uzh0bhr2().b[3][1]++;var promptOptions=(cov_13uzh0bhr2().s[35]++,{prompt:'Please attach an image.',retryPrompt:'That was not an image that I can help, please try again.'});cov_13uzh0bhr2().s[36]++;return await step.prompt(ATTACHMENT_PROMPT,promptOptions);}}}async docStep(step){cov_13uzh0bhr2().f[4]++;cov_13uzh0bhr2().s[37]++;if((cov_13uzh0bhr2().b[5][0]++,step.result)&&(cov_13uzh0bhr2().b[5][1]++,step.result.length>0)){cov_13uzh0bhr2().b[4][0]++;cov_13uzh0bhr2().s[38]++;console.log(step.result[0].contentType);var type=(cov_13uzh0bhr2().s[39]++,step.result[0].contentType);cov_13uzh0bhr2().s[40]++;if(type==='application/pdf'){cov_13uzh0bhr2().b[6][0]++;var path=(cov_13uzh0bhr2().s[41]++,await this.handleIncomingAttachment(step.context));cov_13uzh0bhr2().s[42]++;console.log('path: '+path);cov_13uzh0bhr2().s[43]++;await step.context.sendActivity('Processing the document, please wait');var req_results=(cov_13uzh0bhr2().s[44]++,await this.sendReq(path));cov_13uzh0bhr2().s[45]++;return await step.beginDialog(DOC_DIALOG,{sum:req_results[0],query:req_results[1],filepath:path});}else{cov_13uzh0bhr2().b[6][1]++;cov_13uzh0bhr2().s[46]++;await this.handleIncomingAttachment(step.context);cov_13uzh0bhr2().s[47]++;return await step.context.sendActivity('More functions to be updating...');}}else{cov_13uzh0bhr2().b[4][1]++;cov_13uzh0bhr2().s[48]++;return await step.replaceDialog(this.initialDialogId,{restartMsg:'What else can I do for you?'});}}async repeatStep(step){cov_13uzh0bhr2().f[5]++;cov_13uzh0bhr2().s[49]++;return await step.replaceDialog(this.initialDialogId,{restartMsg:'What else can I do for you?'});}async sendReq(path){cov_13uzh0bhr2().f[6]++;var form1=(cov_13uzh0bhr2().s[50]++,new FormData());cov_13uzh0bhr2().s[51]++;form1.append("file",fse.createReadStream(path));var form2=(cov_13uzh0bhr2().s[52]++,new FormData());cov_13uzh0bhr2().s[53]++;form2.append("file",fse.createReadStream(path));let reqArr=(cov_13uzh0bhr2().s[54]++,[axios({method:"post",url:"https://textsumapi.azurewebsites.net/api/textsumapi",data:form1,headers:form1.getHeaders()}),axios({method:"post",url:"http://51.11.182.5:5000",data:form2,headers:form2.getHeaders()})]);var output=(cov_13uzh0bhr2().s[55]++,[]);cov_13uzh0bhr2().s[56]++;await Promise.allSettled(reqArr).then(results=>{cov_13uzh0bhr2().f[7]++;cov_13uzh0bhr2().s[57]++;results.forEach(result=>{cov_13uzh0bhr2().f[8]++;cov_13uzh0bhr2().s[58]++;console.log(result.status);cov_13uzh0bhr2().s[59]++;if(result.status=='fulfilled'){cov_13uzh0bhr2().b[7][0]++;cov_13uzh0bhr2().s[60]++;output.push(result.value.data);cov_13uzh0bhr2().s[61]++;console.log('first: '+result.value.data);}else{cov_13uzh0bhr2().b[7][1]++;cov_13uzh0bhr2().s[62]++;output.push(0);}});});cov_13uzh0bhr2().s[63]++;console.log("完成啦！");cov_13uzh0bhr2().s[64]++;console.log(output);cov_13uzh0bhr2().s[65]++;return output;}async handleIncomingAttachment(turnContext){cov_13uzh0bhr2().f[9]++;// Prepare Promises to download each attachment and then execute each Promise.
const promises=(cov_13uzh0bhr2().s[66]++,await turnContext.activity.attachments.map(this.downloadAttachmentAndWrite));const successfulSaves=(cov_13uzh0bhr2().s[67]++,await Promise.all(promises));// Replies back to the user with information about where the attachment is stored on the bot's server,
// and what the name of the saved file is.
async function replyForReceivedAttachments(localAttachmentData){cov_13uzh0bhr2().f[10]++;cov_13uzh0bhr2().s[68]++;if(localAttachmentData){cov_13uzh0bhr2().b[8][0]++;cov_13uzh0bhr2().s[69]++;// Because the TurnContext was bound to this function, the bot can call
// `TurnContext.sendActivity` via `this.sendActivity`;
await this.sendActivity(`Attachment "${localAttachmentData.fileName}" `+`has been received.`);}else{cov_13uzh0bhr2().b[8][1]++;cov_13uzh0bhr2().s[70]++;await this.sendActivity('Attachment was not successfully saved to disk.');}cov_13uzh0bhr2().s[71]++;return localAttachmentData.localPath;}// Prepare Promises to reply to the user with information about saved attachments.
// The current TurnContext is bound so `replyForReceivedAttachments` can also send replies.
const replyPromises=(cov_13uzh0bhr2().s[72]++,successfulSaves.map(replyForReceivedAttachments.bind(turnContext)));let r=(cov_13uzh0bhr2().s[73]++,await Promise.all(replyPromises).then(result=>{cov_13uzh0bhr2().f[11]++;cov_13uzh0bhr2().s[74]++;return result[0];}));cov_13uzh0bhr2().s[75]++;return r;}async downloadAttachmentAndWrite(attachment){cov_13uzh0bhr2().f[12]++;var name=(cov_13uzh0bhr2().s[76]++,'text.'+attachment.contentType.toString().split('/')[1]);cov_13uzh0bhr2().s[77]++;console.log(name);// Retrieve the attachment via the attachment's contentUrl.
const url=(cov_13uzh0bhr2().s[78]++,attachment.contentUrl);// Local file path for the bot to save the attachment.
const localFileName=(cov_13uzh0bhr2().s[79]++,path.join(__dirname,name));cov_13uzh0bhr2().s[80]++;try{// arraybuffer is necessary for images
const response=(cov_13uzh0bhr2().s[81]++,await axios.get(url,{responseType:'arraybuffer'}));// If user uploads JSON file, this prevents it from being written as "{"type":"Buffer","data":[123,13,10,32,32,34,108..."
cov_13uzh0bhr2().s[82]++;if(response.headers['content-type']==='application/json'){cov_13uzh0bhr2().b[9][0]++;cov_13uzh0bhr2().s[83]++;response.data=JSON.parse(response.data,(key,value)=>{cov_13uzh0bhr2().f[13]++;cov_13uzh0bhr2().s[84]++;return(cov_13uzh0bhr2().b[11][0]++,value)&&(cov_13uzh0bhr2().b[11][1]++,value.type==='Buffer')?(cov_13uzh0bhr2().b[10][0]++,Buffer.from(value.data)):(cov_13uzh0bhr2().b[10][1]++,value);});}else{cov_13uzh0bhr2().b[9][1]++;}cov_13uzh0bhr2().s[85]++;fs.writeFile(localFileName,response.data,fsError=>{cov_13uzh0bhr2().f[14]++;cov_13uzh0bhr2().s[86]++;if(fsError){cov_13uzh0bhr2().b[12][0]++;cov_13uzh0bhr2().s[87]++;throw fsError;}else{cov_13uzh0bhr2().b[12][1]++;}});}catch(error){cov_13uzh0bhr2().s[88]++;console.error(error);cov_13uzh0bhr2().s[89]++;return undefined;}// If no error was thrown while writing to disk, return the attachment's name
// and localFilePath for the response back to the user.
cov_13uzh0bhr2().s[90]++;return{fileName:attachment.name,localPath:localFileName};}async promptValidator(promptContext){cov_13uzh0bhr2().f[15]++;cov_13uzh0bhr2().s[91]++;if(promptContext.recognized.succeeded){cov_13uzh0bhr2().b[13][0]++;var docType=(cov_13uzh0bhr2().s[92]++,promptContext.options.prompt);var attachments=(cov_13uzh0bhr2().s[93]++,promptContext.recognized.value);var validDoc=(cov_13uzh0bhr2().s[94]++,[]);cov_13uzh0bhr2().s[95]++;attachments.forEach(attachment=>{cov_13uzh0bhr2().f[16]++;cov_13uzh0bhr2().s[96]++;if((cov_13uzh0bhr2().b[15][0]++,docType==='Please attach a document in pdf.')&&(cov_13uzh0bhr2().b[15][1]++,attachment.contentType==='application/pdf')){cov_13uzh0bhr2().b[14][0]++;cov_13uzh0bhr2().s[97]++;//|| attachment.contentType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'|| attachment.contentType === 'application/msword'
validDoc.push(attachment);}else{cov_13uzh0bhr2().b[14][1]++;cov_13uzh0bhr2().s[98]++;if((cov_13uzh0bhr2().b[17][0]++,docType==='Please attach an image.')&&((cov_13uzh0bhr2().b[17][1]++,attachment.contentType==='image/jpeg')||(cov_13uzh0bhr2().b[17][2]++,attachment.contentType==='image/png'))){cov_13uzh0bhr2().b[16][0]++;cov_13uzh0bhr2().s[99]++;validDoc.push(attachment);}else{cov_13uzh0bhr2().b[16][1]++;}}});cov_13uzh0bhr2().s[100]++;promptContext.recognized.value=validDoc;// If none of the attachments are valid images, the retry prompt should be sent.
cov_13uzh0bhr2().s[101]++;return!!validDoc.length;}else{cov_13uzh0bhr2().b[13][1]++;cov_13uzh0bhr2().s[102]++;await promptContext.context.sendActivity('No attachments received, please try again.');// We can return true from a validator function even if Recognized.Succeeded is false.
cov_13uzh0bhr2().s[103]++;return false;}}}cov_13uzh0bhr2().s[104]++;module.exports.MainDialog=MainDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW5EaWFsb2cuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJheGlvcyIsImZzIiwiZnNlIiwiRm9ybURhdGEiLCJBdHRhY2htZW50UHJvbXB0IiwiQ2hvaWNlRmFjdG9yeSIsIkNob2ljZVByb21wdCIsIkNvbXBvbmVudERpYWxvZyIsIkNvbmZpcm1Qcm9tcHQiLCJEaWFsb2dTZXQiLCJEaWFsb2dUdXJuU3RhdHVzIiwiVGV4dFByb21wdCIsIldhdGVyZmFsbERpYWxvZyIsIkFuc3dlckRpYWxvZyIsIkFOU1dFUl9ESUFMT0ciLCJEb2NEaWFsb2ciLCJET0NfRElBTE9HIiwiQVRUQUNITUVOVF9QUk9NUFQiLCJDSE9JQ0VfUFJPTVBUIiwiQ09ORklSTV9QUk9NUFQiLCJXQVRFUkZBTExfRElBTE9HIiwiTWFpbkRpYWxvZyIsImNvbnN0cnVjdG9yIiwiYWRkRGlhbG9nIiwiaW5pdGlhbERpYWxvZ0lkIiwicHJvbXB0VmFsaWRhdG9yIiwic3RhcnRTdGVwIiwiYmluZCIsImNob29zZVN0ZXAiLCJkb2NTdGVwIiwicmVwZWF0U3RlcCIsInJ1biIsInR1cm5Db250ZXh0IiwiYWNjZXNzb3IiLCJkaWFsb2dTZXQiLCJhZGQiLCJkaWFsb2dDb250ZXh0IiwiY3JlYXRlQ29udGV4dCIsInJlc3VsdHMiLCJjb250aW51ZURpYWxvZyIsInN0YXR1cyIsImVtcHR5IiwiYmVnaW5EaWFsb2ciLCJpZCIsInN0ZXAiLCJtc2ciLCJvcHRpb25zIiwicmVzdGFydE1zZyIsInByb21wdCIsImNob2ljZXMiLCJ0b0Nob2ljZXMiLCJjaG9pY2UiLCJyZXN1bHQiLCJ2YWx1ZSIsInByb21wdE9wdGlvbnMiLCJyZXRyeVByb21wdCIsImxlbmd0aCIsImNvbnNvbGUiLCJsb2ciLCJjb250ZW50VHlwZSIsInR5cGUiLCJoYW5kbGVJbmNvbWluZ0F0dGFjaG1lbnQiLCJjb250ZXh0Iiwic2VuZEFjdGl2aXR5IiwicmVxX3Jlc3VsdHMiLCJzZW5kUmVxIiwic3VtIiwicXVlcnkiLCJmaWxlcGF0aCIsInJlcGxhY2VEaWFsb2ciLCJmb3JtMSIsImFwcGVuZCIsImNyZWF0ZVJlYWRTdHJlYW0iLCJmb3JtMiIsInJlcUFyciIsIm1ldGhvZCIsInVybCIsImRhdGEiLCJoZWFkZXJzIiwiZ2V0SGVhZGVycyIsIm91dHB1dCIsIlByb21pc2UiLCJhbGxTZXR0bGVkIiwidGhlbiIsImZvckVhY2giLCJwdXNoIiwicHJvbWlzZXMiLCJhY3Rpdml0eSIsImF0dGFjaG1lbnRzIiwibWFwIiwiZG93bmxvYWRBdHRhY2htZW50QW5kV3JpdGUiLCJzdWNjZXNzZnVsU2F2ZXMiLCJhbGwiLCJyZXBseUZvclJlY2VpdmVkQXR0YWNobWVudHMiLCJsb2NhbEF0dGFjaG1lbnREYXRhIiwiZmlsZU5hbWUiLCJsb2NhbFBhdGgiLCJyZXBseVByb21pc2VzIiwiciIsImF0dGFjaG1lbnQiLCJuYW1lIiwidG9TdHJpbmciLCJzcGxpdCIsImNvbnRlbnRVcmwiLCJsb2NhbEZpbGVOYW1lIiwiam9pbiIsIl9fZGlybmFtZSIsInJlc3BvbnNlIiwiZ2V0IiwicmVzcG9uc2VUeXBlIiwiSlNPTiIsInBhcnNlIiwia2V5IiwiQnVmZmVyIiwiZnJvbSIsIndyaXRlRmlsZSIsImZzRXJyb3IiLCJlcnJvciIsInVuZGVmaW5lZCIsInByb21wdENvbnRleHQiLCJyZWNvZ25pemVkIiwic3VjY2VlZGVkIiwiZG9jVHlwZSIsInZhbGlkRG9jIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Im90YkFlWTsyRkFmWjtBQUNBO0FBRUEsS0FBTUEsQ0FBQUEsSUFBSSwwQkFBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBVixDQUFWLENBQ0EsS0FBTUMsQ0FBQUEsS0FBSywwQkFBR0QsT0FBTyxDQUFDLE9BQUQsQ0FBVixDQUFYLENBQ0EsS0FBTUUsQ0FBQUEsRUFBRSwwQkFBR0YsT0FBTyxDQUFDLElBQUQsQ0FBVixDQUFSLENBQ0EsS0FBTUcsQ0FBQUEsR0FBRywwQkFBR0gsT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFU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dCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5cclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcclxuY29uc3QgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbmNvbnN0IGZzZSA9IHJlcXVpcmUoXCJmcy1leHRyYVwiKTtcclxudmFyIEZvcm1EYXRhID0gcmVxdWlyZShcImZvcm0tZGF0YVwiKTtcclxuY29uc3Qge1xyXG4gICAgQXR0YWNobWVudFByb21wdCxcclxuICAgIENob2ljZUZhY3RvcnksXHJcbiAgICBDaG9pY2VQcm9tcHQsXHJcbiAgICBDb21wb25lbnREaWFsb2csXHJcbiAgICBDb25maXJtUHJvbXB0LFxyXG4gICAgRGlhbG9nU2V0LFxyXG4gICAgRGlhbG9nVHVyblN0YXR1cyxcclxuICAgIFRleHRQcm9tcHQsXHJcbiAgICBXYXRlcmZhbGxEaWFsb2dcclxufSA9IHJlcXVpcmUoJ2JvdGJ1aWxkZXItZGlhbG9ncycpO1xyXG5jb25zdCB7IEFuc3dlckRpYWxvZywgQU5TV0VSX0RJQUxPRyB9ID0gcmVxdWlyZSgnLi9hbnN3ZXJEaWFsb2cnKTtcclxuY29uc3QgeyBEb2NEaWFsb2csIERPQ19ESUFMT0cgfSA9IHJlcXVpcmUoJy4vZG9jRGlhbG9nJyk7XHJcblxyXG5jb25zdCBBVFRBQ0hNRU5UX1BST01QVCA9ICdBVFRBQ0hNRU5UX1BST01QVCc7XHJcbmNvbnN0IENIT0lDRV9QUk9NUFQgPSAnQ0hPSUNFX1BST01QVCc7XHJcbmNvbnN0IENPTkZJUk1fUFJPTVBUID0gJ0NPTkZJUk1fUFJPTVBUJztcclxuY29uc3QgV0FURVJGQUxMX0RJQUxPRyA9ICdXQVRFUkZBTExfRElBTE9HJztcclxuXHJcbmNsYXNzIE1haW5EaWFsb2cgZXh0ZW5kcyBDb21wb25lbnREaWFsb2cge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoJ21haW5EaWFsb2cnKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGREaWFsb2cobmV3IEFuc3dlckRpYWxvZygpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgRG9jRGlhbG9nKHRoaXMuaW5pdGlhbERpYWxvZ0lkKSk7XHJcbiAgICAgICAgdGhpcy5hZGREaWFsb2cobmV3IFRleHRQcm9tcHQoJ1RleHRQcm9tcHQnKSk7XHJcbiAgICAgICAgdGhpcy5hZGREaWFsb2cobmV3IENob2ljZVByb21wdChDSE9JQ0VfUFJPTVBUKSk7XHJcbiAgICAgICAgdGhpcy5hZGREaWFsb2cobmV3IENvbmZpcm1Qcm9tcHQoQ09ORklSTV9QUk9NUFQpKTtcclxuICAgICAgICB0aGlzLmFkZERpYWxvZyhuZXcgQXR0YWNobWVudFByb21wdChBVFRBQ0hNRU5UX1BST01QVCwgdGhpcy5wcm9tcHRWYWxpZGF0b3IpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGREaWFsb2cobmV3IFdhdGVyZmFsbERpYWxvZyhXQVRFUkZBTExfRElBTE9HLCBbXHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRTdGVwLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgIHRoaXMuY2hvb3NlU3RlcC5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICB0aGlzLmRvY1N0ZXAuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgdGhpcy5yZXBlYXRTdGVwLmJpbmQodGhpcylcclxuICAgICAgICBdKSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdGlhbERpYWxvZ0lkID0gV0FURVJGQUxMX0RJQUxPRztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoZSBydW4gbWV0aG9kIGhhbmRsZXMgdGhlIGluY29taW5nIGFjdGl2aXR5IChpbiB0aGUgZm9ybSBvZiBhIFR1cm5Db250ZXh0KSBhbmQgcGFzc2VzIGl0IHRocm91Z2ggdGhlIGRpYWxvZyBzeXN0ZW0uXHJcbiAgICAgKiBJZiBubyBkaWFsb2cgaXMgYWN0aXZlLCBpdCB3aWxsIHN0YXJ0IHRoZSBkZWZhdWx0IGRpYWxvZy5cclxuICAgICAqIEBwYXJhbSB7Kn0gdHVybkNvbnRleHRcclxuICAgICAqIEBwYXJhbSB7Kn0gYWNjZXNzb3JcclxuICAgICAqL1xyXG4gICAgYXN5bmMgcnVuKHR1cm5Db250ZXh0LCBhY2Nlc3Nvcikge1xyXG4gICAgICAgIGNvbnN0IGRpYWxvZ1NldCA9IG5ldyBEaWFsb2dTZXQoYWNjZXNzb3IpO1xyXG4gICAgICAgIGRpYWxvZ1NldC5hZGQodGhpcyk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRpYWxvZ0NvbnRleHQgPSBhd2FpdCBkaWFsb2dTZXQuY3JlYXRlQ29udGV4dCh0dXJuQ29udGV4dCk7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGRpYWxvZ0NvbnRleHQuY29udGludWVEaWFsb2coKTtcclxuICAgICAgICBpZiAocmVzdWx0cy5zdGF0dXMgPT09IERpYWxvZ1R1cm5TdGF0dXMuZW1wdHkpIHtcclxuICAgICAgICAgICAgYXdhaXQgZGlhbG9nQ29udGV4dC5iZWdpbkRpYWxvZyh0aGlzLmlkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgc3RhcnRTdGVwKHN0ZXApIHtcclxuICAgICAgICAvLyBXYXRlcmZhbGxTdGVwIGFsd2F5cyBmaW5pc2hlcyB3aXRoIHRoZSBlbmQgb2YgdGhlIFdhdGVyZmFsbCBvciB3aXRoIGFub3RoZXIgZGlhbG9nOyBoZXJlIGl0IGlzIGEgUHJvbXB0IERpYWxvZy5cclxuICAgICAgICAvLyBSdW5uaW5nIGEgcHJvbXB0IGhlcmUgbWVhbnMgdGhlIG5leHQgV2F0ZXJmYWxsU3RlcCB3aWxsIGJlIHJ1biB3aGVuIHRoZSB1c2VyJ3MgcmVzcG9uc2UgaXMgcmVjZWl2ZWQuXHJcbiAgICAgICAgY29uc3QgbXNnID0gc3RlcC5vcHRpb25zLnJlc3RhcnRNc2cgPyBzdGVwLm9wdGlvbnMucmVzdGFydE1zZyA6ICdXaGF0IGNhbiBJIGRvIGZvciB5b3U/JztcclxuICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5wcm9tcHQoQ0hPSUNFX1BST01QVCwge1xyXG4gICAgICAgICAgICBwcm9tcHQ6IG1zZyxcclxuICAgICAgICAgICAgY2hvaWNlczogQ2hvaWNlRmFjdG9yeS50b0Nob2ljZXMoWydhc2sgYSBxdWVzdGlvbicsICdwcm9jZXNzIGEgZG9jdW1lbnQnLCAsICdyZWNvZ25pemUgYW4gaW1hZ2UnXSlcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBjaG9vc2VTdGVwKHN0ZXApIHtcclxuICAgICAgICBjb25zdCBjaG9pY2UgPSBzdGVwLnJlc3VsdC52YWx1ZTtcclxuICAgICAgICBpZiAoY2hvaWNlID09ICdhc2sgYSBxdWVzdGlvbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAuYmVnaW5EaWFsb2coQU5TV0VSX0RJQUxPRyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNob2ljZSA9PSAncHJvY2VzcyBhIGRvY3VtZW50Jykge1xyXG4gICAgICAgICAgICB2YXIgcHJvbXB0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHByb21wdDogJ1BsZWFzZSBhdHRhY2ggYSBkb2N1bWVudCBpbiBwZGYuJyxcclxuICAgICAgICAgICAgICAgIHJldHJ5UHJvbXB0OiAnVGhhdCB3YXMgbm90IGEgZG9jdW1lbnQgdGhhdCBJIGNhbiBoZWxwLCBwbGVhc2UgdHJ5IGFnYWluLidcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzdGVwLnByb21wdChBVFRBQ0hNRU5UX1BST01QVCwgcHJvbXB0T3B0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgcHJvbXB0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIHByb21wdDogJ1BsZWFzZSBhdHRhY2ggYW4gaW1hZ2UuJyxcclxuICAgICAgICAgICAgICAgIHJldHJ5UHJvbXB0OiAnVGhhdCB3YXMgbm90IGFuIGltYWdlIHRoYXQgSSBjYW4gaGVscCwgcGxlYXNlIHRyeSBhZ2Fpbi4nXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5wcm9tcHQoQVRUQUNITUVOVF9QUk9NUFQsIHByb21wdE9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgZG9jU3RlcChzdGVwKSB7XHJcbiAgICAgICAgaWYgKHN0ZXAucmVzdWx0ICYmIHN0ZXAucmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coc3RlcC5yZXN1bHRbMF0uY29udGVudFR5cGUpO1xyXG4gICAgICAgICAgICB2YXIgdHlwZSA9IHN0ZXAucmVzdWx0WzBdLmNvbnRlbnRUeXBlO1xyXG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3BkZicpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXRoID0gYXdhaXQgdGhpcy5oYW5kbGVJbmNvbWluZ0F0dGFjaG1lbnQoc3RlcC5jb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwYXRoOiAnICsgcGF0aCk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KCdQcm9jZXNzaW5nIHRoZSBkb2N1bWVudCwgcGxlYXNlIHdhaXQnKTtcclxuICAgICAgICAgICAgICAgIHZhciByZXFfcmVzdWx0cyA9IGF3YWl0IHRoaXMuc2VuZFJlcShwYXRoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBzdGVwLmJlZ2luRGlhbG9nKERPQ19ESUFMT0csIHsgc3VtOiByZXFfcmVzdWx0c1swXSwgcXVlcnk6IHJlcV9yZXN1bHRzWzFdLCBmaWxlcGF0aDogcGF0aCB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlSW5jb21pbmdBdHRhY2htZW50KHN0ZXAuY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5jb250ZXh0LnNlbmRBY3Rpdml0eSgnTW9yZSBmdW5jdGlvbnMgdG8gYmUgdXBkYXRpbmcuLi4nKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzdGVwLnJlcGxhY2VEaWFsb2codGhpcy5pbml0aWFsRGlhbG9nSWQsIHsgcmVzdGFydE1zZzogJ1doYXQgZWxzZSBjYW4gSSBkbyBmb3IgeW91PycgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcblxyXG4gICAgYXN5bmMgcmVwZWF0U3RlcChzdGVwKSB7XHJcbiAgICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAucmVwbGFjZURpYWxvZyh0aGlzLmluaXRpYWxEaWFsb2dJZCwgeyByZXN0YXJ0TXNnOiAnV2hhdCBlbHNlIGNhbiBJIGRvIGZvciB5b3U/JyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBzZW5kUmVxKHBhdGgpIHtcclxuICAgICAgICB2YXIgZm9ybTEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICBmb3JtMS5hcHBlbmQoXCJmaWxlXCIsIGZzZS5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpKTtcclxuICAgICAgICB2YXIgZm9ybTIgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICBmb3JtMi5hcHBlbmQoXCJmaWxlXCIsIGZzZS5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcUFyciA9IFtheGlvcyh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgICAgIHVybDogXCJodHRwczovL3RleHRzdW1hcGkuYXp1cmV3ZWJzaXRlcy5uZXQvYXBpL3RleHRzdW1hcGlcIixcclxuICAgICAgICAgICAgZGF0YTogZm9ybTEsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGZvcm0xLmdldEhlYWRlcnMoKVxyXG4gICAgICAgIH0pLCBheGlvcyh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgICAgIHVybDogXCJodHRwOi8vNTEuMTEuMTgyLjU6NTAwMFwiLFxyXG4gICAgICAgICAgICBkYXRhOiBmb3JtMixcclxuICAgICAgICAgICAgaGVhZGVyczogZm9ybTIuZ2V0SGVhZGVycygpXHJcbiAgICAgICAgfSldO1xyXG4gICAgICAgIHZhciBvdXRwdXQgPSBbXTtcclxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQocmVxQXJyKS50aGVuKHJlc3VsdHMgPT4ge1xyXG4gICAgICAgICAgICByZXN1bHRzLmZvckVhY2gocmVzdWx0ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5zdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT0gJ2Z1bGZpbGxlZCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChyZXN1bHQudmFsdWUuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZpcnN0OiAnK3Jlc3VsdC52YWx1ZS5kYXRhKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2goMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcIuWujOaIkOWVpu+8gVwiKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhvdXRwdXQpO1xyXG4gICAgICAgIHJldHVybiBvdXRwdXQ7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgaGFuZGxlSW5jb21pbmdBdHRhY2htZW50KHR1cm5Db250ZXh0KSB7XHJcbiAgICAgICAgLy8gUHJlcGFyZSBQcm9taXNlcyB0byBkb3dubG9hZCBlYWNoIGF0dGFjaG1lbnQgYW5kIHRoZW4gZXhlY3V0ZSBlYWNoIFByb21pc2UuXHJcbiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBhd2FpdCB0dXJuQ29udGV4dC5hY3Rpdml0eS5hdHRhY2htZW50cy5tYXAodGhpcy5kb3dubG9hZEF0dGFjaG1lbnRBbmRXcml0ZSk7XHJcbiAgICAgICAgY29uc3Qgc3VjY2Vzc2Z1bFNhdmVzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xyXG5cclxuICAgICAgICAvLyBSZXBsaWVzIGJhY2sgdG8gdGhlIHVzZXIgd2l0aCBpbmZvcm1hdGlvbiBhYm91dCB3aGVyZSB0aGUgYXR0YWNobWVudCBpcyBzdG9yZWQgb24gdGhlIGJvdCdzIHNlcnZlcixcclxuICAgICAgICAvLyBhbmQgd2hhdCB0aGUgbmFtZSBvZiB0aGUgc2F2ZWQgZmlsZSBpcy5cclxuICAgICAgICBhc3luYyBmdW5jdGlvbiByZXBseUZvclJlY2VpdmVkQXR0YWNobWVudHMobG9jYWxBdHRhY2htZW50RGF0YSkge1xyXG4gICAgICAgICAgICBpZiAobG9jYWxBdHRhY2htZW50RGF0YSkge1xyXG4gICAgICAgICAgICAgICAgLy8gQmVjYXVzZSB0aGUgVHVybkNvbnRleHQgd2FzIGJvdW5kIHRvIHRoaXMgZnVuY3Rpb24sIHRoZSBib3QgY2FuIGNhbGxcclxuICAgICAgICAgICAgICAgIC8vIGBUdXJuQ29udGV4dC5zZW5kQWN0aXZpdHlgIHZpYSBgdGhpcy5zZW5kQWN0aXZpdHlgO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zZW5kQWN0aXZpdHkoYEF0dGFjaG1lbnQgXCIke2xvY2FsQXR0YWNobWVudERhdGEuZmlsZU5hbWV9XCIgYCArXHJcbiAgICAgICAgICAgICAgICAgICAgYGhhcyBiZWVuIHJlY2VpdmVkLmApO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEFjdGl2aXR5KCdBdHRhY2htZW50IHdhcyBub3Qgc3VjY2Vzc2Z1bGx5IHNhdmVkIHRvIGRpc2suJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGxvY2FsQXR0YWNobWVudERhdGEubG9jYWxQYXRoXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBQcmVwYXJlIFByb21pc2VzIHRvIHJlcGx5IHRvIHRoZSB1c2VyIHdpdGggaW5mb3JtYXRpb24gYWJvdXQgc2F2ZWQgYXR0YWNobWVudHMuXHJcbiAgICAgICAgLy8gVGhlIGN1cnJlbnQgVHVybkNvbnRleHQgaXMgYm91bmQgc28gYHJlcGx5Rm9yUmVjZWl2ZWRBdHRhY2htZW50c2AgY2FuIGFsc28gc2VuZCByZXBsaWVzLlxyXG4gICAgICAgIGNvbnN0IHJlcGx5UHJvbWlzZXMgPSBzdWNjZXNzZnVsU2F2ZXMubWFwKHJlcGx5Rm9yUmVjZWl2ZWRBdHRhY2htZW50cy5iaW5kKHR1cm5Db250ZXh0KSk7XHJcbiAgICAgICAgbGV0IHIgPSBhd2FpdCBQcm9taXNlLmFsbChyZXBseVByb21pc2VzKS50aGVuKHJlc3VsdCA9PiByZXN1bHRbMF0pO1xyXG4gICAgICAgIHJldHVybiByXHJcblxyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGRvd25sb2FkQXR0YWNobWVudEFuZFdyaXRlKGF0dGFjaG1lbnQpIHtcclxuICAgICAgICB2YXIgbmFtZSA9ICd0ZXh0LicgKyBhdHRhY2htZW50LmNvbnRlbnRUeXBlLnRvU3RyaW5nKCkuc3BsaXQoJy8nKVsxXTtcclxuICAgICAgICBjb25zb2xlLmxvZyhuYW1lKTtcclxuICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgYXR0YWNobWVudCB2aWEgdGhlIGF0dGFjaG1lbnQncyBjb250ZW50VXJsLlxyXG4gICAgICAgIGNvbnN0IHVybCA9IGF0dGFjaG1lbnQuY29udGVudFVybDtcclxuXHJcbiAgICAgICAgLy8gTG9jYWwgZmlsZSBwYXRoIGZvciB0aGUgYm90IHRvIHNhdmUgdGhlIGF0dGFjaG1lbnQuXHJcbiAgICAgICAgY29uc3QgbG9jYWxGaWxlTmFtZSA9IHBhdGguam9pbihfX2Rpcm5hbWUsIG5hbWUpO1xyXG5cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyBhcnJheWJ1ZmZlciBpcyBuZWNlc3NhcnkgZm9yIGltYWdlc1xyXG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIHsgcmVzcG9uc2VUeXBlOiAnYXJyYXlidWZmZXInIH0pO1xyXG4gICAgICAgICAgICAvLyBJZiB1c2VyIHVwbG9hZHMgSlNPTiBmaWxlLCB0aGlzIHByZXZlbnRzIGl0IGZyb20gYmVpbmcgd3JpdHRlbiBhcyBcIntcInR5cGVcIjpcIkJ1ZmZlclwiLFwiZGF0YVwiOlsxMjMsMTMsMTAsMzIsMzIsMzQsMTA4Li4uXCJcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID09PSAnYXBwbGljYXRpb24vanNvbicpIHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmRhdGEsIChrZXksIHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlICYmIHZhbHVlLnR5cGUgPT09ICdCdWZmZXInID8gQnVmZmVyLmZyb20odmFsdWUuZGF0YSkgOiB2YWx1ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZShsb2NhbEZpbGVOYW1lLCByZXNwb25zZS5kYXRhLCAoZnNFcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKGZzRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBmc0Vycm9yO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gSWYgbm8gZXJyb3Igd2FzIHRocm93biB3aGlsZSB3cml0aW5nIHRvIGRpc2ssIHJldHVybiB0aGUgYXR0YWNobWVudCdzIG5hbWVcclxuICAgICAgICAvLyBhbmQgbG9jYWxGaWxlUGF0aCBmb3IgdGhlIHJlc3BvbnNlIGJhY2sgdG8gdGhlIHVzZXIuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZmlsZU5hbWU6IGF0dGFjaG1lbnQubmFtZSxcclxuICAgICAgICAgICAgbG9jYWxQYXRoOiBsb2NhbEZpbGVOYW1lXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIGFzeW5jIHByb21wdFZhbGlkYXRvcihwcm9tcHRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHByb21wdENvbnRleHQucmVjb2duaXplZC5zdWNjZWVkZWQpIHtcclxuICAgICAgICAgICAgdmFyIGRvY1R5cGUgPSBwcm9tcHRDb250ZXh0Lm9wdGlvbnMucHJvbXB0O1xyXG4gICAgICAgICAgICB2YXIgYXR0YWNobWVudHMgPSBwcm9tcHRDb250ZXh0LnJlY29nbml6ZWQudmFsdWU7XHJcbiAgICAgICAgICAgIHZhciB2YWxpZERvYyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgYXR0YWNobWVudHMuZm9yRWFjaChhdHRhY2htZW50ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChkb2NUeXBlID09PSAnUGxlYXNlIGF0dGFjaCBhIGRvY3VtZW50IGluIHBkZi4nICYmIGF0dGFjaG1lbnQuY29udGVudFR5cGUgPT09ICdhcHBsaWNhdGlvbi9wZGYnKSB7IC8vfHwgYXR0YWNobWVudC5jb250ZW50VHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50J3x8IGF0dGFjaG1lbnQuY29udGVudFR5cGUgPT09ICdhcHBsaWNhdGlvbi9tc3dvcmQnXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsaWREb2MucHVzaChhdHRhY2htZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRvY1R5cGUgPT09ICdQbGVhc2UgYXR0YWNoIGFuIGltYWdlLicgJiYgKGF0dGFjaG1lbnQuY29udGVudFR5cGUgPT09ICdpbWFnZS9qcGVnJyB8fCBhdHRhY2htZW50LmNvbnRlbnRUeXBlID09PSAnaW1hZ2UvcG5nJykpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWxpZERvYy5wdXNoKGF0dGFjaG1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHByb21wdENvbnRleHQucmVjb2duaXplZC52YWx1ZSA9IHZhbGlkRG9jO1xyXG5cclxuICAgICAgICAgICAgLy8gSWYgbm9uZSBvZiB0aGUgYXR0YWNobWVudHMgYXJlIHZhbGlkIGltYWdlcywgdGhlIHJldHJ5IHByb21wdCBzaG91bGQgYmUgc2VudC5cclxuICAgICAgICAgICAgcmV0dXJuICEhdmFsaWREb2MubGVuZ3RoO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGF3YWl0IHByb21wdENvbnRleHQuY29udGV4dC5zZW5kQWN0aXZpdHkoJ05vIGF0dGFjaG1lbnRzIHJlY2VpdmVkLCBwbGVhc2UgdHJ5IGFnYWluLicpO1xyXG5cclxuICAgICAgICAgICAgLy8gV2UgY2FuIHJldHVybiB0cnVlIGZyb20gYSB2YWxpZGF0b3IgZnVuY3Rpb24gZXZlbiBpZiBSZWNvZ25pemVkLlN1Y2NlZWRlZCBpcyBmYWxzZS5cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzLk1haW5EaWFsb2cgPSBNYWluRGlhbG9nOyJdfQ==