function cov_13uzh0bhr2(){var path="/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/mainDialog.js";var hash="c74fe7744011e4bb2be463213abfb94c4a72ae52";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/doudou/COMP0016_2020_21_Team8/AvabotTeam8-src/dialogs/mainDialog.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:28}},"1":{start:{line:2,column:14},end:{line:2,column:30}},"2":{start:{line:3,column:11},end:{line:3,column:24}},"3":{start:{line:4,column:12},end:{line:4,column:31}},"4":{start:{line:5,column:15},end:{line:5,column:35}},"5":{start:{line:14,column:4},end:{line:14,column:33}},"6":{start:{line:15,column:40},end:{line:15,column:65}},"7":{start:{line:16,column:34},end:{line:16,column:56}},"8":{start:{line:18,column:26},end:{line:18,column:45}},"9":{start:{line:19,column:22},end:{line:19,column:37}},"10":{start:{line:20,column:25},end:{line:20,column:43}},"11":{start:{line:24,column:4},end:{line:24,column:24}},"12":{start:{line:26,column:4},end:{line:26,column:39}},"13":{start:{line:27,column:4},end:{line:27,column:56}},"14":{start:{line:28,column:4},end:{line:28,column:52}},"15":{start:{line:29,column:4},end:{line:31,column:6}},"16":{start:{line:33,column:4},end:{line:40,column:6}},"17":{start:{line:42,column:4},end:{line:42,column:44}},"18":{start:{line:52,column:22},end:{line:52,column:45}},"19":{start:{line:53,column:4},end:{line:53,column:24}},"20":{start:{line:55,column:26},end:{line:55,column:68}},"21":{start:{line:56,column:20},end:{line:56,column:56}},"22":{start:{line:57,column:4},end:{line:59,column:5}},"23":{start:{line:58,column:6},end:{line:58,column:47}},"24":{start:{line:65,column:16},end:{line:67,column:32}},"25":{start:{line:68,column:4},end:{line:76,column:7}},"26":{start:{line:80,column:19},end:{line:80,column:36}},"27":{start:{line:81,column:4},end:{line:99,column:5}},"28":{start:{line:82,column:6},end:{line:82,column:51}},"29":{start:{line:83,column:11},end:{line:99,column:5}},"30":{start:{line:84,column:26},end:{line:88,column:7}},"31":{start:{line:90,column:6},end:{line:90,column:65}},"32":{start:{line:92,column:26},end:{line:96,column:7}},"33":{start:{line:98,column:6},end:{line:98,column:65}},"34":{start:{line:103,column:4},end:{line:157,column:5}},"35":{start:{line:104,column:17},end:{line:104,column:43}},"36":{start:{line:105,column:17},end:{line:105,column:66}},"37":{start:{line:106,column:6},end:{line:106,column:24}},"38":{start:{line:107,column:6},end:{line:156,column:7}},"39":{start:{line:108,column:8},end:{line:155,column:9}},"40":{start:{line:109,column:10},end:{line:111,column:12}},"41":{start:{line:112,column:28},end:{line:112,column:52}},"42":{start:{line:113,column:10},end:{line:115,column:28}},"43":{start:{line:114,column:12},end:{line:114,column:32}},"44":{start:{line:116,column:10},end:{line:121,column:13}},"45":{start:{line:123,column:29},end:{line:123,column:31}},"46":{start:{line:124,column:10},end:{line:126,column:12}},"47":{start:{line:127,column:21},end:{line:127,column:35}},"48":{start:{line:128,column:10},end:{line:128,column:58}},"49":{start:{line:129,column:10},end:{line:144,column:15}},"50":{start:{line:137,column:22},end:{line:137,column:35}},"51":{start:{line:138,column:14},end:{line:140,column:17}},"52":{start:{line:139,column:16},end:{line:139,column:44}},"53":{start:{line:143,column:14},end:{line:143,column:33}},"54":{start:{line:145,column:10},end:{line:147,column:28}},"55":{start:{line:146,column:12},end:{line:146,column:32}},"56":{start:{line:148,column:10},end:{line:154,column:11}},"57":{start:{line:149,column:12},end:{line:149,column:58}},"58":{start:{line:151,column:12},end:{line:153,column:14}},"59":{start:{line:158,column:4},end:{line:158,column:29}},"60":{start:{line:162,column:4},end:{line:164,column:7}},"61":{start:{line:168,column:16},end:{line:168,column:30}},"62":{start:{line:169,column:4},end:{line:169,column:53}},"63":{start:{line:170,column:16},end:{line:170,column:30}},"64":{start:{line:171,column:4},end:{line:171,column:53}},"65":{start:{line:172,column:16},end:{line:172,column:30}},"66":{start:{line:173,column:4},end:{line:173,column:53}},"67":{start:{line:175,column:17},end:{line:195,column:5}},"68":{start:{line:196,column:17},end:{line:196,column:19}},"69":{start:{line:197,column:4},end:{line:207,column:7}},"70":{start:{line:198,column:6},end:{line:206,column:9}},"71":{start:{line:199,column:8},end:{line:199,column:35}},"72":{start:{line:200,column:8},end:{line:205,column:9}},"73":{start:{line:201,column:10},end:{line:201,column:41}},"74":{start:{line:202,column:10},end:{line:202,column:53}},"75":{start:{line:204,column:10},end:{line:204,column:25}},"76":{start:{line:208,column:4},end:{line:208,column:29}},"77":{start:{line:209,column:4},end:{line:209,column:24}},"78":{start:{line:210,column:4},end:{line:210,column:18}},"79":{start:{line:215,column:21},end:{line:217,column:5}},"80":{start:{line:218,column:28},end:{line:218,column:55}},"81":{start:{line:223,column:6},end:{line:233,column:7}},"82":{start:{line:226,column:8},end:{line:228,column:10}},"83":{start:{line:229,column:8},end:{line:229,column:45}},"84":{start:{line:231,column:8},end:{line:231,column:77}},"85":{start:{line:232,column:8},end:{line:232,column:25}},"86":{start:{line:238,column:26},end:{line:240,column:5}},"87":{start:{line:241,column:12},end:{line:241,column:72}},"88":{start:{line:241,column:62},end:{line:241,column:71}},"89":{start:{line:242,column:4},end:{line:242,column:13}},"90":{start:{line:246,column:15},end:{line:246,column:30}},"91":{start:{line:248,column:16},end:{line:248,column:37}},"92":{start:{line:251,column:26},end:{line:251,column:52}},"93":{start:{line:253,column:4},end:{line:264,column:5}},"94":{start:{line:255,column:23},end:{line:255,column:76}},"95":{start:{line:256,column:6},end:{line:260,column:9}},"96":{start:{line:257,column:8},end:{line:259,column:9}},"97":{start:{line:258,column:10},end:{line:258,column:24}},"98":{start:{line:262,column:6},end:{line:262,column:27}},"99":{start:{line:263,column:6},end:{line:263,column:23}},"100":{start:{line:267,column:4},end:{line:270,column:6}},"101":{start:{line:274,column:4},end:{line:304,column:5}},"102":{start:{line:275,column:20},end:{line:275,column:48}},"103":{start:{line:276,column:24},end:{line:276,column:54}},"104":{start:{line:277,column:21},end:{line:277,column:23}},"105":{start:{line:279,column:6},end:{line:293,column:9}},"106":{start:{line:280,column:8},end:{line:292,column:9}},"107":{start:{line:285,column:10},end:{line:285,column:36}},"108":{start:{line:286,column:15},end:{line:292,column:9}},"109":{start:{line:291,column:10},end:{line:291,column:36}},"110":{start:{line:295,column:6},end:{line:295,column:48}},"111":{start:{line:298,column:6},end:{line:298,column:31}},"112":{start:{line:300,column:6},end:{line:300,column:75}},"113":{start:{line:303,column:6},end:{line:303,column:18}},"114":{start:{line:308,column:0},end:{line:308,column:39}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:23,column:2},end:{line:23,column:3}},loc:{start:{line:23,column:16},end:{line:43,column:3}},line:23},"1":{name:"(anonymous_1)",decl:{start:{line:51,column:2},end:{line:51,column:3}},loc:{start:{line:51,column:35},end:{line:60,column:3}},line:51},"2":{name:"(anonymous_2)",decl:{start:{line:62,column:2},end:{line:62,column:3}},loc:{start:{line:62,column:24},end:{line:77,column:3}},line:62},"3":{name:"(anonymous_3)",decl:{start:{line:79,column:2},end:{line:79,column:3}},loc:{start:{line:79,column:25},end:{line:100,column:3}},line:79},"4":{name:"(anonymous_4)",decl:{start:{line:102,column:2},end:{line:102,column:3}},loc:{start:{line:102,column:22},end:{line:159,column:3}},line:102},"5":{name:"(anonymous_5)",decl:{start:{line:136,column:18},end:{line:136,column:19}},loc:{start:{line:136,column:38},end:{line:141,column:13}},line:136},"6":{name:"(anonymous_6)",decl:{start:{line:138,column:24},end:{line:138,column:25}},loc:{start:{line:138,column:34},end:{line:140,column:15}},line:138},"7":{name:"(anonymous_7)",decl:{start:{line:142,column:19},end:{line:142,column:20}},loc:{start:{line:142,column:36},end:{line:144,column:13}},line:142},"8":{name:"(anonymous_8)",decl:{start:{line:161,column:2},end:{line:161,column:3}},loc:{start:{line:161,column:25},end:{line:165,column:3}},line:161},"9":{name:"(anonymous_9)",decl:{start:{line:167,column:2},end:{line:167,column:3}},loc:{start:{line:167,column:22},end:{line:211,column:3}},line:167},"10":{name:"(anonymous_10)",decl:{start:{line:197,column:42},end:{line:197,column:43}},loc:{start:{line:197,column:55},end:{line:207,column:5}},line:197},"11":{name:"(anonymous_11)",decl:{start:{line:198,column:22},end:{line:198,column:23}},loc:{start:{line:198,column:34},end:{line:206,column:7}},line:198},"12":{name:"(anonymous_12)",decl:{start:{line:213,column:2},end:{line:213,column:3}},loc:{start:{line:213,column:46},end:{line:243,column:3}},line:213},"13":{name:"replyForReceivedAttachments",decl:{start:{line:222,column:19},end:{line:222,column:46}},loc:{start:{line:222,column:68},end:{line:234,column:5}},line:222},"14":{name:"(anonymous_14)",decl:{start:{line:241,column:50},end:{line:241,column:51}},loc:{start:{line:241,column:62},end:{line:241,column:71}},line:241},"15":{name:"(anonymous_15)",decl:{start:{line:245,column:2},end:{line:245,column:3}},loc:{start:{line:245,column:47},end:{line:271,column:3}},line:245},"16":{name:"(anonymous_16)",decl:{start:{line:256,column:49},end:{line:256,column:50}},loc:{start:{line:256,column:62},end:{line:260,column:7}},line:256},"17":{name:"(anonymous_17)",decl:{start:{line:273,column:2},end:{line:273,column:3}},loc:{start:{line:273,column:39},end:{line:305,column:3}},line:273},"18":{name:"(anonymous_18)",decl:{start:{line:279,column:26},end:{line:279,column:27}},loc:{start:{line:279,column:42},end:{line:293,column:7}},line:279}},branchMap:{"0":{loc:{start:{line:57,column:4},end:{line:59,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:59,column:5}},{start:{line:57,column:4},end:{line:59,column:5}}],line:57},"1":{loc:{start:{line:65,column:16},end:{line:67,column:32}},type:"cond-expr",locations:[{start:{line:66,column:8},end:{line:66,column:31}},{start:{line:67,column:8},end:{line:67,column:32}}],line:65},"2":{loc:{start:{line:81,column:4},end:{line:99,column:5}},type:"if",locations:[{start:{line:81,column:4},end:{line:99,column:5}},{start:{line:81,column:4},end:{line:99,column:5}}],line:81},"3":{loc:{start:{line:83,column:11},end:{line:99,column:5}},type:"if",locations:[{start:{line:83,column:11},end:{line:99,column:5}},{start:{line:83,column:11},end:{line:99,column:5}}],line:83},"4":{loc:{start:{line:103,column:4},end:{line:157,column:5}},type:"if",locations:[{start:{line:103,column:4},end:{line:157,column:5}},{start:{line:103,column:4},end:{line:157,column:5}}],line:103},"5":{loc:{start:{line:103,column:8},end:{line:103,column:48}},type:"binary-expr",locations:[{start:{line:103,column:8},end:{line:103,column:19}},{start:{line:103,column:23},end:{line:103,column:48}}],line:103},"6":{loc:{start:{line:107,column:6},end:{line:156,column:7}},type:"if",locations:[{start:{line:107,column:6},end:{line:156,column:7}},{start:{line:107,column:6},end:{line:156,column:7}}],line:107},"7":{loc:{start:{line:108,column:8},end:{line:155,column:9}},type:"if",locations:[{start:{line:108,column:8},end:{line:155,column:9}},{start:{line:108,column:8},end:{line:155,column:9}}],line:108},"8":{loc:{start:{line:148,column:10},end:{line:154,column:11}},type:"if",locations:[{start:{line:148,column:10},end:{line:154,column:11}},{start:{line:148,column:10},end:{line:154,column:11}}],line:148},"9":{loc:{start:{line:200,column:8},end:{line:205,column:9}},type:"if",locations:[{start:{line:200,column:8},end:{line:205,column:9}},{start:{line:200,column:8},end:{line:205,column:9}}],line:200},"10":{loc:{start:{line:223,column:6},end:{line:233,column:7}},type:"if",locations:[{start:{line:223,column:6},end:{line:233,column:7}},{start:{line:223,column:6},end:{line:233,column:7}}],line:223},"11":{loc:{start:{line:257,column:8},end:{line:259,column:9}},type:"if",locations:[{start:{line:257,column:8},end:{line:259,column:9}},{start:{line:257,column:8},end:{line:259,column:9}}],line:257},"12":{loc:{start:{line:274,column:4},end:{line:304,column:5}},type:"if",locations:[{start:{line:274,column:4},end:{line:304,column:5}},{start:{line:274,column:4},end:{line:304,column:5}}],line:274},"13":{loc:{start:{line:280,column:8},end:{line:292,column:9}},type:"if",locations:[{start:{line:280,column:8},end:{line:292,column:9}},{start:{line:280,column:8},end:{line:292,column:9}}],line:280},"14":{loc:{start:{line:281,column:10},end:{line:282,column:54}},type:"binary-expr",locations:[{start:{line:281,column:10},end:{line:281,column:56}},{start:{line:282,column:10},end:{line:282,column:54}}],line:281},"15":{loc:{start:{line:286,column:15},end:{line:292,column:9}},type:"if",locations:[{start:{line:286,column:15},end:{line:292,column:9}},{start:{line:286,column:15},end:{line:292,column:9}}],line:286},"16":{loc:{start:{line:287,column:10},end:{line:289,column:51}},type:"binary-expr",locations:[{start:{line:287,column:10},end:{line:287,column:47}},{start:{line:288,column:11},end:{line:288,column:50}},{start:{line:289,column:12},end:{line:289,column:50}}],line:287}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c74fe7744011e4bb2be463213abfb94c4a72ae52"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_13uzh0bhr2=function(){return actualCoverage;};}return actualCoverage;}cov_13uzh0bhr2();const path=(cov_13uzh0bhr2().s[0]++,require("path"));const axios=(cov_13uzh0bhr2().s[1]++,require("axios"));const fs=(cov_13uzh0bhr2().s[2]++,require("fs"));const fse=(cov_13uzh0bhr2().s[3]++,require("fs-extra"));var FormData=(cov_13uzh0bhr2().s[4]++,require("form-data"));const{AttachmentPrompt,ChoiceFactory,ChoicePrompt,ComponentDialog,DialogSet,DialogTurnStatus,WaterfallDialog}=(cov_13uzh0bhr2().s[5]++,require("botbuilder-dialogs"));const{AnswerDialog,ANSWER_DIALOG}=(cov_13uzh0bhr2().s[6]++,require("./answerDialog"));const{DocDialog,DOC_DIALOG}=(cov_13uzh0bhr2().s[7]++,require("./docDialog"));const ATTACHMENT_PROMPT=(cov_13uzh0bhr2().s[8]++,"ATTACHMENT_PROMPT");const CHOICE_PROMPT=(cov_13uzh0bhr2().s[9]++,"CHOICE_PROMPT");const WATERFALL_DIALOG=(cov_13uzh0bhr2().s[10]++,"WATERFALL_DIALOG");class MainDialog extends ComponentDialog{constructor(){cov_13uzh0bhr2().f[0]++;cov_13uzh0bhr2().s[11]++;super("mainDialog");cov_13uzh0bhr2().s[12]++;this.addDialog(new AnswerDialog());cov_13uzh0bhr2().s[13]++;this.addDialog(new DocDialog(this.initialDialogId));cov_13uzh0bhr2().s[14]++;this.addDialog(new ChoicePrompt(CHOICE_PROMPT));cov_13uzh0bhr2().s[15]++;this.addDialog(new AttachmentPrompt(ATTACHMENT_PROMPT,this.promptValidator));cov_13uzh0bhr2().s[16]++;this.addDialog(new WaterfallDialog(WATERFALL_DIALOG,[this.startStep.bind(this),this.chooseStep.bind(this),this.docStep.bind(this),this.repeatStep.bind(this)]));cov_13uzh0bhr2().s[17]++;this.initialDialogId=WATERFALL_DIALOG;}/**
   * The run method handles the incoming activity (in the form of a TurnContext) and passes it through the dialog system.
   * If no dialog is active, it will start the default dialog.
   * @param {*} turnContext
   * @param {*} accessor
   */async run(turnContext,accessor){cov_13uzh0bhr2().f[1]++;const dialogSet=(cov_13uzh0bhr2().s[18]++,new DialogSet(accessor));cov_13uzh0bhr2().s[19]++;dialogSet.add(this);const dialogContext=(cov_13uzh0bhr2().s[20]++,await dialogSet.createContext(turnContext));const results=(cov_13uzh0bhr2().s[21]++,await dialogContext.continueDialog());cov_13uzh0bhr2().s[22]++;if(results.status===DialogTurnStatus.empty){cov_13uzh0bhr2().b[0][0]++;cov_13uzh0bhr2().s[23]++;await dialogContext.beginDialog(this.id);}else{cov_13uzh0bhr2().b[0][1]++;}}async startStep(step){cov_13uzh0bhr2().f[2]++;// WaterfallStep always finishes with the end of the Waterfall or with another dialog; here it is a Prompt Dialog.
// Running a prompt here means the next WaterfallStep will be run when the user's response is received.
const msg=(cov_13uzh0bhr2().s[24]++,step.options.restartMsg?(cov_13uzh0bhr2().b[1][0]++,step.options.restartMsg):(cov_13uzh0bhr2().b[1][1]++,"What can I do for you?"));cov_13uzh0bhr2().s[25]++;return await step.prompt(CHOICE_PROMPT,{prompt:msg,choices:ChoiceFactory.toChoices(["ask a question","process a document",,"recognize an image"])});}async chooseStep(step){cov_13uzh0bhr2().f[3]++;const choice=(cov_13uzh0bhr2().s[26]++,step.result.value);cov_13uzh0bhr2().s[27]++;if(choice=="ask a question"){cov_13uzh0bhr2().b[2][0]++;cov_13uzh0bhr2().s[28]++;return await step.beginDialog(ANSWER_DIALOG);}else{cov_13uzh0bhr2().b[2][1]++;cov_13uzh0bhr2().s[29]++;if(choice=="process a document"){cov_13uzh0bhr2().b[3][0]++;var promptOptions=(cov_13uzh0bhr2().s[30]++,{prompt:"Please attach a document in pdf.",retryPrompt:"That was not a document that I can help, please try again with a document in pdf."});cov_13uzh0bhr2().s[31]++;return await step.prompt(ATTACHMENT_PROMPT,promptOptions);}else{cov_13uzh0bhr2().b[3][1]++;var promptOptions=(cov_13uzh0bhr2().s[32]++,{prompt:"Please attach an image.",retryPrompt:"That was not an image that I can help, please try again with an image in png/jpg."});cov_13uzh0bhr2().s[33]++;return await step.prompt(ATTACHMENT_PROMPT,promptOptions);}}}async docStep(step){cov_13uzh0bhr2().f[4]++;cov_13uzh0bhr2().s[34]++;if((cov_13uzh0bhr2().b[5][0]++,step.result)&&(cov_13uzh0bhr2().b[5][1]++,step.result[0].contentUrl)){cov_13uzh0bhr2().b[4][0]++;var type=(cov_13uzh0bhr2().s[35]++,step.result[0].contentType);var path=(cov_13uzh0bhr2().s[36]++,await this.handleIncomingAttachment(step.context));cov_13uzh0bhr2().s[37]++;console.log(path);cov_13uzh0bhr2().s[38]++;if(path){cov_13uzh0bhr2().b[6][0]++;cov_13uzh0bhr2().s[39]++;if(type==="application/pdf"){cov_13uzh0bhr2().b[7][0]++;cov_13uzh0bhr2().s[40]++;await step.context.sendActivity("Processing the document, please wait, it will take around 55 seconds");var req_results=(cov_13uzh0bhr2().s[41]++,await this.sendReq(path));cov_13uzh0bhr2().s[42]++;try{cov_13uzh0bhr2().s[43]++;fs.unlinkSync(path);}catch(error){}cov_13uzh0bhr2().s[44]++;return await step.beginDialog(DOC_DIALOG,{sum:req_results[0],query:req_results[1],form:req_results[2],filepath:path});}else{cov_13uzh0bhr2().b[7][1]++;var image_result=(cov_13uzh0bhr2().s[45]++,"");cov_13uzh0bhr2().s[46]++;await step.context.sendActivity("Processing the image, please wait, it will take around 15 seconds");var form=(cov_13uzh0bhr2().s[47]++,new FormData());cov_13uzh0bhr2().s[48]++;form.append("file",fse.createReadStream(path));cov_13uzh0bhr2().s[49]++;await axios({method:"post",url:"http://avabotformrecog.azurewebsites.net/api/FormRecogFunction?type=BusinessCard",data:form,headers:form.getHeaders()}).then(function(response){cov_13uzh0bhr2().f[5]++;var a=(cov_13uzh0bhr2().s[50]++,response.data);cov_13uzh0bhr2().s[51]++;a.forEach(line=>{cov_13uzh0bhr2().f[6]++;cov_13uzh0bhr2().s[52]++;image_result+=line+"\n";});}).catch(function(error){cov_13uzh0bhr2().f[7]++;cov_13uzh0bhr2().s[53]++;console.log(error);});cov_13uzh0bhr2().s[54]++;try{cov_13uzh0bhr2().s[55]++;fs.unlinkSync(path);}catch(error){}cov_13uzh0bhr2().s[56]++;if(image_result){cov_13uzh0bhr2().b[8][0]++;cov_13uzh0bhr2().s[57]++;await step.context.sendActivity(image_result);}else{cov_13uzh0bhr2().b[8][1]++;cov_13uzh0bhr2().s[58]++;await step.context.sendActivity("Recognition failed, no pattern found");}}}else{cov_13uzh0bhr2().b[6][1]++;}}else{cov_13uzh0bhr2().b[4][1]++;}cov_13uzh0bhr2().s[59]++;return await step.next();}async repeatStep(step){cov_13uzh0bhr2().f[8]++;cov_13uzh0bhr2().s[60]++;return await step.replaceDialog(this.initialDialogId,{restartMsg:"What else can I do for you?"});}async sendReq(path){cov_13uzh0bhr2().f[9]++;var form1=(cov_13uzh0bhr2().s[61]++,new FormData());cov_13uzh0bhr2().s[62]++;form1.append("file",fse.createReadStream(path));var form2=(cov_13uzh0bhr2().s[63]++,new FormData());cov_13uzh0bhr2().s[64]++;form2.append("file",fse.createReadStream(path));var form3=(cov_13uzh0bhr2().s[65]++,new FormData());cov_13uzh0bhr2().s[66]++;form3.append("file",fse.createReadStream(path));let reqArr=(cov_13uzh0bhr2().s[67]++,[axios({method:"post",url:"https://textsumapi.azurewebsites.net/api/TextSummary",data:form1,headers:form1.getHeaders()}),axios({method:"post",url:"http://20.77.57.60:5000",data:form2,headers:form2.getHeaders()}),axios({method:"post",url:"https://avabotformrecog.azurewebsites.net/api/FormRecogFunction?type=Layout",data:form3,headers:form3.getHeaders()})]);var output=(cov_13uzh0bhr2().s[68]++,[]);cov_13uzh0bhr2().s[69]++;await Promise.allSettled(reqArr).then(results=>{cov_13uzh0bhr2().f[10]++;cov_13uzh0bhr2().s[70]++;results.forEach(result=>{cov_13uzh0bhr2().f[11]++;cov_13uzh0bhr2().s[71]++;console.log(result.status);cov_13uzh0bhr2().s[72]++;if(result.status=="fulfilled"){cov_13uzh0bhr2().b[9][0]++;cov_13uzh0bhr2().s[73]++;output.push(result.value.data);cov_13uzh0bhr2().s[74]++;console.log("first: "+result.value.data);}else{cov_13uzh0bhr2().b[9][1]++;cov_13uzh0bhr2().s[75]++;output.push(0);}});});cov_13uzh0bhr2().s[76]++;console.log("finished!");cov_13uzh0bhr2().s[77]++;console.log(output);cov_13uzh0bhr2().s[78]++;return output;}async handleIncomingAttachment(turnContext){cov_13uzh0bhr2().f[12]++;// Prepare Promises to download each attachment and then execute each Promise.
const promises=(cov_13uzh0bhr2().s[79]++,await turnContext.activity.attachments.map(this.downloadAttachmentAndWrite));const successfulSaves=(cov_13uzh0bhr2().s[80]++,await Promise.all(promises));// Replies back to the user with information about where the attachment is stored on the bot's server,
// and what the name of the saved file is.
async function replyForReceivedAttachments(localAttachmentData){cov_13uzh0bhr2().f[13]++;cov_13uzh0bhr2().s[81]++;if(localAttachmentData){cov_13uzh0bhr2().b[10][0]++;cov_13uzh0bhr2().s[82]++;// Because the TurnContext was bound to this function, the bot can call
// `TurnContext.sendActivity` via `this.sendActivity`;
await this.sendActivity(`Attachment "${localAttachmentData.fileName}" `+`has been received.`);cov_13uzh0bhr2().s[83]++;return localAttachmentData.localPath;}else{cov_13uzh0bhr2().b[10][1]++;cov_13uzh0bhr2().s[84]++;await this.sendActivity("Attachment was not successfully received.");cov_13uzh0bhr2().s[85]++;return undefined;}}// Prepare Promises to reply to the user with information about saved attachments.
// The current TurnContext is bound so `replyForReceivedAttachments` can also send replies.
const replyPromises=(cov_13uzh0bhr2().s[86]++,successfulSaves.map(replyForReceivedAttachments.bind(turnContext)));let r=(cov_13uzh0bhr2().s[87]++,await Promise.all(replyPromises).then(result=>{cov_13uzh0bhr2().f[14]++;cov_13uzh0bhr2().s[88]++;return result[0];}));cov_13uzh0bhr2().s[89]++;return r;}async downloadAttachmentAndWrite(attachment){cov_13uzh0bhr2().f[15]++;var name=(cov_13uzh0bhr2().s[90]++,attachment.name);// Retrieve the attachment via the attachment's contentUrl.
const url=(cov_13uzh0bhr2().s[91]++,attachment.contentUrl);// Local file path for the bot to save the attachment.
const localFileName=(cov_13uzh0bhr2().s[92]++,path.join(__dirname,name));cov_13uzh0bhr2().s[93]++;try{// arraybuffer is necessary for images
const response=(cov_13uzh0bhr2().s[94]++,await axios.get(url,{responseType:"arraybuffer"}));cov_13uzh0bhr2().s[95]++;fs.writeFile(localFileName,response.data,fsError=>{cov_13uzh0bhr2().f[16]++;cov_13uzh0bhr2().s[96]++;if(fsError){cov_13uzh0bhr2().b[11][0]++;cov_13uzh0bhr2().s[97]++;throw fsError;}else{cov_13uzh0bhr2().b[11][1]++;}});}catch(error){cov_13uzh0bhr2().s[98]++;console.error(error);cov_13uzh0bhr2().s[99]++;return undefined;}// If no error was thrown while writing to disk, return the attachment's name
// and localFilePath for the response back to the user.
cov_13uzh0bhr2().s[100]++;return{fileName:name,localPath:localFileName};}async promptValidator(promptContext){cov_13uzh0bhr2().f[17]++;cov_13uzh0bhr2().s[101]++;if(promptContext.recognized.succeeded){cov_13uzh0bhr2().b[12][0]++;var docType=(cov_13uzh0bhr2().s[102]++,promptContext.options.prompt);var attachments=(cov_13uzh0bhr2().s[103]++,promptContext.recognized.value);var validDoc=(cov_13uzh0bhr2().s[104]++,[]);cov_13uzh0bhr2().s[105]++;attachments.forEach(attachment=>{cov_13uzh0bhr2().f[18]++;cov_13uzh0bhr2().s[106]++;if((cov_13uzh0bhr2().b[14][0]++,docType==="Please attach a document in pdf.")&&(cov_13uzh0bhr2().b[14][1]++,attachment.contentType==="application/pdf")){cov_13uzh0bhr2().b[13][0]++;cov_13uzh0bhr2().s[107]++;//|| attachment.contentType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'|| attachment.contentType === 'application/msword'
validDoc.push(attachment);}else{cov_13uzh0bhr2().b[13][1]++;cov_13uzh0bhr2().s[108]++;if((cov_13uzh0bhr2().b[16][0]++,docType==="Please attach an image.")&&((cov_13uzh0bhr2().b[16][1]++,attachment.contentType==="image/jpeg")||(cov_13uzh0bhr2().b[16][2]++,attachment.contentType==="image/png"))){cov_13uzh0bhr2().b[15][0]++;cov_13uzh0bhr2().s[109]++;validDoc.push(attachment);}else{cov_13uzh0bhr2().b[15][1]++;}}});cov_13uzh0bhr2().s[110]++;promptContext.recognized.value=validDoc;// If none of the attachments are valid images, the retry prompt should be sent.
cov_13uzh0bhr2().s[111]++;return!!validDoc.length;}else{cov_13uzh0bhr2().b[12][1]++;cov_13uzh0bhr2().s[112]++;await promptContext.context.sendActivity("No attachments received.");// We can return true from a validator function even if Recognized.Succeeded is false.
cov_13uzh0bhr2().s[113]++;return true;}}}cov_13uzh0bhr2().s[114]++;module.exports.MainDialog=MainDialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW5EaWFsb2cuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJheGlvcyIsImZzIiwiZnNlIiwiRm9ybURhdGEiLCJBdHRhY2htZW50UHJvbXB0IiwiQ2hvaWNlRmFjdG9yeSIsIkNob2ljZVByb21wdCIsIkNvbXBvbmVudERpYWxvZyIsIkRpYWxvZ1NldCIsIkRpYWxvZ1R1cm5TdGF0dXMiLCJXYXRlcmZhbGxEaWFsb2ciLCJBbnN3ZXJEaWFsb2ciLCJBTlNXRVJfRElBTE9HIiwiRG9jRGlhbG9nIiwiRE9DX0RJQUxPRyIsIkFUVEFDSE1FTlRfUFJPTVBUIiwiQ0hPSUNFX1BST01QVCIsIldBVEVSRkFMTF9ESUFMT0ciLCJNYWluRGlhbG9nIiwiY29uc3RydWN0b3IiLCJhZGREaWFsb2ciLCJpbml0aWFsRGlhbG9nSWQiLCJwcm9tcHRWYWxpZGF0b3IiLCJzdGFydFN0ZXAiLCJiaW5kIiwiY2hvb3NlU3RlcCIsImRvY1N0ZXAiLCJyZXBlYXRTdGVwIiwicnVuIiwidHVybkNvbnRleHQiLCJhY2Nlc3NvciIsImRpYWxvZ1NldCIsImFkZCIsImRpYWxvZ0NvbnRleHQiLCJjcmVhdGVDb250ZXh0IiwicmVzdWx0cyIsImNvbnRpbnVlRGlhbG9nIiwic3RhdHVzIiwiZW1wdHkiLCJiZWdpbkRpYWxvZyIsImlkIiwic3RlcCIsIm1zZyIsIm9wdGlvbnMiLCJyZXN0YXJ0TXNnIiwicHJvbXB0IiwiY2hvaWNlcyIsInRvQ2hvaWNlcyIsImNob2ljZSIsInJlc3VsdCIsInZhbHVlIiwicHJvbXB0T3B0aW9ucyIsInJldHJ5UHJvbXB0IiwiY29udGVudFVybCIsInR5cGUiLCJjb250ZW50VHlwZSIsImhhbmRsZUluY29taW5nQXR0YWNobWVudCIsImNvbnRleHQiLCJjb25zb2xlIiwibG9nIiwic2VuZEFjdGl2aXR5IiwicmVxX3Jlc3VsdHMiLCJzZW5kUmVxIiwidW5saW5rU3luYyIsImVycm9yIiwic3VtIiwicXVlcnkiLCJmb3JtIiwiZmlsZXBhdGgiLCJpbWFnZV9yZXN1bHQiLCJhcHBlbmQiLCJjcmVhdGVSZWFkU3RyZWFtIiwibWV0aG9kIiwidXJsIiwiZGF0YSIsImhlYWRlcnMiLCJnZXRIZWFkZXJzIiwidGhlbiIsInJlc3BvbnNlIiwiYSIsImZvckVhY2giLCJsaW5lIiwiY2F0Y2giLCJuZXh0IiwicmVwbGFjZURpYWxvZyIsImZvcm0xIiwiZm9ybTIiLCJmb3JtMyIsInJlcUFyciIsIm91dHB1dCIsIlByb21pc2UiLCJhbGxTZXR0bGVkIiwicHVzaCIsInByb21pc2VzIiwiYWN0aXZpdHkiLCJhdHRhY2htZW50cyIsIm1hcCIsImRvd25sb2FkQXR0YWNobWVudEFuZFdyaXRlIiwic3VjY2Vzc2Z1bFNhdmVzIiwiYWxsIiwicmVwbHlGb3JSZWNlaXZlZEF0dGFjaG1lbnRzIiwibG9jYWxBdHRhY2htZW50RGF0YSIsImZpbGVOYW1lIiwibG9jYWxQYXRoIiwidW5kZWZpbmVkIiwicmVwbHlQcm9taXNlcyIsInIiLCJhdHRhY2htZW50IiwibmFtZSIsImxvY2FsRmlsZU5hbWUiLCJqb2luIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVzcG9uc2VUeXBlIiwid3JpdGVGaWxlIiwiZnNFcnJvciIsInByb21wdENvbnRleHQiLCJyZWNvZ25pemVkIiwic3VjY2VlZGVkIiwiZG9jVHlwZSIsInZhbGlkRG9jIiwibGVuZ3RoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IjIzY0FlWTsyRkFmWixLQUFNQSxDQUFBQSxJQUFJLDBCQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNQyxDQUFBQSxLQUFLLDBCQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFWLENBQVgsQ0FDQSxLQUFNRSxDQUFBQSxFQUFFLDBCQUFHRixPQUFPLENBQUMsSUFBRCxDQUFWLENBQVIsQ0FDQSxLQUFNRyxDQUFBQSxHQUFHLDBCQUFHSCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQVQsQ0FDQSxHQUFJSSxDQUFBQSxRQUFRLDBCQUFHSixPQUFPLENBQUMsV0FB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R0FBMkIsV0FENUIsQ0FERCxDQURLLENBSUwsdURBQ0FpRSxRQUFRLENBQUM1QixJQUFULENBQWNlLFVBQWQsRUFDRCxDQU5NLGtDQU1OLENBQ0YsQ0FkRCxFQUxzQywwQkFxQnRDUyxhQUFhLENBQUNDLFVBQWQsQ0FBeUJuRSxLQUF6QixDQUFpQ3NFLFFBQWpDLENBRUE7QUF2QnNDLDBCQXdCdEMsTUFBTyxDQUFDLENBQUNBLFFBQVEsQ0FBQ0MsTUFBbEIsQ0FDRCxDQXpCRCxJQXlCTyx1REFDTCxLQUFNTCxDQUFBQSxhQUFhLENBQUMzRCxPQUFkLENBQXNCRyxZQUF0QixDQUFtQywwQkFBbkMsQ0FBTixDQUVBO0FBSEssMEJBSUwsTUFBTyxLQUFQLENBQ0QsQ0FDRixDQTNSc0MsQywwQkE4UnpDOEQsTUFBTSxDQUFDQyxPQUFQLENBQWV6RyxVQUFmLENBQTRCQSxVQUE1QiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxuY29uc3QgYXhpb3MgPSByZXF1aXJlKFwiYXhpb3NcIik7XHJcbmNvbnN0IGZzID0gcmVxdWlyZShcImZzXCIpO1xyXG5jb25zdCBmc2UgPSByZXF1aXJlKFwiZnMtZXh0cmFcIik7XHJcbnZhciBGb3JtRGF0YSA9IHJlcXVpcmUoXCJmb3JtLWRhdGFcIik7XHJcbmNvbnN0IHtcclxuICBBdHRhY2htZW50UHJvbXB0LFxyXG4gIENob2ljZUZhY3RvcnksXHJcbiAgQ2hvaWNlUHJvbXB0LFxyXG4gIENvbXBvbmVudERpYWxvZyxcclxuICBEaWFsb2dTZXQsXHJcbiAgRGlhbG9nVHVyblN0YXR1cyxcclxuICBXYXRlcmZhbGxEaWFsb2csXHJcbn0gPSByZXF1aXJlKFwiYm90YnVpbGRlci1kaWFsb2dzXCIpO1xyXG5jb25zdCB7IEFuc3dlckRpYWxvZywgQU5TV0VSX0RJQUxPRyB9ID0gcmVxdWlyZShcIi4vYW5zd2VyRGlhbG9nXCIpO1xyXG5jb25zdCB7IERvY0RpYWxvZywgRE9DX0RJQUxPRyB9ID0gcmVxdWlyZShcIi4vZG9jRGlhbG9nXCIpO1xyXG5cclxuY29uc3QgQVRUQUNITUVOVF9QUk9NUFQgPSBcIkFUVEFDSE1FTlRfUFJPTVBUXCI7XHJcbmNvbnN0IENIT0lDRV9QUk9NUFQgPSBcIkNIT0lDRV9QUk9NUFRcIjtcclxuY29uc3QgV0FURVJGQUxMX0RJQUxPRyA9IFwiV0FURVJGQUxMX0RJQUxPR1wiO1xyXG5cclxuY2xhc3MgTWFpbkRpYWxvZyBleHRlbmRzIENvbXBvbmVudERpYWxvZyB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcihcIm1haW5EaWFsb2dcIik7XHJcblxyXG4gICAgdGhpcy5hZGREaWFsb2cobmV3IEFuc3dlckRpYWxvZygpKTtcclxuICAgIHRoaXMuYWRkRGlhbG9nKG5ldyBEb2NEaWFsb2codGhpcy5pbml0aWFsRGlhbG9nSWQpKTtcclxuICAgIHRoaXMuYWRkRGlhbG9nKG5ldyBDaG9pY2VQcm9tcHQoQ0hPSUNFX1BST01QVCkpO1xyXG4gICAgdGhpcy5hZGREaWFsb2coXHJcbiAgICAgIG5ldyBBdHRhY2htZW50UHJvbXB0KEFUVEFDSE1FTlRfUFJPTVBULCB0aGlzLnByb21wdFZhbGlkYXRvcilcclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5hZGREaWFsb2coXHJcbiAgICAgIG5ldyBXYXRlcmZhbGxEaWFsb2coV0FURVJGQUxMX0RJQUxPRywgW1xyXG4gICAgICAgIHRoaXMuc3RhcnRTdGVwLmJpbmQodGhpcyksXHJcbiAgICAgICAgdGhpcy5jaG9vc2VTdGVwLmJpbmQodGhpcyksXHJcbiAgICAgICAgdGhpcy5kb2NTdGVwLmJpbmQodGhpcyksXHJcbiAgICAgICAgdGhpcy5yZXBlYXRTdGVwLmJpbmQodGhpcyksXHJcbiAgICAgIF0pXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuaW5pdGlhbERpYWxvZ0lkID0gV0FURVJGQUxMX0RJQUxPRztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBydW4gbWV0aG9kIGhhbmRsZXMgdGhlIGluY29taW5nIGFjdGl2aXR5IChpbiB0aGUgZm9ybSBvZiBhIFR1cm5Db250ZXh0KSBhbmQgcGFzc2VzIGl0IHRocm91Z2ggdGhlIGRpYWxvZyBzeXN0ZW0uXHJcbiAgICogSWYgbm8gZGlhbG9nIGlzIGFjdGl2ZSwgaXQgd2lsbCBzdGFydCB0aGUgZGVmYXVsdCBkaWFsb2cuXHJcbiAgICogQHBhcmFtIHsqfSB0dXJuQ29udGV4dFxyXG4gICAqIEBwYXJhbSB7Kn0gYWNjZXNzb3JcclxuICAgKi9cclxuICBhc3luYyBydW4odHVybkNvbnRleHQsIGFjY2Vzc29yKSB7XHJcbiAgICBjb25zdCBkaWFsb2dTZXQgPSBuZXcgRGlhbG9nU2V0KGFjY2Vzc29yKTtcclxuICAgIGRpYWxvZ1NldC5hZGQodGhpcyk7XHJcblxyXG4gICAgY29uc3QgZGlhbG9nQ29udGV4dCA9IGF3YWl0IGRpYWxvZ1NldC5jcmVhdGVDb250ZXh0KHR1cm5Db250ZXh0KTtcclxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBkaWFsb2dDb250ZXh0LmNvbnRpbnVlRGlhbG9nKCk7XHJcbiAgICBpZiAocmVzdWx0cy5zdGF0dXMgPT09IERpYWxvZ1R1cm5TdGF0dXMuZW1wdHkpIHtcclxuICAgICAgYXdhaXQgZGlhbG9nQ29udGV4dC5iZWdpbkRpYWxvZyh0aGlzLmlkKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHN0YXJ0U3RlcChzdGVwKSB7XHJcbiAgICAvLyBXYXRlcmZhbGxTdGVwIGFsd2F5cyBmaW5pc2hlcyB3aXRoIHRoZSBlbmQgb2YgdGhlIFdhdGVyZmFsbCBvciB3aXRoIGFub3RoZXIgZGlhbG9nOyBoZXJlIGl0IGlzIGEgUHJvbXB0IERpYWxvZy5cclxuICAgIC8vIFJ1bm5pbmcgYSBwcm9tcHQgaGVyZSBtZWFucyB0aGUgbmV4dCBXYXRlcmZhbGxTdGVwIHdpbGwgYmUgcnVuIHdoZW4gdGhlIHVzZXIncyByZXNwb25zZSBpcyByZWNlaXZlZC5cclxuICAgIGNvbnN0IG1zZyA9IHN0ZXAub3B0aW9ucy5yZXN0YXJ0TXNnXHJcbiAgICAgID8gc3RlcC5vcHRpb25zLnJlc3RhcnRNc2dcclxuICAgICAgOiBcIldoYXQgY2FuIEkgZG8gZm9yIHlvdT9cIjtcclxuICAgIHJldHVybiBhd2FpdCBzdGVwLnByb21wdChDSE9JQ0VfUFJPTVBULCB7XHJcbiAgICAgIHByb21wdDogbXNnLFxyXG4gICAgICBjaG9pY2VzOiBDaG9pY2VGYWN0b3J5LnRvQ2hvaWNlcyhbXHJcbiAgICAgICAgXCJhc2sgYSBxdWVzdGlvblwiLFxyXG4gICAgICAgIFwicHJvY2VzcyBhIGRvY3VtZW50XCIsXHJcbiAgICAgICAgLFxyXG4gICAgICAgIFwicmVjb2duaXplIGFuIGltYWdlXCIsXHJcbiAgICAgIF0pLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjaG9vc2VTdGVwKHN0ZXApIHtcclxuICAgIGNvbnN0IGNob2ljZSA9IHN0ZXAucmVzdWx0LnZhbHVlO1xyXG4gICAgaWYgKGNob2ljZSA9PSBcImFzayBhIHF1ZXN0aW9uXCIpIHtcclxuICAgICAgcmV0dXJuIGF3YWl0IHN0ZXAuYmVnaW5EaWFsb2coQU5TV0VSX0RJQUxPRyk7XHJcbiAgICB9IGVsc2UgaWYgKGNob2ljZSA9PSBcInByb2Nlc3MgYSBkb2N1bWVudFwiKSB7XHJcbiAgICAgIHZhciBwcm9tcHRPcHRpb25zID0ge1xyXG4gICAgICAgIHByb21wdDogXCJQbGVhc2UgYXR0YWNoIGEgZG9jdW1lbnQgaW4gcGRmLlwiLFxyXG4gICAgICAgIHJldHJ5UHJvbXB0OlxyXG4gICAgICAgICAgXCJUaGF0IHdhcyBub3QgYSBkb2N1bWVudCB0aGF0IEkgY2FuIGhlbHAsIHBsZWFzZSB0cnkgYWdhaW4gd2l0aCBhIGRvY3VtZW50IGluIHBkZi5cIixcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBhd2FpdCBzdGVwLnByb21wdChBVFRBQ0hNRU5UX1BST01QVCwgcHJvbXB0T3B0aW9ucyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YXIgcHJvbXB0T3B0aW9ucyA9IHtcclxuICAgICAgICBwcm9tcHQ6IFwiUGxlYXNlIGF0dGFjaCBhbiBpbWFnZS5cIixcclxuICAgICAgICByZXRyeVByb21wdDpcclxuICAgICAgICAgIFwiVGhhdCB3YXMgbm90IGFuIGltYWdlIHRoYXQgSSBjYW4gaGVscCwgcGxlYXNlIHRyeSBhZ2FpbiB3aXRoIGFuIGltYWdlIGluIHBuZy9qcGcuXCIsXHJcbiAgICAgIH07XHJcblxyXG4gICAgICByZXR1cm4gYXdhaXQgc3RlcC5wcm9tcHQoQVRUQUNITUVOVF9QUk9NUFQsIHByb21wdE9wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZG9jU3RlcChzdGVwKSB7XHJcbiAgICBpZiAoc3RlcC5yZXN1bHQgJiYgc3RlcC5yZXN1bHRbMF0uY29udGVudFVybCkge1xyXG4gICAgICB2YXIgdHlwZSA9IHN0ZXAucmVzdWx0WzBdLmNvbnRlbnRUeXBlO1xyXG4gICAgICB2YXIgcGF0aCA9IGF3YWl0IHRoaXMuaGFuZGxlSW5jb21pbmdBdHRhY2htZW50KHN0ZXAuY29udGV4dCk7XHJcbiAgICAgIGNvbnNvbGUubG9nKHBhdGgpO1xyXG4gICAgICBpZiAocGF0aCkge1xyXG4gICAgICAgIGlmICh0eXBlID09PSBcImFwcGxpY2F0aW9uL3BkZlwiKSB7XHJcbiAgICAgICAgICBhd2FpdCBzdGVwLmNvbnRleHQuc2VuZEFjdGl2aXR5KFxyXG4gICAgICAgICAgICBcIlByb2Nlc3NpbmcgdGhlIGRvY3VtZW50LCBwbGVhc2Ugd2FpdCwgaXQgd2lsbCB0YWtlIGFyb3VuZCA1NSBzZWNvbmRzXCJcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICB2YXIgcmVxX3Jlc3VsdHMgPSBhd2FpdCB0aGlzLnNlbmRSZXEocGF0aCk7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBmcy51bmxpbmtTeW5jKHBhdGgpO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHt9XHJcbiAgICAgICAgICByZXR1cm4gYXdhaXQgc3RlcC5iZWdpbkRpYWxvZyhET0NfRElBTE9HLCB7XHJcbiAgICAgICAgICAgIHN1bTogcmVxX3Jlc3VsdHNbMF0sXHJcbiAgICAgICAgICAgIHF1ZXJ5OiByZXFfcmVzdWx0c1sxXSxcclxuICAgICAgICAgICAgZm9ybTogcmVxX3Jlc3VsdHNbMl0sXHJcbiAgICAgICAgICAgIGZpbGVwYXRoOiBwYXRoLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHZhciBpbWFnZV9yZXN1bHQgPSBcIlwiO1xyXG4gICAgICAgICAgYXdhaXQgc3RlcC5jb250ZXh0LnNlbmRBY3Rpdml0eShcclxuICAgICAgICAgICAgXCJQcm9jZXNzaW5nIHRoZSBpbWFnZSwgcGxlYXNlIHdhaXQsIGl0IHdpbGwgdGFrZSBhcm91bmQgMTUgc2Vjb25kc1wiXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgdmFyIGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgIGZvcm0uYXBwZW5kKFwiZmlsZVwiLCBmc2UuY3JlYXRlUmVhZFN0cmVhbShwYXRoKSk7XHJcbiAgICAgICAgICBhd2FpdCBheGlvcyh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgICAgIHVybDpcclxuICAgICAgICAgICAgICBcImh0dHA6Ly9hdmFib3Rmb3JtcmVjb2cuYXp1cmV3ZWJzaXRlcy5uZXQvYXBpL0Zvcm1SZWNvZ0Z1bmN0aW9uP3R5cGU9QnVzaW5lc3NDYXJkXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IGZvcm0sXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IGZvcm0uZ2V0SGVhZGVycygpLFxyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGEgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgIGEuZm9yRWFjaCgobGluZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VfcmVzdWx0ICs9IGxpbmUgKyBcIlxcblwiO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGZzLnVubGlua1N5bmMocGF0aCk7XHJcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cclxuICAgICAgICAgIGlmIChpbWFnZV9yZXN1bHQpIHtcclxuICAgICAgICAgICAgYXdhaXQgc3RlcC5jb250ZXh0LnNlbmRBY3Rpdml0eShpbWFnZV9yZXN1bHQpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgc3RlcC5jb250ZXh0LnNlbmRBY3Rpdml0eShcclxuICAgICAgICAgICAgICBcIlJlY29nbml0aW9uIGZhaWxlZCwgbm8gcGF0dGVybiBmb3VuZFwiXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYXdhaXQgc3RlcC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyByZXBlYXRTdGVwKHN0ZXApIHtcclxuICAgIHJldHVybiBhd2FpdCBzdGVwLnJlcGxhY2VEaWFsb2codGhpcy5pbml0aWFsRGlhbG9nSWQsIHtcclxuICAgICAgcmVzdGFydE1zZzogXCJXaGF0IGVsc2UgY2FuIEkgZG8gZm9yIHlvdT9cIixcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgc2VuZFJlcShwYXRoKSB7XHJcbiAgICB2YXIgZm9ybTEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIGZvcm0xLmFwcGVuZChcImZpbGVcIiwgZnNlLmNyZWF0ZVJlYWRTdHJlYW0ocGF0aCkpO1xyXG4gICAgdmFyIGZvcm0yID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICBmb3JtMi5hcHBlbmQoXCJmaWxlXCIsIGZzZS5jcmVhdGVSZWFkU3RyZWFtKHBhdGgpKTtcclxuICAgIHZhciBmb3JtMyA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgZm9ybTMuYXBwZW5kKFwiZmlsZVwiLCBmc2UuY3JlYXRlUmVhZFN0cmVhbShwYXRoKSk7XHJcblxyXG4gICAgbGV0IHJlcUFyciA9IFtcclxuICAgICAgYXhpb3Moe1xyXG4gICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgICAgdXJsOiBcImh0dHBzOi8vdGV4dHN1bWFwaS5henVyZXdlYnNpdGVzLm5ldC9hcGkvVGV4dFN1bW1hcnlcIixcclxuICAgICAgICBkYXRhOiBmb3JtMSxcclxuICAgICAgICBoZWFkZXJzOiBmb3JtMS5nZXRIZWFkZXJzKCksXHJcbiAgICAgIH0pLFxyXG4gICAgICBheGlvcyh7XHJcbiAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgICB1cmw6IFwiaHR0cDovLzIwLjc3LjU3LjYwOjUwMDBcIixcclxuICAgICAgICBkYXRhOiBmb3JtMixcclxuICAgICAgICBoZWFkZXJzOiBmb3JtMi5nZXRIZWFkZXJzKCksXHJcbiAgICAgIH0pLFxyXG4gICAgICBheGlvcyh7XHJcbiAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgICB1cmw6XHJcbiAgICAgICAgICBcImh0dHBzOi8vYXZhYm90Zm9ybXJlY29nLmF6dXJld2Vic2l0ZXMubmV0L2FwaS9Gb3JtUmVjb2dGdW5jdGlvbj90eXBlPUxheW91dFwiLFxyXG4gICAgICAgIGRhdGE6IGZvcm0zLFxyXG4gICAgICAgIGhlYWRlcnM6IGZvcm0zLmdldEhlYWRlcnMoKSxcclxuICAgICAgfSksXHJcbiAgICBdO1xyXG4gICAgdmFyIG91dHB1dCA9IFtdO1xyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHJlcUFycikudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5zdGF0dXMpO1xyXG4gICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09IFwiZnVsZmlsbGVkXCIpIHtcclxuICAgICAgICAgIG91dHB1dC5wdXNoKHJlc3VsdC52YWx1ZS5kYXRhKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmlyc3Q6IFwiICsgcmVzdWx0LnZhbHVlLmRhdGEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBvdXRwdXQucHVzaCgwKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBjb25zb2xlLmxvZyhcImZpbmlzaGVkIVwiKTtcclxuICAgIGNvbnNvbGUubG9nKG91dHB1dCk7XHJcbiAgICByZXR1cm4gb3V0cHV0O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlSW5jb21pbmdBdHRhY2htZW50KHR1cm5Db250ZXh0KSB7XHJcbiAgICAvLyBQcmVwYXJlIFByb21pc2VzIHRvIGRvd25sb2FkIGVhY2ggYXR0YWNobWVudCBhbmQgdGhlbiBleGVjdXRlIGVhY2ggUHJvbWlzZS5cclxuICAgIGNvbnN0IHByb21pc2VzID0gYXdhaXQgdHVybkNvbnRleHQuYWN0aXZpdHkuYXR0YWNobWVudHMubWFwKFxyXG4gICAgICB0aGlzLmRvd25sb2FkQXR0YWNobWVudEFuZFdyaXRlXHJcbiAgICApO1xyXG4gICAgY29uc3Qgc3VjY2Vzc2Z1bFNhdmVzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xyXG5cclxuICAgIC8vIFJlcGxpZXMgYmFjayB0byB0aGUgdXNlciB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHdoZXJlIHRoZSBhdHRhY2htZW50IGlzIHN0b3JlZCBvbiB0aGUgYm90J3Mgc2VydmVyLFxyXG4gICAgLy8gYW5kIHdoYXQgdGhlIG5hbWUgb2YgdGhlIHNhdmVkIGZpbGUgaXMuXHJcbiAgICBhc3luYyBmdW5jdGlvbiByZXBseUZvclJlY2VpdmVkQXR0YWNobWVudHMobG9jYWxBdHRhY2htZW50RGF0YSkge1xyXG4gICAgICBpZiAobG9jYWxBdHRhY2htZW50RGF0YSkge1xyXG4gICAgICAgIC8vIEJlY2F1c2UgdGhlIFR1cm5Db250ZXh0IHdhcyBib3VuZCB0byB0aGlzIGZ1bmN0aW9uLCB0aGUgYm90IGNhbiBjYWxsXHJcbiAgICAgICAgLy8gYFR1cm5Db250ZXh0LnNlbmRBY3Rpdml0eWAgdmlhIGB0aGlzLnNlbmRBY3Rpdml0eWA7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kQWN0aXZpdHkoXHJcbiAgICAgICAgICBgQXR0YWNobWVudCBcIiR7bG9jYWxBdHRhY2htZW50RGF0YS5maWxlTmFtZX1cIiBgICsgYGhhcyBiZWVuIHJlY2VpdmVkLmBcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBsb2NhbEF0dGFjaG1lbnREYXRhLmxvY2FsUGF0aDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBhd2FpdCB0aGlzLnNlbmRBY3Rpdml0eShcIkF0dGFjaG1lbnQgd2FzIG5vdCBzdWNjZXNzZnVsbHkgcmVjZWl2ZWQuXCIpO1xyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBQcmVwYXJlIFByb21pc2VzIHRvIHJlcGx5IHRvIHRoZSB1c2VyIHdpdGggaW5mb3JtYXRpb24gYWJvdXQgc2F2ZWQgYXR0YWNobWVudHMuXHJcbiAgICAvLyBUaGUgY3VycmVudCBUdXJuQ29udGV4dCBpcyBib3VuZCBzbyBgcmVwbHlGb3JSZWNlaXZlZEF0dGFjaG1lbnRzYCBjYW4gYWxzbyBzZW5kIHJlcGxpZXMuXHJcbiAgICBjb25zdCByZXBseVByb21pc2VzID0gc3VjY2Vzc2Z1bFNhdmVzLm1hcChcclxuICAgICAgcmVwbHlGb3JSZWNlaXZlZEF0dGFjaG1lbnRzLmJpbmQodHVybkNvbnRleHQpXHJcbiAgICApO1xyXG4gICAgbGV0IHIgPSBhd2FpdCBQcm9taXNlLmFsbChyZXBseVByb21pc2VzKS50aGVuKChyZXN1bHQpID0+IHJlc3VsdFswXSk7XHJcbiAgICByZXR1cm4gcjtcclxuICB9XHJcblxyXG4gIGFzeW5jIGRvd25sb2FkQXR0YWNobWVudEFuZFdyaXRlKGF0dGFjaG1lbnQpIHtcclxuICAgIHZhciBuYW1lID0gYXR0YWNobWVudC5uYW1lO1xyXG4gICAgLy8gUmV0cmlldmUgdGhlIGF0dGFjaG1lbnQgdmlhIHRoZSBhdHRhY2htZW50J3MgY29udGVudFVybC5cclxuICAgIGNvbnN0IHVybCA9IGF0dGFjaG1lbnQuY29udGVudFVybDtcclxuXHJcbiAgICAvLyBMb2NhbCBmaWxlIHBhdGggZm9yIHRoZSBib3QgdG8gc2F2ZSB0aGUgYXR0YWNobWVudC5cclxuICAgIGNvbnN0IGxvY2FsRmlsZU5hbWUgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCBuYW1lKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBhcnJheWJ1ZmZlciBpcyBuZWNlc3NhcnkgZm9yIGltYWdlc1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLmdldCh1cmwsIHsgcmVzcG9uc2VUeXBlOiBcImFycmF5YnVmZmVyXCIgfSk7XHJcbiAgICAgIGZzLndyaXRlRmlsZShsb2NhbEZpbGVOYW1lLCByZXNwb25zZS5kYXRhLCAoZnNFcnJvcikgPT4ge1xyXG4gICAgICAgIGlmIChmc0Vycm9yKSB7XHJcbiAgICAgICAgICB0aHJvdyBmc0Vycm9yO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIC8vIElmIG5vIGVycm9yIHdhcyB0aHJvd24gd2hpbGUgd3JpdGluZyB0byBkaXNrLCByZXR1cm4gdGhlIGF0dGFjaG1lbnQncyBuYW1lXHJcbiAgICAvLyBhbmQgbG9jYWxGaWxlUGF0aCBmb3IgdGhlIHJlc3BvbnNlIGJhY2sgdG8gdGhlIHVzZXIuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBmaWxlTmFtZTogbmFtZSxcclxuICAgICAgbG9jYWxQYXRoOiBsb2NhbEZpbGVOYW1lLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHByb21wdFZhbGlkYXRvcihwcm9tcHRDb250ZXh0KSB7XHJcbiAgICBpZiAocHJvbXB0Q29udGV4dC5yZWNvZ25pemVkLnN1Y2NlZWRlZCkge1xyXG4gICAgICB2YXIgZG9jVHlwZSA9IHByb21wdENvbnRleHQub3B0aW9ucy5wcm9tcHQ7XHJcbiAgICAgIHZhciBhdHRhY2htZW50cyA9IHByb21wdENvbnRleHQucmVjb2duaXplZC52YWx1ZTtcclxuICAgICAgdmFyIHZhbGlkRG9jID0gW107XHJcblxyXG4gICAgICBhdHRhY2htZW50cy5mb3JFYWNoKChhdHRhY2htZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgZG9jVHlwZSA9PT0gXCJQbGVhc2UgYXR0YWNoIGEgZG9jdW1lbnQgaW4gcGRmLlwiICYmXHJcbiAgICAgICAgICBhdHRhY2htZW50LmNvbnRlbnRUeXBlID09PSBcImFwcGxpY2F0aW9uL3BkZlwiXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAvL3x8IGF0dGFjaG1lbnQuY29udGVudFR5cGUgPT09ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCd8fCBhdHRhY2htZW50LmNvbnRlbnRUeXBlID09PSAnYXBwbGljYXRpb24vbXN3b3JkJ1xyXG4gICAgICAgICAgdmFsaWREb2MucHVzaChhdHRhY2htZW50KTtcclxuICAgICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgICAgZG9jVHlwZSA9PT0gXCJQbGVhc2UgYXR0YWNoIGFuIGltYWdlLlwiICYmXHJcbiAgICAgICAgICAoYXR0YWNobWVudC5jb250ZW50VHlwZSA9PT0gXCJpbWFnZS9qcGVnXCIgfHxcclxuICAgICAgICAgICAgYXR0YWNobWVudC5jb250ZW50VHlwZSA9PT0gXCJpbWFnZS9wbmdcIilcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHZhbGlkRG9jLnB1c2goYXR0YWNobWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHByb21wdENvbnRleHQucmVjb2duaXplZC52YWx1ZSA9IHZhbGlkRG9jO1xyXG5cclxuICAgICAgLy8gSWYgbm9uZSBvZiB0aGUgYXR0YWNobWVudHMgYXJlIHZhbGlkIGltYWdlcywgdGhlIHJldHJ5IHByb21wdCBzaG91bGQgYmUgc2VudC5cclxuICAgICAgcmV0dXJuICEhdmFsaWREb2MubGVuZ3RoO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYXdhaXQgcHJvbXB0Q29udGV4dC5jb250ZXh0LnNlbmRBY3Rpdml0eShcIk5vIGF0dGFjaG1lbnRzIHJlY2VpdmVkLlwiKTtcclxuXHJcbiAgICAgIC8vIFdlIGNhbiByZXR1cm4gdHJ1ZSBmcm9tIGEgdmFsaWRhdG9yIGZ1bmN0aW9uIGV2ZW4gaWYgUmVjb2duaXplZC5TdWNjZWVkZWQgaXMgZmFsc2UuXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMuTWFpbkRpYWxvZyA9IE1haW5EaWFsb2c7XHJcbiJdfQ==